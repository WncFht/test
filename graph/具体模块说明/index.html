<!DOCTYPE html>
<html class="no-js" lang="zh">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="wnc" name="author"/>
<link href="https://WncFht.github.io/test/graph/%E5%85%B7%E4%BD%93%E6%A8%A1%E5%9D%97%E8%AF%B4%E6%98%8E/" rel="canonical"/>
<link href="../%E5%85%A5%E5%85%9A%E7%94%B3%E8%AF%B7%E4%B9%A6/" rel="prev"/>
<link href="../%E5%87%B8%E4%BC%98%E5%8C%96/" rel="next"/>
<link href="../../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.5.47" name="generator"/>
<title>具体模块说明 - wnc 的咖啡馆</title>
<link href="../../assets/stylesheets/main.6f8fc17f.min.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet"/>
<link href="../../css/heti.css" rel="stylesheet"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css" rel="stylesheet"/>
<link href="https://cdn.tonycrane.cc/jbmono/jetbrainsmono.css" rel="stylesheet"/>
<link href="https://cdn.tonycrane.cc/lxgw/lxgwscreen.css" rel="stylesheet"/>
<link href="../../css/custom.css" rel="stylesheet"/>
<link href="../../css/tasklist.css" rel="stylesheet"/>
<link href="../../css/card.css" rel="stylesheet"/>
<link href="../../css/flink.css" rel="stylesheet"/>
<script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
<link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../assets/javascripts/glightbox.min.js"></script></head>
<body data-md-color-accent="indigo" data-md-color-primary="blue-grey" data-md-color-scheme="default" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#_1">
          跳转至
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="页眉" class="md-header__inner md-grid">
<a aria-label="wnc 的咖啡馆" class="md-header__button md-logo" data-md-component="logo" href="../.." title="wnc 的咖啡馆">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M2 21h18v-2H2M20 8h-2V5h2m0-2H4v10a4 4 0 0 0 4 4h6a4 4 0 0 0 4-4v-3h2a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            wnc 的咖啡馆
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              具体模块说明
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="切换至夜间模式" class="md-option" data-md-color-accent="indigo" data-md-color-media="(prefers-color-scheme: light)" data-md-color-primary="blue-grey" data-md-color-scheme="default" id="__palette_0" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="切换至夜间模式">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
<input aria-label="切换至日间模式" class="md-option" data-md-color-accent="indigo" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-primary="black" data-md-color-scheme="slate" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_0" hidden="" title="切换至日间模式">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
</form>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="搜索" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="搜索" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="查找" class="md-search__options">
<button aria-label="清空当前内容" class="md-search__icon md-icon" tabindex="-1" title="清空当前内容" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/WncFht/test/" title="前往仓库">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M2 21h18v-2H2M20 8h-2V5h2m0-2H4v10a4 4 0 0 0 4 4h6a4 4 0 0 0 4-4v-3h2a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2"></path></svg>
</div>
<div class="md-source__repository">
    wnc's café
  </div>
</a>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<nav aria-label="标签" class="md-tabs" data-md-component="tabs">
<div class="md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../index.md">
          
  
    
  
  Home

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../Obsidian/aaaa/">
          
  
    
  
  Obsidian 的笔记

        </a>
</li>
<li class="md-tabs__item md-tabs__item--active">
<a class="md-tabs__link" href="../AI/">
          
  
    
  
  网络

        </a>
</li>
</ul>
</div>
</nav>
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="导航栏" class="md-nav md-nav--primary md-nav--lifted" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="wnc 的咖啡馆" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="wnc 的咖啡馆">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M2 21h18v-2H2M20 8h-2V5h2m0-2H4v10a4 4 0 0 0 4 4h6a4 4 0 0 0 4-4v-3h2a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2"></path></svg>
</a>
    wnc 的咖啡馆
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/WncFht/test/" title="前往仓库">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M2 21h18v-2H2M20 8h-2V5h2m0-2H4v10a4 4 0 0 0 4 4h6a4 4 0 0 0 4-4v-3h2a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2"></path></svg>
</div>
<div class="md-source__repository">
    wnc's café
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
<span class="md-ellipsis">
    Home
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_1_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_1">
<span class="md-nav__icon md-icon"></span>
            Home
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../index.md">
<span class="md-ellipsis">
    None
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
<span class="md-ellipsis">
    Obsidian 的笔记
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
            Obsidian 的笔记
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../Obsidian/aaaa/">
<span class="md-ellipsis">
    aaaa
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Obsidian/test/">
<span class="md-ellipsis">
    test
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_3" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../">
<span class="md-ellipsis">
    网络
  </span>
</a>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="true" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
            网络
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../AI/">
<span class="md-ellipsis">
    AI
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../AI%E5%AD%A6%E4%B9%A0%E8%B7%AF%E5%BE%84/">
<span class="md-ellipsis">
    AI学习路径
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../Algorithm/">
<span class="md-ellipsis">
    Algorithm
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../CS231n%20Assignment1/">
<span class="md-ellipsis">
    CS231n Assignment1
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../CS%E7%B1%BB%E5%A4%A7%E4%B8%80%E8%BF%9B%E7%BB%84/">
<span class="md-ellipsis">
    CS类大一进组
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../Compile%20Database/">
<span class="md-ellipsis">
    Compile Database
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../Computer%20Advance/">
<span class="md-ellipsis">
    Computer Advance
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../Computer%20Basic/">
<span class="md-ellipsis">
    Computer Basic
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../Computer%20Science/">
<span class="md-ellipsis">
    Computer Science
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../Cortex-A76%E7%BA%A7%E5%A4%84%E7%90%86%E5%99%A8%E8%AE%BE%E8%AE%A1%E5%AD%A6%E4%B9%A0%E8%AE%A1%E5%88%92/">
<span class="md-ellipsis">
    Cortex-A76级处理器设计学习计划
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../Environment%2C%20software%2C%20tools/">
<span class="md-ellipsis">
    Environment, software, tools
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../Image%20Classification-Data-driven%20Approach%2C%20k-Nearest%20Neighbor%2C%20train_val_test%20splits/">
<span class="md-ellipsis">
    Image Classification-Data-driven Approach, k-Nearest Neighbor, train_val_test splits
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../Language/">
<span class="md-ellipsis">
    Language
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../Linear%20classification-Support%20Vector%20Machine%2C%20Softmax/">
<span class="md-ellipsis">
    Linear classification-Support Vector Machine, Softmax
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../Makeflie/">
<span class="md-ellipsis">
    Makeflie
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../Matlab/">
<span class="md-ellipsis">
    Matlab
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../My_README_on_GitHub/">
<span class="md-ellipsis">
    My_README_on_GitHub
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../Optimization-Stochastic%20Gradient%20Descent/">
<span class="md-ellipsis">
    Optimization-Stochastic Gradient Descent
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../Python%20Numpy/">
<span class="md-ellipsis">
    Python Numpy
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../ROS2-%E8%B8%A9%E5%9D%91/">
<span class="md-ellipsis">
    ROS2-踩坑
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../Robot-control%20theory/">
<span class="md-ellipsis">
    Robot-control theory
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../Robot-%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/">
<span class="md-ellipsis">
    Robot-参考资料
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../Robot-%E6%9C%BA%E6%A2%B0/">
<span class="md-ellipsis">
    Robot-机械
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../Robot-%E7%A1%AC%E4%BB%B6/">
<span class="md-ellipsis">
    Robot-硬件
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../Robot-%E8%A7%86%E8%A7%89/">
<span class="md-ellipsis">
    Robot-视觉
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../SSH/">
<span class="md-ellipsis">
    SSH
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../SVM1/">
<span class="md-ellipsis">
    SVM1
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../SVM2/">
<span class="md-ellipsis">
    SVM2
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../TCS/">
<span class="md-ellipsis">
    TCS
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../Tabby%20%2B%20Zsh/">
<span class="md-ellipsis">
    Tabby + Zsh
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../Technology/">
<span class="md-ellipsis">
    Technology
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../UPC%E6%A8%A1%E6%8B%9F/">
<span class="md-ellipsis">
    UPC模拟
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../UPC%E7%9B%B8%E5%85%B3%E7%9A%84%E8%B5%84%E6%96%99/">
<span class="md-ellipsis">
    UPC相关的资料
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../Untitled%201/">
<span class="md-ellipsis">
    Untitled 1
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../Untitled%202/">
<span class="md-ellipsis">
    Untitled 2
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../Untitled%203/">
<span class="md-ellipsis">
    Untitled 3
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../Untitled/">
<span class="md-ellipsis">
    Untitled
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../Written%20Memories_notes/">
<span class="md-ellipsis">
    Written Memories_notes
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../activity%20watch/">
<span class="md-ellipsis">
    activity watch
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../answer%204/">
<span class="md-ellipsis">
    answer 4
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../attacklab/">
<span class="md-ellipsis">
    attacklab
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../blog/">
<span class="md-ellipsis">
    blog
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../bomblab/">
<span class="md-ellipsis">
    bomblab
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../books%20list/">
<span class="md-ellipsis">
    books list
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../cachelab/">
<span class="md-ellipsis">
    cachelab
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../cgdb/">
<span class="md-ellipsis">
    cgdb
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../chezmoi/">
<span class="md-ellipsis">
    chezmoi
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../critical%20respoense%20essay/">
<span class="md-ellipsis">
    critical respoense essay
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../cs231n/">
<span class="md-ellipsis">
    cs231n
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../csapp-lab%E8%AE%B0%E5%BD%95/">
<span class="md-ellipsis">
    csapp-lab记录
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../demo1/">
<span class="md-ellipsis">
    demo1
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../demo2.1/">
<span class="md-ellipsis">
    demo2.1
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../demo2/">
<span class="md-ellipsis">
    demo2
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../demo3.1/">
<span class="md-ellipsis">
    demo3.1
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../demo3/">
<span class="md-ellipsis">
    demo3
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../forum%2C%20website/">
<span class="md-ellipsis">
    forum, website
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../git/">
<span class="md-ellipsis">
    git
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../github%20Action/">
<span class="md-ellipsis">
    github Action
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../graphics/">
<span class="md-ellipsis">
    graphics
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../high-quality%20blog/">
<span class="md-ellipsis">
    high-quality blog
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../linux/">
<span class="md-ellipsis">
    linux
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../mkdocs%20material%20github-pages%20%E9%85%8D%E7%BD%AE/">
<span class="md-ellipsis">
    mkdocs material github-pages 配置
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../mkdocs%20material%20github-pages%20%E9%85%8D%E7%BD%AE%E7%9B%AE%E5%BD%95/">
<span class="md-ellipsis">
    mkdocs material github-pages 配置目录
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../mkdocs%20material/">
<span class="md-ellipsis">
    mkdocs material
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../model%201%20on%201106/">
<span class="md-ellipsis">
    model 1 on 1106
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../more%20about%20Machine%20Learing/">
<span class="md-ellipsis">
    more about Machine Learing
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../neovim/">
<span class="md-ellipsis">
    neovim
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../nihao/">
<span class="md-ellipsis">
    nihao
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../obsidian/">
<span class="md-ellipsis">
    obsidian
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../prompt%20for%20GPT/">
<span class="md-ellipsis">
    prompt for GPT
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../rectuitment/">
<span class="md-ellipsis">
    rectuitment
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../remote/">
<span class="md-ellipsis">
    remote
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../reveal-md%20%E6%8C%87%E5%8D%97/">
<span class="md-ellipsis">
    reveal-md 指南
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../route/">
<span class="md-ellipsis">
    route
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../tabby/">
<span class="md-ellipsis">
    tabby
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../test1/">
<span class="md-ellipsis">
    test1
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../test12/">
<span class="md-ellipsis">
    test12
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../test123/">
<span class="md-ellipsis">
    test123
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../typst/">
<span class="md-ellipsis">
    typst
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../vim%20%E5%A4%8D%E5%88%B6%E9%97%AE%E9%A2%98/">
<span class="md-ellipsis">
    vim 复制问题
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../vim/">
<span class="md-ellipsis">
    vim
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E4%B8%80%E4%BA%9B%E4%B9%B1%E4%B8%83%E5%85%AB%E7%B3%9F%E7%9A%84%20blog/">
<span class="md-ellipsis">
    一些乱七八糟的 blog
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E4%B8%80%E4%BA%9B%E5%91%BD%E4%BB%A4%20Ubuntu/">
<span class="md-ellipsis">
    一些命令 Ubuntu
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E4%B8%80%E4%BA%9B%E5%AD%98%E6%A1%A3%E7%9A%84%E4%BB%A3%E7%A0%81/">
<span class="md-ellipsis">
    一些存档的代码
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E4%B8%80%E4%BA%9B%E5%AF%86%E9%99%A2%E5%B0%B1%E4%B8%9A%E7%9A%84%E7%BB%8F%E9%AA%8C/">
<span class="md-ellipsis">
    一些密院就业的经验
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E4%B8%80%E4%BA%9B%E6%80%BB%E7%BB%93/">
<span class="md-ellipsis">
    一些总结
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E4%B8%80%E4%BA%9B%E7%AE%80%E5%8E%86/">
<span class="md-ellipsis">
    一些简历
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E4%B8%80%E4%BA%9B%E7%BB%93%E6%9E%9C%20%E6%A8%A1%E5%9E%8B/">
<span class="md-ellipsis">
    一些结果 模型
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E4%B8%80%E4%BA%9B%E9%87%8D%E8%A6%81%E4%BF%A1%E6%81%AF%E7%9A%84%E7%95%99%E6%A1%A3/">
<span class="md-ellipsis">
    一些重要信息的留档
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E8%A2%AB%E9%99%90%E5%88%B6%E5%9C%A8%E5%A3%B0%E9%80%9F/">
<span class="md-ellipsis">
    为什么会被限制在声速
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E4%B9%B1%E5%BA%8F%E5%A4%84%E7%90%86%E5%99%A8%E5%AD%A6%E4%B9%A0%E6%8C%87%E5%8D%97/">
<span class="md-ellipsis">
    乱序处理器学习指南
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E4%BA%A4%E5%8F%89%E7%86%B5%E6%8D%9F%E5%A4%B1/">
<span class="md-ellipsis">
    交叉熵损失
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E4%BC%A0%E7%BB%9F%E7%9A%84%E5%AE%9A%E7%82%B9%E8%A7%A3%E7%AE%97%E6%96%B9%E6%B3%95-%E6%AF%94%E4%BE%8B%E6%B3%95/">
<span class="md-ellipsis">
    传统的定点解算方法-比例法
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E4%BC%A0%E7%BB%9F%E7%9A%84%E5%AE%9A%E7%82%B9%E8%A7%A3%E7%AE%97%E6%96%B9%E6%B3%95/">
<span class="md-ellipsis">
    传统的定点解算方法
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84/">
<span class="md-ellipsis">
    体系结构
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E4%BD%9C%E4%B8%9A%20prompt/">
<span class="md-ellipsis">
    作业 prompt
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E5%85%9A%E5%9B%A2%E4%BA%8B%E5%8A%A1/">
<span class="md-ellipsis">
    党团事务
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E5%85%9A%E7%AB%A0%E3%80%81%E5%85%9A%E6%97%97%E3%80%81%E4%BA%8C%E5%8D%81%E5%A4%A7%E6%8A%A5%E5%91%8A%E3%80%81%E5%85%A5%E5%85%9A%E6%B5%81%E7%A8%8B%E3%80%81%E5%9B%9B%E5%8F%B2%E5%AD%A6%E4%B9%A0%E3%80%81%E5%85%9A%E5%86%85%E7%BA%AA%E5%BE%8B%E3%80%81%E4%B8%A4%E4%B8%AA%E7%A1%AE%E7%AB%8B%E3%80%81%E4%B8%A4%E4%B8%AA%E4%B8%80%E7%99%BE%E5%B9%B4%E5%A5%8B%E6%96%97%E7%9B%AE%E6%A0%87%E3%80%81%E5%85%9A%E5%86%85%E5%85%AD%E5%A4%A7%E7%BA%AA%E5%BE%8B%E3%80%81%E4%BC%9F%E5%A4%A7%E5%BB%BA%E5%85%9A%E7%B2%BE%E7%A5%9E%E3%80%81%E4%B8%AD%E5%9B%BD%E5%85%B1%E4%BA%A7%E5%85%9A%E4%BA%BA%E7%9A%84%E7%B2%BE%E7%A5%9E%E8%B0%B1%E7%B3%BB%E4%BB%A5%E5%8F%8A%E9%83%A8%E5%88%86%E6%8E%88%E8%AF%BE%E5%86%85%E5%AE%B9/">
<span class="md-ellipsis">
    党章、党旗、二十大报告、入党流程、四史学习、党内纪律、两个确立、两个一百年奋斗目标、党内六大纪律、伟大建党精神、中国共产党人的精神谱系以及部分授课内容
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E5%85%A5%E5%85%9A%E6%80%9D%E6%83%B3%E6%8A%A5%E5%91%8A2/">
<span class="md-ellipsis">
    入党思想报告2
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E5%85%A5%E5%85%9A%E7%94%B3%E8%AF%B7%E4%B9%A6/">
<span class="md-ellipsis">
    入党申请书
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    具体模块说明
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    具体模块说明
  </span>
</a>
<nav aria-label="目录" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      目录
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#_2">
<span class="md-ellipsis">
      一、前端设计模块
    </span>
</a>
<nav aria-label="一、前端设计模块" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#1-branch-predictor">
<span class="md-ellipsis">
      1. 分支预测器 (Branch Predictor)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2-instruction-fetch">
<span class="md-ellipsis">
      2. 取指单元 (Instruction Fetch)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#3-rename-dispatch">
<span class="md-ellipsis">
      3. 重命名与分发模块 (Rename &amp; Dispatch)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#4-reservation-station">
<span class="md-ellipsis">
      4. 保留站 (Reservation Station)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#5-reorder-buffer">
<span class="md-ellipsis">
      5. 重排序缓冲区 (Reorder Buffer)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#6-loadstore-queue">
<span class="md-ellipsis">
      6. 访存队列 (Load/Store Queue)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#7-cache-subsystem">
<span class="md-ellipsis">
      7. 缓存子系统 (Cache Subsystem)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#8-memory-interface">
<span class="md-ellipsis">
      8. 主存接口 (Memory Interface)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#8-memory-interface_1">
<span class="md-ellipsis">
      8. 主存接口 (Memory Interface) 续
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#9-verification-platform">
<span class="md-ellipsis">
      9. 验证平台 (Verification Platform)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#10-linux">
<span class="md-ellipsis">
      10. Linux移植
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#11-spec">
<span class="md-ellipsis">
      11. SPEC运行环境
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#12">
<span class="md-ellipsis">
      12. 性能优化
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E5%87%B8%E4%BC%98%E5%8C%96/">
<span class="md-ellipsis">
    凸优化
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/">
<span class="md-ellipsis">
    函数式编程
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E5%8A%A0%E5%AF%86%E5%8E%9F%E7%90%86/">
<span class="md-ellipsis">
    加密原理
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E5%8D%95%E4%BD%8D%E5%9B%9B%E5%85%83%E6%95%B0/">
<span class="md-ellipsis">
    单位四元数
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E5%8D%95%E8%AF%8D%E9%A2%98%E7%9B%AE%E8%A7%A3%E7%AD%94/">
<span class="md-ellipsis">
    单词题目解答
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E5%8F%A6%E4%B8%80%E4%B8%AA%E5%AE%8C%E6%95%B4%E7%9A%84%E6%9E%84%E5%BB%BA/">
<span class="md-ellipsis">
    另一个完整的构建
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E5%9B%BE%E5%BD%A2%E5%AD%A6/">
<span class="md-ellipsis">
    图形学
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E5%A4%8D%E7%8E%B0%E8%AE%BA%E6%96%87/">
<span class="md-ellipsis">
    复现论文
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E5%A4%9A%E6%A8%A1%E6%80%81%E5%AD%A6%E4%B9%A0%E6%8C%87%E5%8D%97/">
<span class="md-ellipsis">
    多模态学习指南
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E5%A4%9A%E6%A8%A1%E6%80%81%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E7%A0%94%E7%A9%B6%E6%96%B9%E5%90%91%E5%AD%A6%E4%B9%A0%E8%A7%84%E5%88%92/">
<span class="md-ellipsis">
    多模态深度学习研究方向学习规划
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8%20docker/">
<span class="md-ellipsis">
    如何使用 docker
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E5%AD%A6%E6%9C%AF%E5%86%99%E4%BD%9C%E5%8A%A8%E8%AF%8D/">
<span class="md-ellipsis">
    学术写作动词
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E5%B9%B6%E8%A1%8C%E8%AE%A1%E7%AE%97/">
<span class="md-ellipsis">
    并行计算
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E5%BE%85%E5%88%86%E7%B1%BB/">
<span class="md-ellipsis">
    待分类
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E6%80%9D%E6%BA%90%E5%AD%A6%E4%B9%A0%E8%AE%A1%E5%88%92/">
<span class="md-ellipsis">
    思源学习计划
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E6%88%91%E7%9A%84%E4%B8%AA%E4%BA%BA%E4%BF%A1%E6%81%AF/">
<span class="md-ellipsis">
    我的个人信息
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E6%88%91%E8%87%AA%E5%B7%B1%E7%9A%84%20AI%20%E6%8A%80%E6%9C%AF%E6%A0%88/">
<span class="md-ellipsis">
    我自己的 AI 技术栈
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E6%8E%92%E7%89%88%E3%80%81blog/">
<span class="md-ellipsis">
    排版、blog
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E6%95%B0%E5%AD%A6%E5%BB%BA%E6%A8%A1_README/">
<span class="md-ellipsis">
    数学建模_README
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E6%96%87%E6%A1%A3%E6%B1%82%E5%8A%A9%E7%9A%84prompt/">
<span class="md-ellipsis">
    文档求助的prompt
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E6%9B%B4%E5%8A%A0%E8%AF%A6%E7%BB%86%E7%9A%84%E5%AE%9E%E4%BE%8B/">
<span class="md-ellipsis">
    更加详细的实例
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E6%9B%B4%E8%BF%9B%E4%B8%80%E6%AD%A5%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%8C%87%E5%8D%97/">
<span class="md-ellipsis">
    更进一步的学习指南
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E6%9C%80%E7%BB%88%E6%A8%A1%E5%9E%8B/">
<span class="md-ellipsis">
    最终模型
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E6%9D%82%E4%B9%B1%E7%9A%84%E4%B8%9C%E8%A5%BF/">
<span class="md-ellipsis">
    杂乱的东西
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E6%9F%A5%E6%89%BE%206Dpose%20%E7%9A%84%E7%9B%B8%E5%85%B3%E6%96%87%E7%8C%AE/">
<span class="md-ellipsis">
    查找 6Dpose 的相关文献
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E6%B5%8B%E8%B7%9D%E4%B8%8E%E6%B7%B1%E5%BA%A6%E4%BC%B0%E8%AE%A1/">
<span class="md-ellipsis">
    测距与深度估计
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E6%BF%80%E5%85%89%E9%9B%B7%E8%BE%BE/">
<span class="md-ellipsis">
    激光雷达
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E7%8B%AC%E7%83%AD%E7%BC%96%E7%A0%81%E5%90%91%E9%87%8F/">
<span class="md-ellipsis">
    独热编码向量
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E7%94%B5%E6%8E%A7%E4%BB%A3%E7%A0%81/">
<span class="md-ellipsis">
    电控代码
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E7%9B%B8%E6%9C%BA%E6%A0%87%E5%AE%9A/">
<span class="md-ellipsis">
    相机标定
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E7%A1%AC%E4%BB%B6-%E7%9B%B8%E6%9C%BA/">
<span class="md-ellipsis">
    硬件-相机
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E7%A5%9E%E5%A5%87%E7%9A%84%E7%BD%91%E7%AB%99/">
<span class="md-ellipsis">
    神奇的网站
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E7%A7%91%E7%A0%94/">
<span class="md-ellipsis">
    科研
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E7%A7%91%E7%A0%94%E5%AD%A6%E4%B9%A0%E8%AE%A1%E5%88%92/">
<span class="md-ellipsis">
    科研学习计划
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E7%A8%8B%E5%BA%8F%E4%BD%BF%E7%94%A8%E5%88%B0%E7%9A%84%E6%A8%A1%E5%9E%8B/">
<span class="md-ellipsis">
    程序使用到的模型
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E7%BC%96%E8%AF%91/">
<span class="md-ellipsis">
    编译
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E7%BC%96%E8%AF%91%E4%BC%98%E5%8C%96/">
<span class="md-ellipsis">
    编译优化
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E7%BC%96%E8%AF%91%E5%85%A5%E9%97%A8/">
<span class="md-ellipsis">
    编译入门
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E7%BC%96%E8%AF%91%E8%BF%9B%E9%98%B6/">
<span class="md-ellipsis">
    编译进阶
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E8%81%94%E7%B3%BB%E5%AF%BC%E5%B8%88%E9%82%AE%E4%BB%B6/">
<span class="md-ellipsis">
    联系导师邮件
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E8%87%AA%E5%AD%A6%E7%BD%91%E7%AB%99/">
<span class="md-ellipsis">
    自学网站
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E8%87%AA%E5%B7%B1%E7%9A%84csapp%E7%AC%94%E8%AE%B0/">
<span class="md-ellipsis">
    自己的csapp笔记
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E8%87%AA%E6%88%91%E4%BB%8B%E7%BB%8D/">
<span class="md-ellipsis">
    自我介绍
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/">
<span class="md-ellipsis">
    计算机网络
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%9F%BA%E7%A1%80/">
<span class="md-ellipsis">
    计算机网络安全基础
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E8%AF%86%E5%88%AB%E6%95%B0%E5%AD%97/">
<span class="md-ellipsis">
    识别数字
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E8%AF%BE%E7%A8%8B/">
<span class="md-ellipsis">
    课程
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E8%BD%AC%E4%B8%93%E4%B8%9A%E6%B1%82%E5%8A%A9/">
<span class="md-ellipsis">
    转专业求助
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E9%A1%B9%E7%9B%AE%E5%AE%9E%E8%B7%B5/">
<span class="md-ellipsis">
    项目实践
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="目录" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      目录
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#_2">
<span class="md-ellipsis">
      一、前端设计模块
    </span>
</a>
<nav aria-label="一、前端设计模块" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#1-branch-predictor">
<span class="md-ellipsis">
      1. 分支预测器 (Branch Predictor)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2-instruction-fetch">
<span class="md-ellipsis">
      2. 取指单元 (Instruction Fetch)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#3-rename-dispatch">
<span class="md-ellipsis">
      3. 重命名与分发模块 (Rename &amp; Dispatch)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#4-reservation-station">
<span class="md-ellipsis">
      4. 保留站 (Reservation Station)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#5-reorder-buffer">
<span class="md-ellipsis">
      5. 重排序缓冲区 (Reorder Buffer)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#6-loadstore-queue">
<span class="md-ellipsis">
      6. 访存队列 (Load/Store Queue)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#7-cache-subsystem">
<span class="md-ellipsis">
      7. 缓存子系统 (Cache Subsystem)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#8-memory-interface">
<span class="md-ellipsis">
      8. 主存接口 (Memory Interface)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#8-memory-interface_1">
<span class="md-ellipsis">
      8. 主存接口 (Memory Interface) 续
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#9-verification-platform">
<span class="md-ellipsis">
      9. 验证平台 (Verification Platform)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#10-linux">
<span class="md-ellipsis">
      10. Linux移植
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#11-spec">
<span class="md-ellipsis">
      11. SPEC运行环境
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#12">
<span class="md-ellipsis">
      12. 性能优化
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<a class="md-content__button md-icon" href="https://github.com/WncFht/test/edit/main/docs/graph/具体模块说明.md" title="edit.link.title">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75z"></path></svg>
</a>
<h1 id="_1">超标量乱序处理器模块详细说明<a class="headerlink" href="#_1" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h1>
<div style="margin-top: -30px; font-size: 0.75em; opacity: 0.7;">
<p><span class="twemoji"><svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2A10 10 0 0 0 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10h-2a8 8 0 0 1-8 8 8 8 0 0 1-8-8 8 8 0 0 1 8-8zm6.78 1a.7.7 0 0 0-.48.2l-1.22 1.21 2.5 2.5L20.8 5.7c.26-.26.26-.7 0-.95L19.25 3.2c-.13-.13-.3-.2-.47-.2m-2.41 2.12L9 12.5V15h2.5l7.37-7.38z"></path></svg></span> 约<span class="heti-skip"><span class="heti-spacing"> </span>1189<span class="heti-spacing"> </span></span>个字 <span class="twemoji"><svg viewbox="0 0 640 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M392.8 1.2c-17-4.9-34.7 5-39.6 22l-128 448c-4.9 17 5 34.7 22 39.6s34.7-5 39.6-22l128-448c4.9-17-5-34.7-22-39.6m80.6 120.1c-12.5 12.5-12.5 32.8 0 45.3l89.3 89.4-89.4 89.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l112-112c12.5-12.5 12.5-32.8 0-45.3l-112-112c-12.5-12.5-32.8-12.5-45.3 0zm-306.7 0c-12.5-12.5-32.8-12.5-45.3 0l-112 112c-12.5 12.5-12.5 32.8 0 45.3l112 112c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L77.3 256l89.4-89.4c12.5-12.5 12.5-32.8 0-45.3"></path></svg></span> <span>1805<span class="heti-spacing"> </span></span>行代码 <span class="twemoji"><svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 20c4.42 0 8-3.58 8-8s-3.58-8-8-8-8 3.58-8 8 3.58 8 8 8m0-18c5.5 0 10 4.5 10 10s-4.5 10-10 10C6.47 22 2 17.5 2 12S6.5 2 12 2m.5 11H11V7h1.5v4.26l3.7-2.13.75 1.3z"></path></svg></span> 预计阅读时间<span class="heti-skip"><span class="heti-spacing"> </span>27<span class="heti-spacing"> </span></span>分钟</p>
</div>
<h2 id="_2">一、前端设计模块<a class="headerlink" href="#_2" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h2>
<h3 id="1-branch-predictor"><span>1.<span class="heti-spacing"> </span></span>分支预测器<span><span class="heti-spacing"> </span>(Branch Predictor)</span><a class="headerlink" href="#1-branch-predictor" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<h4 id="_3">具体规格<a class="headerlink" href="#_3" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<ol>
<li>整体架构</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Verilog</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1">1</a></span>
<span class="normal"><a href="#__codelineno-0-2">2</a></span>
<span class="normal"><a href="#__codelineno-0-3">3</a></span>
<span class="normal"><a href="#__codelineno-0-4">4</a></span>
<span class="normal"><a href="#__codelineno-0-5">5</a></span>
<span class="normal"><a href="#__codelineno-0-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="err">参数配置：</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="o">-</span><span class="w"> </span><span class="n">GHR长度</span><span class="err">：</span><span class="mh">16</span><span class="err">位</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="o">-</span><span class="w"> </span><span class="n">PHT大小</span><span class="err">：</span><span class="mh">16</span><span class="n">K表项</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="o">-</span><span class="w"> </span><span class="n">BTB大小</span><span class="err">：</span><span class="mh">4</span><span class="n">K表项</span>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="o">-</span><span class="w"> </span><span class="n">RAS深度</span><span class="err">：</span><span class="mh">16</span><span class="err">条目</span>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="o">-</span><span class="w"> </span><span class="err">预测带宽：每周期</span><span class="mh">4</span><span class="err">条指令</span>
</code></pre></div></td></tr></table></div>
<ol start="2">
<li>关键接口</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Verilog</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-1-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-1-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-1-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-1-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-1-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-1-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-1-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-1-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-1-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="c1">// 预测接口</span>
<a id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="k">input</span><span class="w">  </span><span class="p">[</span><span class="mh">63</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">pc_in</span><span class="p">,</span>
<a id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="k">output</span><span class="w"> </span><span class="p">[</span><span class="mh">63</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">pred_target</span><span class="p">,</span>
<a id="__codelineno-1-4" name="__codelineno-1-4"></a><span class="k">output</span><span class="w">        </span><span class="n">pred_taken</span><span class="p">,</span>
<a id="__codelineno-1-5" name="__codelineno-1-5"></a>
<a id="__codelineno-1-6" name="__codelineno-1-6"></a><span class="c1">// 更新接口</span>
<a id="__codelineno-1-7" name="__codelineno-1-7"></a><span class="k">input</span><span class="w">  </span><span class="p">[</span><span class="mh">63</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">update_pc</span><span class="p">,</span>
<a id="__codelineno-1-8" name="__codelineno-1-8"></a><span class="k">input</span><span class="w">         </span><span class="n">update_taken</span><span class="p">,</span>
<a id="__codelineno-1-9" name="__codelineno-1-9"></a><span class="k">input</span><span class="w">  </span><span class="p">[</span><span class="mh">63</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">update_target</span><span class="p">,</span>
<a id="__codelineno-1-10" name="__codelineno-1-10"></a><span class="k">input</span><span class="w">         </span><span class="n">update_valid</span>
</code></pre></div></td></tr></table></div>
<ol start="3">
<li>内部组件
   - GHR移位寄存器
   - PHT计数器阵列
   - BTB CAM结构
   - RAS堆栈实现</li>
</ol>
<h4 id="_4">核心算法<a class="headerlink" href="#_4" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<ol>
<li>双位饱和计数器</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Verilog</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-2-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-2-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-2-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-2-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-2-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-2-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-2-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-2-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-2-10">10</a></span>
<span class="normal"><a href="#__codelineno-2-11">11</a></span>
<span class="normal"><a href="#__codelineno-2-12">12</a></span>
<span class="normal"><a href="#__codelineno-2-13">13</a></span>
<span class="normal"><a href="#__codelineno-2-14">14</a></span>
<span class="normal"><a href="#__codelineno-2-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="c1">// 状态定义</span>
<a id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="k">parameter</span><span class="w"> </span><span class="n">ST</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">2</span><span class="mb">'b11</span><span class="p">;</span><span class="w">  </span><span class="c1">// 强取</span>
<a id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="k">parameter</span><span class="w"> </span><span class="n">WT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">2</span><span class="mb">'b10</span><span class="p">;</span><span class="w">  </span><span class="c1">// 弱取</span>
<a id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="k">parameter</span><span class="w"> </span><span class="n">WNT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">2</span><span class="mb">'b01</span><span class="p">;</span><span class="w"> </span><span class="c1">// 弱不取</span>
<a id="__codelineno-2-5" name="__codelineno-2-5"></a><span class="k">parameter</span><span class="w"> </span><span class="n">SNT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">2</span><span class="mb">'b00</span><span class="p">;</span><span class="w"> </span><span class="c1">// 强不取</span>
<a id="__codelineno-2-6" name="__codelineno-2-6"></a>
<a id="__codelineno-2-7" name="__codelineno-2-7"></a><span class="c1">// 更新逻辑</span>
<a id="__codelineno-2-8" name="__codelineno-2-8"></a><span class="k">always_comb</span><span class="w"> </span><span class="k">begin</span>
<a id="__codelineno-2-9" name="__codelineno-2-9"></a><span class="w">  </span><span class="k">case</span><span class="w"> </span><span class="p">(</span><span class="n">curr_state</span><span class="p">)</span>
<a id="__codelineno-2-10" name="__codelineno-2-10"></a><span class="w">    </span><span class="nl">ST:</span><span class="w"> </span><span class="n">next_state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">taken</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">ST</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">WT</span><span class="p">;</span>
<a id="__codelineno-2-11" name="__codelineno-2-11"></a><span class="w">    </span><span class="nl">WT:</span><span class="w"> </span><span class="n">next_state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">taken</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">ST</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">WNT</span><span class="p">;</span>
<a id="__codelineno-2-12" name="__codelineno-2-12"></a><span class="w">    </span><span class="nl">WNT:</span><span class="w"> </span><span class="n">next_state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">taken</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">WT</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">SNT</span><span class="p">;</span>
<a id="__codelineno-2-13" name="__codelineno-2-13"></a><span class="w">    </span><span class="nl">SNT:</span><span class="w"> </span><span class="n">next_state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">taken</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">WNT</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">SNT</span><span class="p">;</span>
<a id="__codelineno-2-14" name="__codelineno-2-14"></a><span class="w">  </span><span class="k">endcase</span>
<a id="__codelineno-2-15" name="__codelineno-2-15"></a><span class="k">end</span>
</code></pre></div></td></tr></table></div>
<ol start="2">
<li>预测逻辑</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Verilog</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1">1</a></span>
<span class="normal"><a href="#__codelineno-3-2">2</a></span>
<span class="normal"><a href="#__codelineno-3-3">3</a></span>
<span class="normal"><a href="#__codelineno-3-4">4</a></span>
<span class="normal"><a href="#__codelineno-3-5">5</a></span>
<span class="normal"><a href="#__codelineno-3-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="c1">// 索引计算</span>
<a id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="kt">wire</span><span class="w"> </span><span class="p">[</span><span class="mh">13</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">pht_index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">pc</span><span class="p">[</span><span class="mh">13</span><span class="o">:</span><span class="mh">2</span><span class="p">],</span><span class="w"> </span><span class="n">ghr</span><span class="p">[</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]};</span>
<a id="__codelineno-3-3" name="__codelineno-3-3"></a><span class="kt">wire</span><span class="w"> </span><span class="p">[</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">counter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pht</span><span class="p">[</span><span class="n">pht_index</span><span class="p">];</span>
<a id="__codelineno-3-4" name="__codelineno-3-4"></a>
<a id="__codelineno-3-5" name="__codelineno-3-5"></a><span class="c1">// 预测结果</span>
<a id="__codelineno-3-6" name="__codelineno-3-6"></a><span class="k">assign</span><span class="w"> </span><span class="n">pred_taken</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">counter</span><span class="p">[</span><span class="mh">1</span><span class="p">];</span>
</code></pre></div></td></tr></table></div>
<h4 id="_5">推荐课程<a class="headerlink" href="#_5" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<ol>
<li>
<p>主课程
   - CMU 18-447: Computer Architecture</p>
<ul>
<li>Lecture: Branch Prediction</li>
<li>Lab: Branch Predictor Implementation</li>
<li>MIT 6.823: Computer System Architecture</li>
<li>Advanced Branch Prediction Techniques</li>
</ul>
</li>
<li>
<p>论文研读
   - "Dynamic Branch Prediction with Perceptrons"
   - "A PPM-like, TAG-based Predictor"
   - "The YAGS Branch Prediction Scheme" </p>
</li>
</ol>
<h4 id="_6">验证策略<a class="headerlink" href="#_6" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<ol>
<li>单元测试</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Systemverilog</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-4-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-4-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-4-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-4-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-4-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-4-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-4-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-4-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-4-10">10</a></span>
<span class="normal"><a href="#__codelineno-4-11">11</a></span>
<span class="normal"><a href="#__codelineno-4-12">12</a></span>
<span class="normal"><a href="#__codelineno-4-13">13</a></span>
<span class="normal"><a href="#__codelineno-4-14">14</a></span>
<span class="normal"><a href="#__codelineno-4-15">15</a></span>
<span class="normal"><a href="#__codelineno-4-16">16</a></span>
<span class="normal"><a href="#__codelineno-4-17">17</a></span>
<span class="normal"><a href="#__codelineno-4-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="c1">// 基本功能测试</span>
<a id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="k">task</span><span class="w"> </span><span class="n">test_basic</span><span class="p">();</span>
<a id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="w">  </span><span class="c1">// 连续预测</span>
<a id="__codelineno-4-4" name="__codelineno-4-4"></a><span class="w">  </span><span class="n">drive_prediction</span><span class="p">(</span><span class="mh">64'h1000</span><span class="p">);</span>
<a id="__codelineno-4-5" name="__codelineno-4-5"></a><span class="w">  </span><span class="n">check_prediction</span><span class="p">(</span><span class="mb">1'b0</span><span class="p">);</span>
<a id="__codelineno-4-6" name="__codelineno-4-6"></a>
<a id="__codelineno-4-7" name="__codelineno-4-7"></a><span class="w">  </span><span class="c1">// 更新验证</span>
<a id="__codelineno-4-8" name="__codelineno-4-8"></a><span class="w">  </span><span class="n">update_predictor</span><span class="p">(</span><span class="mh">64'h1000</span><span class="p">,</span><span class="w"> </span><span class="mb">1'b1</span><span class="p">);</span>
<a id="__codelineno-4-9" name="__codelineno-4-9"></a><span class="w">  </span><span class="n">drive_prediction</span><span class="p">(</span><span class="mh">64'h1000</span><span class="p">);</span>
<a id="__codelineno-4-10" name="__codelineno-4-10"></a><span class="w">  </span><span class="n">check_prediction</span><span class="p">(</span><span class="mb">1'b1</span><span class="p">);</span>
<a id="__codelineno-4-11" name="__codelineno-4-11"></a><span class="k">endtask</span>
<a id="__codelineno-4-12" name="__codelineno-4-12"></a>
<a id="__codelineno-4-13" name="__codelineno-4-13"></a><span class="c1">// 边界条件</span>
<a id="__codelineno-4-14" name="__codelineno-4-14"></a><span class="k">task</span><span class="w"> </span><span class="n">test_corner_cases</span><span class="p">();</span>
<a id="__codelineno-4-15" name="__codelineno-4-15"></a><span class="w">  </span><span class="c1">// GHR全0/全1</span>
<a id="__codelineno-4-16" name="__codelineno-4-16"></a><span class="w">  </span><span class="c1">// PHT饱和情况</span>
<a id="__codelineno-4-17" name="__codelineno-4-17"></a><span class="w">  </span><span class="c1">// 快速方向切换</span>
<a id="__codelineno-4-18" name="__codelineno-4-18"></a><span class="k">endtask</span>
</code></pre></div></td></tr></table></div>
<ol start="2">
<li>性能测试</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1">1</a></span>
<span class="normal"><a href="#__codelineno-5-2">2</a></span>
<span class="normal"><a href="#__codelineno-5-3">3</a></span>
<span class="normal"><a href="#__codelineno-5-4">4</a></span>
<span class="normal"><a href="#__codelineno-5-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="c1"># 预测准确率测试</span>
<a id="__codelineno-5-2" name="__codelineno-5-2"></a>./run_bench.sh<span class="w"> </span>--bench<span class="w"> </span>coremark<span class="w"> </span>--pred-stats
<a id="__codelineno-5-3" name="__codelineno-5-3"></a>
<a id="__codelineno-5-4" name="__codelineno-5-4"></a><span class="c1"># 预测延迟测试</span>
<a id="__codelineno-5-5" name="__codelineno-5-5"></a>./measure_timing.sh<span class="w"> </span>--module<span class="w"> </span>branch_pred
</code></pre></div></td></tr></table></div>
<h4 id="_7">实现项目<a class="headerlink" href="#_7" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<ol>
<li>基础两级预测器</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Markdown</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-6-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-6-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-6-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-6-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-6-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-6-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-6-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-6-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-6-10">10</a></span>
<span class="normal"><a href="#__codelineno-6-11">11</a></span>
<span class="normal"><a href="#__codelineno-6-12">12</a></span>
<span class="normal"><a href="#__codelineno-6-13">13</a></span>
<span class="normal"><a href="#__codelineno-6-14">14</a></span>
<span class="normal"><a href="#__codelineno-6-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a>要求：
<a id="__codelineno-6-2" name="__codelineno-6-2"></a><span class="k">-</span><span class="w"> </span>GHR + PHT实现
<a id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="k">-</span><span class="w"> </span>基本BTB支持
<a id="__codelineno-6-4" name="__codelineno-6-4"></a><span class="k">-</span><span class="w"> </span>简单RAS
<a id="__codelineno-6-5" name="__codelineno-6-5"></a><span class="k">-</span><span class="w"> </span>更新逻辑
<a id="__codelineno-6-6" name="__codelineno-6-6"></a>
<a id="__codelineno-6-7" name="__codelineno-6-7"></a>步骤：
<a id="__codelineno-6-8" name="__codelineno-6-8"></a><span class="k">1.</span> GHR实现
<a id="__codelineno-6-9" name="__codelineno-6-9"></a><span class="k">2.</span> PHT表设计
<a id="__codelineno-6-10" name="__codelineno-6-10"></a><span class="k">3.</span> 预测逻辑
<a id="__codelineno-6-11" name="__codelineno-6-11"></a><span class="k">4.</span> 更新机制
<a id="__codelineno-6-12" name="__codelineno-6-12"></a>
<a id="__codelineno-6-13" name="__codelineno-6-13"></a>评估指标：
<a id="__codelineno-6-14" name="__codelineno-6-14"></a><span class="k">-</span><span class="w"> </span>预测准确率 &gt; 85%
<a id="__codelineno-6-15" name="__codelineno-6-15"></a><span class="k">-</span><span class="w"> </span>预测延迟 &lt; 2个周期
</code></pre></div></td></tr></table></div>
<ol start="2">
<li>高级混合预测器</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Markdown</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-7-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-7-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-7-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-7-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-7-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-7-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-7-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-7-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-7-10">10</a></span>
<span class="normal"><a href="#__codelineno-7-11">11</a></span>
<span class="normal"><a href="#__codelineno-7-12">12</a></span>
<span class="normal"><a href="#__codelineno-7-13">13</a></span>
<span class="normal"><a href="#__codelineno-7-14">14</a></span>
<span class="normal"><a href="#__codelineno-7-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1"></a>要求：
<a id="__codelineno-7-2" name="__codelineno-7-2"></a><span class="k">-</span><span class="w"> </span>Tournament预测器
<a id="__codelineno-7-3" name="__codelineno-7-3"></a><span class="k">-</span><span class="w"> </span>TAGE预测器组件
<a id="__codelineno-7-4" name="__codelineno-7-4"></a><span class="k">-</span><span class="w"> </span>动态选择机制
<a id="__codelineno-7-5" name="__codelineno-7-5"></a><span class="k">-</span><span class="w"> </span>预测confidence
<a id="__codelineno-7-6" name="__codelineno-7-6"></a>
<a id="__codelineno-7-7" name="__codelineno-7-7"></a>步骤：
<a id="__codelineno-7-8" name="__codelineno-7-8"></a><span class="k">1.</span> 基础预测器实现
<a id="__codelineno-7-9" name="__codelineno-7-9"></a><span class="k">2.</span> 元预测器设计
<a id="__codelineno-7-10" name="__codelineno-7-10"></a><span class="k">3.</span> 选择逻辑
<a id="__codelineno-7-11" name="__codelineno-7-11"></a><span class="k">4.</span> 性能优化
<a id="__codelineno-7-12" name="__codelineno-7-12"></a>
<a id="__codelineno-7-13" name="__codelineno-7-13"></a>评估指标：
<a id="__codelineno-7-14" name="__codelineno-7-14"></a><span class="k">-</span><span class="w"> </span>预测准确率 &gt; 95%
<a id="__codelineno-7-15" name="__codelineno-7-15"></a><span class="k">-</span><span class="w"> </span>选择准确率 &gt; 90%
</code></pre></div></td></tr></table></div>
<h3 id="2-instruction-fetch"><span>2.<span class="heti-spacing"> </span></span>取指单元<span><span class="heti-spacing"> </span>(Instruction Fetch)</span><a class="headerlink" href="#2-instruction-fetch" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<h4 id="_8">具体规格<a class="headerlink" href="#_8" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<ol>
<li>整体配置</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Verilog</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1">1</a></span>
<span class="normal"><a href="#__codelineno-8-2">2</a></span>
<span class="normal"><a href="#__codelineno-8-3">3</a></span>
<span class="normal"><a href="#__codelineno-8-4">4</a></span>
<span class="normal"><a href="#__codelineno-8-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="err">参数设置：</span>
<a id="__codelineno-8-2" name="__codelineno-8-2"></a><span class="o">-</span><span class="w"> </span><span class="err">取指宽度：</span><span class="mh">32</span><span class="n">B</span><span class="w"> </span><span class="p">(</span><span class="mh">8</span><span class="err">条</span><span class="n">RISC</span><span class="o">-</span><span class="n">V指令</span><span class="p">)</span>
<a id="__codelineno-8-3" name="__codelineno-8-3"></a><span class="o">-</span><span class="w"> </span><span class="err">指令队列深度：</span><span class="mh">16</span><span class="err">条指令</span>
<a id="__codelineno-8-4" name="__codelineno-8-4"></a><span class="o">-</span><span class="w"> </span><span class="err">预取深度：</span><span class="mh">2</span><span class="err">个</span><span class="n">cache</span><span class="w"> </span><span class="n">line</span>
<a id="__codelineno-8-5" name="__codelineno-8-5"></a><span class="o">-</span><span class="w"> </span><span class="err">指令对齐缓冲：</span><span class="mh">4</span><span class="err">条指令</span>
</code></pre></div></td></tr></table></div>
<ol start="2">
<li>关键接口</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Verilog</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-9-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-9-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-9-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-9-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-9-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-9-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-9-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-9-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-9-10">10</a></span>
<span class="normal"><a href="#__codelineno-9-11">11</a></span>
<span class="normal"><a href="#__codelineno-9-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="c1">// 取指接口</span>
<a id="__codelineno-9-2" name="__codelineno-9-2"></a><span class="k">output</span><span class="w"> </span><span class="p">[</span><span class="mh">31</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">inst_addr</span><span class="p">,</span>
<a id="__codelineno-9-3" name="__codelineno-9-3"></a><span class="k">input</span><span class="w">  </span><span class="p">[</span><span class="mh">255</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">inst_data</span><span class="p">,</span>
<a id="__codelineno-9-4" name="__codelineno-9-4"></a><span class="k">input</span><span class="w">          </span><span class="n">inst_valid</span><span class="p">,</span>
<a id="__codelineno-9-5" name="__codelineno-9-5"></a>
<a id="__codelineno-9-6" name="__codelineno-9-6"></a><span class="c1">// 预测接口</span>
<a id="__codelineno-9-7" name="__codelineno-9-7"></a><span class="k">input</span><span class="w">  </span><span class="p">[</span><span class="mh">63</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">pred_target</span><span class="p">,</span>
<a id="__codelineno-9-8" name="__codelineno-9-8"></a><span class="k">input</span><span class="w">         </span><span class="n">pred_taken</span><span class="p">,</span>
<a id="__codelineno-9-9" name="__codelineno-9-9"></a>
<a id="__codelineno-9-10" name="__codelineno-9-10"></a><span class="c1">// 反馈接口</span>
<a id="__codelineno-9-11" name="__codelineno-9-11"></a><span class="k">input</span><span class="w">         </span><span class="n">redirect_valid</span><span class="p">,</span>
<a id="__codelineno-9-12" name="__codelineno-9-12"></a><span class="k">input</span><span class="w">  </span><span class="p">[</span><span class="mh">63</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">redirect_pc</span>
</code></pre></div></td></tr></table></div>
<h4 id="_9">核心算法<a class="headerlink" href="#_9" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<ol>
<li>指令对齐</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Verilog</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-10-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-10-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-10-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-10-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-10-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-10-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-10-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-10-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-10-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="c1">// 对齐逻辑</span>
<a id="__codelineno-10-2" name="__codelineno-10-2"></a><span class="k">always_comb</span><span class="w"> </span><span class="k">begin</span>
<a id="__codelineno-10-3" name="__codelineno-10-3"></a><span class="w">  </span><span class="n">aligned_inst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mb">'b0</span><span class="p">;</span>
<a id="__codelineno-10-4" name="__codelineno-10-4"></a><span class="w">  </span><span class="k">case</span><span class="w"> </span><span class="p">(</span><span class="n">pc</span><span class="p">[</span><span class="mh">3</span><span class="o">:</span><span class="mh">0</span><span class="p">])</span>
<a id="__codelineno-10-5" name="__codelineno-10-5"></a><span class="w">    </span><span class="mh">4</span><span class="mb">'b0000</span><span class="o">:</span><span class="w"> </span><span class="n">aligned_inst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">inst_data</span><span class="p">[</span><span class="mh">31</span><span class="o">:</span><span class="mh">0</span><span class="p">];</span>
<a id="__codelineno-10-6" name="__codelineno-10-6"></a><span class="w">    </span><span class="mh">4</span><span class="mb">'b0100</span><span class="o">:</span><span class="w"> </span><span class="n">aligned_inst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">inst_data</span><span class="p">[</span><span class="mh">63</span><span class="o">:</span><span class="mh">32</span><span class="p">];</span>
<a id="__codelineno-10-7" name="__codelineno-10-7"></a><span class="w">    </span><span class="mh">4</span><span class="mb">'b1000</span><span class="o">:</span><span class="w"> </span><span class="n">aligned_inst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">inst_data</span><span class="p">[</span><span class="mh">95</span><span class="o">:</span><span class="mh">64</span><span class="p">];</span>
<a id="__codelineno-10-8" name="__codelineno-10-8"></a><span class="w">    </span><span class="mh">4</span><span class="mb">'b1100</span><span class="o">:</span><span class="w"> </span><span class="n">aligned_inst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">inst_data</span><span class="p">[</span><span class="mh">127</span><span class="o">:</span><span class="mh">96</span><span class="p">];</span>
<a id="__codelineno-10-9" name="__codelineno-10-9"></a><span class="w">  </span><span class="k">endcase</span>
<a id="__codelineno-10-10" name="__codelineno-10-10"></a><span class="k">end</span>
</code></pre></div></td></tr></table></div>
<ol start="2">
<li>预取控制</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Verilog</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-11-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-11-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-11-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-11-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-11-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-11-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-11-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-11-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-11-10">10</a></span>
<span class="normal"><a href="#__codelineno-11-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="c1">// 预取状态机</span>
<a id="__codelineno-11-2" name="__codelineno-11-2"></a><span class="k">typedef</span><span class="w"> </span><span class="k">enum</span><span class="w"> </span><span class="p">{</span><span class="n">IDLE</span><span class="p">,</span><span class="w"> </span><span class="n">FETCH</span><span class="p">,</span><span class="w"> </span><span class="n">WAIT</span><span class="p">}</span><span class="w"> </span><span class="n">state_t</span><span class="p">;</span>
<a id="__codelineno-11-3" name="__codelineno-11-3"></a><span class="n">state_t</span><span class="w"> </span><span class="n">curr_state</span><span class="p">,</span><span class="w"> </span><span class="n">next_state</span><span class="p">;</span>
<a id="__codelineno-11-4" name="__codelineno-11-4"></a>
<a id="__codelineno-11-5" name="__codelineno-11-5"></a><span class="k">always_ff</span><span class="w"> </span><span class="p">@(</span><span class="k">posedge</span><span class="w"> </span><span class="n">clk</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span>
<a id="__codelineno-11-6" name="__codelineno-11-6"></a><span class="w">  </span><span class="k">case</span><span class="w"> </span><span class="p">(</span><span class="n">curr_state</span><span class="p">)</span>
<a id="__codelineno-11-7" name="__codelineno-11-7"></a><span class="w">    </span><span class="nl">IDLE:</span><span class="w"> </span><span class="c1">// 检查预取条件</span>
<a id="__codelineno-11-8" name="__codelineno-11-8"></a><span class="w">    </span><span class="nl">FETCH:</span><span class="w"> </span><span class="c1">// 发送预取请求</span>
<a id="__codelineno-11-9" name="__codelineno-11-9"></a><span class="w">    </span><span class="nl">WAIT:</span><span class="w"> </span><span class="c1">// 等待数据返回</span>
<a id="__codelineno-11-10" name="__codelineno-11-10"></a><span class="w">  </span><span class="k">endcase</span>
<a id="__codelineno-11-11" name="__codelineno-11-11"></a><span class="k">end</span>
</code></pre></div></td></tr></table></div>
<h4 id="_10">推荐课程<a class="headerlink" href="#_10" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<ol>
<li>
<p>处理器设计课程
   - Berkeley CS152
   - Stanford EE382A
   - MIT 6.823</p>
</li>
<li>
<p>工程实践
   - RISC-V实现教程
   - Chisel Bootcamp
   - RTL设计实践</p>
</li>
</ol>
<h4 id="_11">项目实践<a class="headerlink" href="#_11" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<ol>
<li>基础取指单元</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Markdown</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-12-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-12-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-12-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-12-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-12-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-12-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-12-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-12-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-12-10">10</a></span>
<span class="normal"><a href="#__codelineno-12-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1"></a>功能要求：
<a id="__codelineno-12-2" name="__codelineno-12-2"></a><span class="k">-</span><span class="w"> </span>顺序取指
<a id="__codelineno-12-3" name="__codelineno-12-3"></a><span class="k">-</span><span class="w"> </span>指令缓冲
<a id="__codelineno-12-4" name="__codelineno-12-4"></a><span class="k">-</span><span class="w"> </span>基本预取
<a id="__codelineno-12-5" name="__codelineno-12-5"></a><span class="k">-</span><span class="w"> </span>分支处理
<a id="__codelineno-12-6" name="__codelineno-12-6"></a>
<a id="__codelineno-12-7" name="__codelineno-12-7"></a>实现步骤：
<a id="__codelineno-12-8" name="__codelineno-12-8"></a><span class="k">1.</span> PC生成逻辑
<a id="__codelineno-12-9" name="__codelineno-12-9"></a><span class="k">2.</span> 缓冲队列设计
<a id="__codelineno-12-10" name="__codelineno-12-10"></a><span class="k">3.</span> 预取控制器
<a id="__codelineno-12-11" name="__codelineno-12-11"></a><span class="k">4.</span> 分支恢复逻辑
</code></pre></div></td></tr></table></div>
<h3 id="3-rename-dispatch"><span>3.<span class="heti-spacing"> </span></span>重命名与分发模块<span><span class="heti-spacing"> </span>(Rename &amp; Dispatch)</span><a class="headerlink" href="#3-rename-dispatch" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<h4 id="_12">具体规格<a class="headerlink" href="#_12" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<ol>
<li>配置参数</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Verilog</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-13-1">1</a></span>
<span class="normal"><a href="#__codelineno-13-2">2</a></span>
<span class="normal"><a href="#__codelineno-13-3">3</a></span>
<span class="normal"><a href="#__codelineno-13-4">4</a></span>
<span class="normal"><a href="#__codelineno-13-5">5</a></span>
<span class="normal"><a href="#__codelineno-13-6">6</a></span>
<span class="normal"><a href="#__codelineno-13-7">7</a></span>
<span class="normal"><a href="#__codelineno-13-8">8</a></span>
<span class="normal"><a href="#__codelineno-13-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="c1">// 重命名配置</span>
<a id="__codelineno-13-2" name="__codelineno-13-2"></a><span class="k">parameter</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">PHY_REG_NUM</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="mh">128</span><span class="p">;</span><span class="w">   </span><span class="c1">// 物理寄存器数量</span>
<a id="__codelineno-13-3" name="__codelineno-13-3"></a><span class="k">parameter</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">ARCH_REG_NUM</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="mh">32</span><span class="p">;</span><span class="w">    </span><span class="c1">// 架构寄存器数量</span>
<a id="__codelineno-13-4" name="__codelineno-13-4"></a><span class="k">parameter</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">DISPATCH_WIDTH</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mh">4</span><span class="p">;</span><span class="w">     </span><span class="c1">// 每周期分发宽度</span>
<a id="__codelineno-13-5" name="__codelineno-13-5"></a><span class="k">parameter</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">ROB_INDEX_WIDTH</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">7</span><span class="p">;</span><span class="w">     </span><span class="c1">// ROB索引位宽</span>
<a id="__codelineno-13-6" name="__codelineno-13-6"></a>
<a id="__codelineno-13-7" name="__codelineno-13-7"></a><span class="c1">// 映射表配置</span>
<a id="__codelineno-13-8" name="__codelineno-13-8"></a><span class="k">parameter</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">RAT_ENTRIES</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ARCH_REG_NUM</span><span class="p">;</span>
<a id="__codelineno-13-9" name="__codelineno-13-9"></a><span class="k">parameter</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">FREE_LIST_SIZE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PHY_REG_NUM</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ARCH_REG_NUM</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
<ol start="2">
<li>关键接口</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Verilog</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-14-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-14-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-14-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-14-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-14-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-14-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-14-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-14-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-14-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-14-10">10</a></span>
<span class="normal"><a href="#__codelineno-14-11">11</a></span>
<span class="normal"><a href="#__codelineno-14-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="c1">// 重命名接口</span>
<a id="__codelineno-14-2" name="__codelineno-14-2"></a><span class="k">input</span><span class="w">  </span><span class="p">[</span><span class="n">DISPATCH_WIDTH</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">][</span><span class="mh">4</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">  </span><span class="n">arch_rs1</span><span class="p">,</span><span class="w">     </span><span class="c1">// 源寄存器1</span>
<a id="__codelineno-14-3" name="__codelineno-14-3"></a><span class="k">input</span><span class="w">  </span><span class="p">[</span><span class="n">DISPATCH_WIDTH</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">][</span><span class="mh">4</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">  </span><span class="n">arch_rs2</span><span class="p">,</span><span class="w">     </span><span class="c1">// 源寄存器2</span>
<a id="__codelineno-14-4" name="__codelineno-14-4"></a><span class="k">input</span><span class="w">  </span><span class="p">[</span><span class="n">DISPATCH_WIDTH</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">][</span><span class="mh">4</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">  </span><span class="n">arch_rd</span><span class="p">,</span><span class="w">      </span><span class="c1">// 目标寄存器</span>
<a id="__codelineno-14-5" name="__codelineno-14-5"></a><span class="k">output</span><span class="w"> </span><span class="p">[</span><span class="n">DISPATCH_WIDTH</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">][</span><span class="mh">6</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">  </span><span class="n">phy_rs1</span><span class="p">,</span><span class="w">      </span><span class="c1">// 重命名后源寄存器1</span>
<a id="__codelineno-14-6" name="__codelineno-14-6"></a><span class="k">output</span><span class="w"> </span><span class="p">[</span><span class="n">DISPATCH_WIDTH</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">][</span><span class="mh">6</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">  </span><span class="n">phy_rs2</span><span class="p">,</span><span class="w">      </span><span class="c1">// 重命名后源寄存器2</span>
<a id="__codelineno-14-7" name="__codelineno-14-7"></a><span class="k">output</span><span class="w"> </span><span class="p">[</span><span class="n">DISPATCH_WIDTH</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">][</span><span class="mh">6</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">  </span><span class="n">phy_rd</span><span class="p">,</span><span class="w">       </span><span class="c1">// 重命名后目标寄存器</span>
<a id="__codelineno-14-8" name="__codelineno-14-8"></a>
<a id="__codelineno-14-9" name="__codelineno-14-9"></a><span class="c1">// 快照接口</span>
<a id="__codelineno-14-10" name="__codelineno-14-10"></a><span class="k">output</span><span class="w"> </span><span class="n">rename_snapshot_t</span><span class="w">          </span><span class="n">snapshot_out</span><span class="p">,</span><span class="w">  </span><span class="c1">// 重命名状态快照</span>
<a id="__codelineno-14-11" name="__codelineno-14-11"></a><span class="k">input</span><span class="w">  </span><span class="n">rename_snapshot_t</span><span class="w">          </span><span class="n">snapshot_in</span><span class="p">,</span><span class="w">   </span><span class="c1">// 恢复用快照</span>
<a id="__codelineno-14-12" name="__codelineno-14-12"></a><span class="k">input</span><span class="w">                            </span><span class="n">recover_valid</span><span class="w">  </span><span class="c1">// 恢复信号</span>
</code></pre></div></td></tr></table></div>
<h4 id="_13">核心算法<a class="headerlink" href="#_13" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<ol>
<li>寄存器分配</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Verilog</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-15-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-15-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-15-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-15-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-15-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-15-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-15-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-15-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-15-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-15-10">10</a></span>
<span class="normal"><a href="#__codelineno-15-11">11</a></span>
<span class="normal"><a href="#__codelineno-15-12">12</a></span>
<span class="normal"><a href="#__codelineno-15-13">13</a></span>
<span class="normal"><a href="#__codelineno-15-14">14</a></span>
<span class="normal"><a href="#__codelineno-15-15">15</a></span>
<span class="normal"><a href="#__codelineno-15-16">16</a></span>
<span class="normal"><a href="#__codelineno-15-17">17</a></span>
<span class="normal"><a href="#__codelineno-15-18">18</a></span>
<span class="normal"><a href="#__codelineno-15-19">19</a></span>
<span class="normal"><a href="#__codelineno-15-20">20</a></span>
<span class="normal"><a href="#__codelineno-15-21">21</a></span>
<span class="normal"><a href="#__codelineno-15-22">22</a></span>
<span class="normal"><a href="#__codelineno-15-23">23</a></span>
<span class="normal"><a href="#__codelineno-15-24">24</a></span>
<span class="normal"><a href="#__codelineno-15-25">25</a></span>
<span class="normal"><a href="#__codelineno-15-26">26</a></span>
<span class="normal"><a href="#__codelineno-15-27">27</a></span>
<span class="normal"><a href="#__codelineno-15-28">28</a></span>
<span class="normal"><a href="#__codelineno-15-29">29</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="c1">// 空闲列表管理</span>
<a id="__codelineno-15-2" name="__codelineno-15-2"></a><span class="k">module</span><span class="w"> </span><span class="n">free_list</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-15-3" name="__codelineno-15-3"></a><span class="w">  </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="n">clk</span><span class="p">,</span>
<a id="__codelineno-15-4" name="__codelineno-15-4"></a><span class="w">  </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="n">rst_n</span><span class="p">,</span>
<a id="__codelineno-15-5" name="__codelineno-15-5"></a>
<a id="__codelineno-15-6" name="__codelineno-15-6"></a><span class="w">  </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="n">DISPATCH_WIDTH</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">alloc_req</span><span class="p">,</span>
<a id="__codelineno-15-7" name="__codelineno-15-7"></a><span class="w">  </span><span class="k">output</span><span class="w"> </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="n">DISPATCH_WIDTH</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">][</span><span class="mh">6</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">alloc_reg</span><span class="p">,</span>
<a id="__codelineno-15-8" name="__codelineno-15-8"></a><span class="w">  </span><span class="k">output</span><span class="w"> </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="n">DISPATCH_WIDTH</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">alloc_valid</span><span class="p">,</span>
<a id="__codelineno-15-9" name="__codelineno-15-9"></a>
<a id="__codelineno-15-10" name="__codelineno-15-10"></a><span class="w">  </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="mh">3</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">free_req</span><span class="p">,</span>
<a id="__codelineno-15-11" name="__codelineno-15-11"></a><span class="w">  </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="mh">6</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">free_reg</span><span class="w"> </span><span class="p">[</span><span class="mh">3</span><span class="o">:</span><span class="mh">0</span><span class="p">],</span>
<a id="__codelineno-15-12" name="__codelineno-15-12"></a>
<a id="__codelineno-15-13" name="__codelineno-15-13"></a><span class="w">  </span><span class="k">output</span><span class="w"> </span><span class="kt">logic</span><span class="w"> </span><span class="n">empty</span>
<a id="__codelineno-15-14" name="__codelineno-15-14"></a><span class="p">);</span>
<a id="__codelineno-15-15" name="__codelineno-15-15"></a>
<a id="__codelineno-15-16" name="__codelineno-15-16"></a><span class="c1">// 循环队列实现</span>
<a id="__codelineno-15-17" name="__codelineno-15-17"></a><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="mh">6</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">queue</span><span class="w"> </span><span class="p">[</span><span class="n">FREE_LIST_SIZE</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">];</span>
<a id="__codelineno-15-18" name="__codelineno-15-18"></a><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="n">$clog2</span><span class="p">(</span><span class="n">FREE_LIST_SIZE</span><span class="p">)</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">head</span><span class="p">,</span><span class="w"> </span><span class="n">tail</span><span class="p">;</span>
<a id="__codelineno-15-19" name="__codelineno-15-19"></a>
<a id="__codelineno-15-20" name="__codelineno-15-20"></a><span class="c1">// 分配逻辑</span>
<a id="__codelineno-15-21" name="__codelineno-15-21"></a><span class="k">always_comb</span><span class="w"> </span><span class="k">begin</span>
<a id="__codelineno-15-22" name="__codelineno-15-22"></a><span class="w">  </span><span class="n">alloc_valid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">'0</span><span class="p">;</span>
<a id="__codelineno-15-23" name="__codelineno-15-23"></a><span class="w">  </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">DISPATCH_WIDTH</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span>
<a id="__codelineno-15-24" name="__codelineno-15-24"></a><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">empty</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">alloc_req</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="w"> </span><span class="k">begin</span>
<a id="__codelineno-15-25" name="__codelineno-15-25"></a><span class="w">      </span><span class="n">alloc_reg</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">queue</span><span class="p">[</span><span class="n">head</span><span class="o">+</span><span class="n">i</span><span class="p">];</span>
<a id="__codelineno-15-26" name="__codelineno-15-26"></a><span class="w">      </span><span class="n">alloc_valid</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="mb">'b1</span><span class="p">;</span>
<a id="__codelineno-15-27" name="__codelineno-15-27"></a><span class="w">    </span><span class="k">end</span>
<a id="__codelineno-15-28" name="__codelineno-15-28"></a><span class="w">  </span><span class="k">end</span>
<a id="__codelineno-15-29" name="__codelineno-15-29"></a><span class="k">end</span>
</code></pre></div></td></tr></table></div>
<ol start="2">
<li>依赖检查</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Verilog</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-16-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-16-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-16-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-16-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-16-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-16-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-16-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-16-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-16-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-16-10">10</a></span>
<span class="normal"><a href="#__codelineno-16-11">11</a></span>
<span class="normal"><a href="#__codelineno-16-12">12</a></span>
<span class="normal"><a href="#__codelineno-16-13">13</a></span>
<span class="normal"><a href="#__codelineno-16-14">14</a></span>
<span class="normal"><a href="#__codelineno-16-15">15</a></span>
<span class="normal"><a href="#__codelineno-16-16">16</a></span>
<span class="normal"><a href="#__codelineno-16-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="c1">// WAW, RAW依赖检查</span>
<a id="__codelineno-16-2" name="__codelineno-16-2"></a><span class="k">module</span><span class="w"> </span><span class="n">dependency_check</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-16-3" name="__codelineno-16-3"></a><span class="w">  </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="n">DISPATCH_WIDTH</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">][</span><span class="mh">4</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">rs1</span><span class="p">,</span>
<a id="__codelineno-16-4" name="__codelineno-16-4"></a><span class="w">  </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="n">DISPATCH_WIDTH</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">][</span><span class="mh">4</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">rs2</span><span class="p">,</span>
<a id="__codelineno-16-5" name="__codelineno-16-5"></a><span class="w">  </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="n">DISPATCH_WIDTH</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">][</span><span class="mh">4</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">rd</span><span class="p">,</span>
<a id="__codelineno-16-6" name="__codelineno-16-6"></a><span class="w">  </span><span class="k">output</span><span class="w"> </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="n">DISPATCH_WIDTH</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">][</span><span class="n">DISPATCH_WIDTH</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">dep_matrix</span>
<a id="__codelineno-16-7" name="__codelineno-16-7"></a><span class="p">);</span>
<a id="__codelineno-16-8" name="__codelineno-16-8"></a>
<a id="__codelineno-16-9" name="__codelineno-16-9"></a><span class="c1">// 依赖矩阵生成</span>
<a id="__codelineno-16-10" name="__codelineno-16-10"></a><span class="k">always_comb</span><span class="w"> </span><span class="k">begin</span>
<a id="__codelineno-16-11" name="__codelineno-16-11"></a><span class="w">  </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">DISPATCH_WIDTH</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span>
<a id="__codelineno-16-12" name="__codelineno-16-12"></a><span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">&lt;</span><span class="n">DISPATCH_WIDTH</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span>
<a id="__codelineno-16-13" name="__codelineno-16-13"></a><span class="w">      </span><span class="n">dep_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">rd</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mh">0</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>
<a id="__codelineno-16-14" name="__codelineno-16-14"></a><span class="w">                        </span><span class="p">((</span><span class="n">rd</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">rs1</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">(</span><span class="n">rd</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">rs2</span><span class="p">[</span><span class="n">j</span><span class="p">]));</span>
<a id="__codelineno-16-15" name="__codelineno-16-15"></a><span class="w">    </span><span class="k">end</span>
<a id="__codelineno-16-16" name="__codelineno-16-16"></a><span class="w">  </span><span class="k">end</span>
<a id="__codelineno-16-17" name="__codelineno-16-17"></a><span class="k">end</span>
</code></pre></div></td></tr></table></div>
<h4 id="_14">推荐课程<a class="headerlink" href="#_14" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<ol>
<li>
<p>主要课程
   - MIT 6.823 - Lecture: Register Renaming
   - Berkeley CS152 - Out-of-Order Execution
   - Stanford EE382A - Superscalar Processors</p>
</li>
<li>
<p>论文学习
   - "Register Renaming Techniques for Out-of-Order Processors"
   - "Physical Register Inlining"
   - "Virtual Physical Registers"</p>
</li>
</ol>
<h4 id="_15">验证策略<a class="headerlink" href="#_15" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<ol>
<li>单元测试</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Systemverilog</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-17-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-17-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-17-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-17-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-17-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-17-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-17-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-17-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-17-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-17-10">10</a></span>
<span class="normal"><a href="#__codelineno-17-11">11</a></span>
<span class="normal"><a href="#__codelineno-17-12">12</a></span>
<span class="normal"><a href="#__codelineno-17-13">13</a></span>
<span class="normal"><a href="#__codelineno-17-14">14</a></span>
<span class="normal"><a href="#__codelineno-17-15">15</a></span>
<span class="normal"><a href="#__codelineno-17-16">16</a></span>
<span class="normal"><a href="#__codelineno-17-17">17</a></span>
<span class="normal"><a href="#__codelineno-17-18">18</a></span>
<span class="normal"><a href="#__codelineno-17-19">19</a></span>
<span class="normal"><a href="#__codelineno-17-20">20</a></span>
<span class="normal"><a href="#__codelineno-17-21">21</a></span>
<span class="normal"><a href="#__codelineno-17-22">22</a></span>
<span class="normal"><a href="#__codelineno-17-23">23</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="c1">// 基本重命名测试</span>
<a id="__codelineno-17-2" name="__codelineno-17-2"></a><span class="k">task</span><span class="w"> </span><span class="n">test_basic_rename</span><span class="p">();</span>
<a id="__codelineno-17-3" name="__codelineno-17-3"></a><span class="w">  </span><span class="c1">// 单指令重命名</span>
<a id="__codelineno-17-4" name="__codelineno-17-4"></a><span class="w">  </span><span class="n">test_single_inst_rename</span><span class="p">();</span>
<a id="__codelineno-17-5" name="__codelineno-17-5"></a>
<a id="__codelineno-17-6" name="__codelineno-17-6"></a><span class="w">  </span><span class="c1">// 多指令并行重命名</span>
<a id="__codelineno-17-7" name="__codelineno-17-7"></a><span class="w">  </span><span class="n">test_parallel_rename</span><span class="p">();</span>
<a id="__codelineno-17-8" name="__codelineno-17-8"></a>
<a id="__codelineno-17-9" name="__codelineno-17-9"></a><span class="w">  </span><span class="c1">// 依赖检查</span>
<a id="__codelineno-17-10" name="__codelineno-17-10"></a><span class="w">  </span><span class="n">test_dependency_check</span><span class="p">();</span>
<a id="__codelineno-17-11" name="__codelineno-17-11"></a><span class="k">endtask</span>
<a id="__codelineno-17-12" name="__codelineno-17-12"></a>
<a id="__codelineno-17-13" name="__codelineno-17-13"></a><span class="c1">// 快照恢复测试</span>
<a id="__codelineno-17-14" name="__codelineno-17-14"></a><span class="k">task</span><span class="w"> </span><span class="n">test_snapshot_recovery</span><span class="p">();</span>
<a id="__codelineno-17-15" name="__codelineno-17-15"></a><span class="w">  </span><span class="c1">// 生成快照</span>
<a id="__codelineno-17-16" name="__codelineno-17-16"></a><span class="w">  </span><span class="n">create_snapshot</span><span class="p">();</span>
<a id="__codelineno-17-17" name="__codelineno-17-17"></a>
<a id="__codelineno-17-18" name="__codelineno-17-18"></a><span class="w">  </span><span class="c1">// 执行重命名</span>
<a id="__codelineno-17-19" name="__codelineno-17-19"></a><span class="w">  </span><span class="n">execute_renames</span><span class="p">();</span>
<a id="__codelineno-17-20" name="__codelineno-17-20"></a>
<a id="__codelineno-17-21" name="__codelineno-17-21"></a><span class="w">  </span><span class="c1">// 验证恢复</span>
<a id="__codelineno-17-22" name="__codelineno-17-22"></a><span class="w">  </span><span class="n">verify_recovery</span><span class="p">();</span>
<a id="__codelineno-17-23" name="__codelineno-17-23"></a><span class="k">endtask</span>
</code></pre></div></td></tr></table></div>
<ol start="2">
<li>性能测试</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-18-1">1</a></span>
<span class="normal"><a href="#__codelineno-18-2">2</a></span>
<span class="normal"><a href="#__codelineno-18-3">3</a></span>
<span class="normal"><a href="#__codelineno-18-4">4</a></span>
<span class="normal"><a href="#__codelineno-18-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="c1"># 重命名带宽测试</span>
<a id="__codelineno-18-2" name="__codelineno-18-2"></a>./perf_test.sh<span class="w"> </span>--module<span class="w"> </span>rename<span class="w"> </span>--test<span class="w"> </span>bandwidth
<a id="__codelineno-18-3" name="__codelineno-18-3"></a>
<a id="__codelineno-18-4" name="__codelineno-18-4"></a><span class="c1"># 依赖检测延迟测试</span>
<a id="__codelineno-18-5" name="__codelineno-18-5"></a>./perf_test.sh<span class="w"> </span>--module<span class="w"> </span>rename<span class="w"> </span>--test<span class="w"> </span>dependency
</code></pre></div></td></tr></table></div>
<h4 id="_16">实现项目<a class="headerlink" href="#_16" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<ol>
<li>基础重命名器</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Markdown</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-19-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-19-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-19-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-19-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-19-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-19-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-19-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-19-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-19-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-19-10">10</a></span>
<span class="normal"><a href="#__codelineno-19-11">11</a></span>
<span class="normal"><a href="#__codelineno-19-12">12</a></span>
<span class="normal"><a href="#__codelineno-19-13">13</a></span>
<span class="normal"><a href="#__codelineno-19-14">14</a></span>
<span class="normal"><a href="#__codelineno-19-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1"></a>要求：
<a id="__codelineno-19-2" name="__codelineno-19-2"></a><span class="k">-</span><span class="w"> </span>支持单周期4指令重命名
<a id="__codelineno-19-3" name="__codelineno-19-3"></a><span class="k">-</span><span class="w"> </span>实现基本RAT
<a id="__codelineno-19-4" name="__codelineno-19-4"></a><span class="k">-</span><span class="w"> </span>空闲列表管理
<a id="__codelineno-19-5" name="__codelineno-19-5"></a><span class="k">-</span><span class="w"> </span>快照机制
<a id="__codelineno-19-6" name="__codelineno-19-6"></a>
<a id="__codelineno-19-7" name="__codelineno-19-7"></a>步骤：
<a id="__codelineno-19-8" name="__codelineno-19-8"></a><span class="k">1.</span> RAT实现
<a id="__codelineno-19-9" name="__codelineno-19-9"></a><span class="k">2.</span> 空闲列表设计
<a id="__codelineno-19-10" name="__codelineno-19-10"></a><span class="k">3.</span> 重命名逻辑
<a id="__codelineno-19-11" name="__codelineno-19-11"></a><span class="k">4.</span> 快照机制
<a id="__codelineno-19-12" name="__codelineno-19-12"></a>
<a id="__codelineno-19-13" name="__codelineno-19-13"></a>评估指标：
<a id="__codelineno-19-14" name="__codelineno-19-14"></a><span class="k">-</span><span class="w"> </span>重命名延迟 &lt; 1周期
<a id="__codelineno-19-15" name="__codelineno-19-15"></a><span class="k">-</span><span class="w"> </span>资源利用率 &gt; 90%
</code></pre></div></td></tr></table></div>
<ol start="2">
<li>高级重命名系统</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Markdown</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-20-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-20-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-20-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-20-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-20-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-20-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-20-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-20-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-20-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-20-10">10</a></span>
<span class="normal"><a href="#__codelineno-20-11">11</a></span>
<span class="normal"><a href="#__codelineno-20-12">12</a></span>
<span class="normal"><a href="#__codelineno-20-13">13</a></span>
<span class="normal"><a href="#__codelineno-20-14">14</a></span>
<span class="normal"><a href="#__codelineno-20-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1"></a>要求：
<a id="__codelineno-20-2" name="__codelineno-20-2"></a><span class="k">-</span><span class="w"> </span>多周期流水线设计
<a id="__codelineno-20-3" name="__codelineno-20-3"></a><span class="k">-</span><span class="w"> </span>投机执行支持
<a id="__codelineno-20-4" name="__codelineno-20-4"></a><span class="k">-</span><span class="w"> </span>分支预测整合
<a id="__codelineno-20-5" name="__codelineno-20-5"></a><span class="k">-</span><span class="w"> </span>性能优化
<a id="__codelineno-20-6" name="__codelineno-20-6"></a>
<a id="__codelineno-20-7" name="__codelineno-20-7"></a>步骤：
<a id="__codelineno-20-8" name="__codelineno-20-8"></a><span class="k">1.</span> 流水线设计
<a id="__codelineno-20-9" name="__codelineno-20-9"></a><span class="k">2.</span> 投机状态管理
<a id="__codelineno-20-10" name="__codelineno-20-10"></a><span class="k">3.</span> 分支预测整合
<a id="__codelineno-20-11" name="__codelineno-20-11"></a><span class="k">4.</span> 性能优化
<a id="__codelineno-20-12" name="__codelineno-20-12"></a>
<a id="__codelineno-20-13" name="__codelineno-20-13"></a>评估指标：
<a id="__codelineno-20-14" name="__codelineno-20-14"></a><span class="k">-</span><span class="w"> </span>重命名带宽 &gt;= 8指令/周期
<a id="__codelineno-20-15" name="__codelineno-20-15"></a><span class="k">-</span><span class="w"> </span>预测恢复延迟 &lt;= 2周期
</code></pre></div></td></tr></table></div>
<h3 id="4-reservation-station"><span>4.<span class="heti-spacing"> </span></span>保留站<span><span class="heti-spacing"> </span>(Reservation Station)</span><a class="headerlink" href="#4-reservation-station" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<h4 id="_17">具体规格<a class="headerlink" href="#_17" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<ol>
<li>配置参数</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Verilog</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-21-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-21-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-21-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-21-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-21-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-21-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-21-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-21-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-21-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-21-10">10</a></span>
<span class="normal"><a href="#__codelineno-21-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1"></a><span class="c1">// 保留站配置</span>
<a id="__codelineno-21-2" name="__codelineno-21-2"></a><span class="k">parameter</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">ALU_RS_SIZE</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="mh">16</span><span class="p">;</span><span class="w">    </span><span class="c1">// ALU保留站条目</span>
<a id="__codelineno-21-3" name="__codelineno-21-3"></a><span class="k">parameter</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">MUL_RS_SIZE</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="mh">4</span><span class="p">;</span><span class="w">     </span><span class="c1">// 乘法保留站条目</span>
<a id="__codelineno-21-4" name="__codelineno-21-4"></a><span class="k">parameter</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">DIV_RS_SIZE</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="mh">2</span><span class="p">;</span><span class="w">     </span><span class="c1">// 除法保留站条目</span>
<a id="__codelineno-21-5" name="__codelineno-21-5"></a><span class="k">parameter</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">LSU_RS_SIZE</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="mh">12</span><span class="p">;</span><span class="w">    </span><span class="c1">// 访存保留站条目</span>
<a id="__codelineno-21-6" name="__codelineno-21-6"></a><span class="k">parameter</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">DISPATCH_WIDTH</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">4</span><span class="p">;</span><span class="w">     </span><span class="c1">// 分发宽度</span>
<a id="__codelineno-21-7" name="__codelineno-21-7"></a><span class="k">parameter</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">ISSUE_WIDTH</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="mh">4</span><span class="p">;</span><span class="w">     </span><span class="c1">// 发射宽度</span>
<a id="__codelineno-21-8" name="__codelineno-21-8"></a>
<a id="__codelineno-21-9" name="__codelineno-21-9"></a><span class="c1">// 数据路径配置</span>
<a id="__codelineno-21-10" name="__codelineno-21-10"></a><span class="k">parameter</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">DATA_WIDTH</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="mh">64</span><span class="p">;</span><span class="w">    </span><span class="c1">// 数据位宽</span>
<a id="__codelineno-21-11" name="__codelineno-21-11"></a><span class="k">parameter</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">TAG_WIDTH</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="mh">7</span><span class="p">;</span><span class="w">     </span><span class="c1">// 标签位宽</span>
</code></pre></div></td></tr></table></div>
<ol start="2">
<li>接口定义</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Verilog</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-22-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-22-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-22-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-22-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-22-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-22-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-22-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-22-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-22-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-22-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1"></a><span class="c1">// 分发接口</span>
<a id="__codelineno-22-2" name="__codelineno-22-2"></a><span class="k">input</span><span class="w">  </span><span class="n">dispatch_req_t</span><span class="w"> </span><span class="p">[</span><span class="n">DISPATCH_WIDTH</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">dispatch_req</span><span class="p">,</span>
<a id="__codelineno-22-3" name="__codelineno-22-3"></a><span class="k">output</span><span class="w"> </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="n">DISPATCH_WIDTH</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">          </span><span class="n">dispatch_ready</span><span class="p">,</span>
<a id="__codelineno-22-4" name="__codelineno-22-4"></a>
<a id="__codelineno-22-5" name="__codelineno-22-5"></a><span class="c1">// 唤醒接口</span>
<a id="__codelineno-22-6" name="__codelineno-22-6"></a><span class="k">input</span><span class="w">  </span><span class="n">complete_t</span><span class="w"> </span><span class="p">[</span><span class="n">ISSUE_WIDTH</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">        </span><span class="n">complete_info</span><span class="p">,</span>
<a id="__codelineno-22-7" name="__codelineno-22-7"></a>
<a id="__codelineno-22-8" name="__codelineno-22-8"></a><span class="c1">// 发射接口</span>
<a id="__codelineno-22-9" name="__codelineno-22-9"></a><span class="k">output</span><span class="w"> </span><span class="n">issue_req_t</span><span class="w"> </span><span class="p">[</span><span class="n">ISSUE_WIDTH</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">       </span><span class="n">issue_req</span><span class="p">,</span>
<a id="__codelineno-22-10" name="__codelineno-22-10"></a><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="n">ISSUE_WIDTH</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">             </span><span class="n">issue_grant</span>
</code></pre></div></td></tr></table></div>
<h4 id="_18">核心算法<a class="headerlink" href="#_18" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<ol>
<li>分发选择</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Verilog</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-23-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-23-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-23-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-23-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-23-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-23-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-23-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-23-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-23-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-23-10">10</a></span>
<span class="normal"><a href="#__codelineno-23-11">11</a></span>
<span class="normal"><a href="#__codelineno-23-12">12</a></span>
<span class="normal"><a href="#__codelineno-23-13">13</a></span>
<span class="normal"><a href="#__codelineno-23-14">14</a></span>
<span class="normal"><a href="#__codelineno-23-15">15</a></span>
<span class="normal"><a href="#__codelineno-23-16">16</a></span>
<span class="normal"><a href="#__codelineno-23-17">17</a></span>
<span class="normal"><a href="#__codelineno-23-18">18</a></span>
<span class="normal"><a href="#__codelineno-23-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1"></a><span class="c1">// 空闲条目选择</span>
<a id="__codelineno-23-2" name="__codelineno-23-2"></a><span class="k">module</span><span class="w"> </span><span class="n">entry_allocator</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-23-3" name="__codelineno-23-3"></a><span class="w">  </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="n">RS_SIZE</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">free_mask</span><span class="p">,</span>
<a id="__codelineno-23-4" name="__codelineno-23-4"></a><span class="w">  </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="n">DISPATCH_WIDTH</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">req</span><span class="p">,</span>
<a id="__codelineno-23-5" name="__codelineno-23-5"></a><span class="w">  </span><span class="k">output</span><span class="w"> </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="n">DISPATCH_WIDTH</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">][</span><span class="n">RS_SIZE</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">alloc_mask</span>
<a id="__codelineno-23-6" name="__codelineno-23-6"></a><span class="p">);</span>
<a id="__codelineno-23-7" name="__codelineno-23-7"></a>
<a id="__codelineno-23-8" name="__codelineno-23-8"></a><span class="c1">// 优先级编码器实现</span>
<a id="__codelineno-23-9" name="__codelineno-23-9"></a><span class="k">always_comb</span><span class="w"> </span><span class="k">begin</span>
<a id="__codelineno-23-10" name="__codelineno-23-10"></a><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span>
<a id="__codelineno-23-11" name="__codelineno-23-11"></a><span class="w">  </span><span class="n">alloc_mask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">'0</span><span class="p">;</span>
<a id="__codelineno-23-12" name="__codelineno-23-12"></a>
<a id="__codelineno-23-13" name="__codelineno-23-13"></a><span class="w">  </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">DISPATCH_WIDTH</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span>
<a id="__codelineno-23-14" name="__codelineno-23-14"></a><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">req</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="w"> </span><span class="k">begin</span>
<a id="__codelineno-23-15" name="__codelineno-23-15"></a><span class="w">      </span><span class="n">alloc_mask</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_first_free</span><span class="p">(</span><span class="n">free_mask</span><span class="p">,</span><span class="w"> </span><span class="n">count</span><span class="p">);</span>
<a id="__codelineno-23-16" name="__codelineno-23-16"></a><span class="w">      </span><span class="n">count</span><span class="o">++</span><span class="p">;</span>
<a id="__codelineno-23-17" name="__codelineno-23-17"></a><span class="w">    </span><span class="k">end</span>
<a id="__codelineno-23-18" name="__codelineno-23-18"></a><span class="w">  </span><span class="k">end</span>
<a id="__codelineno-23-19" name="__codelineno-23-19"></a><span class="k">end</span>
</code></pre></div></td></tr></table></div>
<ol start="2">
<li>唤醒选择</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Verilog</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-24-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-24-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-24-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-24-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-24-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-24-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-24-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-24-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-24-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-24-10">10</a></span>
<span class="normal"><a href="#__codelineno-24-11">11</a></span>
<span class="normal"><a href="#__codelineno-24-12">12</a></span>
<span class="normal"><a href="#__codelineno-24-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1"></a><span class="c1">// 源操作数匹配</span>
<a id="__codelineno-24-2" name="__codelineno-24-2"></a><span class="k">always_comb</span><span class="w"> </span><span class="k">begin</span>
<a id="__codelineno-24-3" name="__codelineno-24-3"></a><span class="w">  </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">RS_SIZE</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span>
<a id="__codelineno-24-4" name="__codelineno-24-4"></a><span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="o">=</span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">&lt;</span><span class="n">ISSUE_WIDTH</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span>
<a id="__codelineno-24-5" name="__codelineno-24-5"></a><span class="w">      </span><span class="k">if</span><span class="p">(</span><span class="n">rs_entry</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">valid</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span>
<a id="__codelineno-24-6" name="__codelineno-24-6"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">complete_info</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">tag</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">rs_entry</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">src1_tag</span><span class="p">)</span>
<a id="__codelineno-24-7" name="__codelineno-24-7"></a><span class="w">          </span><span class="n">rs_entry</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">src1_ready</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="mb">'b1</span><span class="p">;</span>
<a id="__codelineno-24-8" name="__codelineno-24-8"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">complete_info</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">tag</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">rs_entry</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">src2_tag</span><span class="p">)</span>
<a id="__codelineno-24-9" name="__codelineno-24-9"></a><span class="w">          </span><span class="n">rs_entry</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">src2_ready</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="mb">'b1</span><span class="p">;</span>
<a id="__codelineno-24-10" name="__codelineno-24-10"></a><span class="w">      </span><span class="k">end</span>
<a id="__codelineno-24-11" name="__codelineno-24-11"></a><span class="w">    </span><span class="k">end</span>
<a id="__codelineno-24-12" name="__codelineno-24-12"></a><span class="w">  </span><span class="k">end</span>
<a id="__codelineno-24-13" name="__codelineno-24-13"></a><span class="k">end</span>
</code></pre></div></td></tr></table></div>
<h4 id="_19">推荐课程<a class="headerlink" href="#_19" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<ol>
<li>
<p>处理器设计课程
   - CMU 18-447: Lecture on Out-of-Order Execution
   - Berkeley CS152: Reservation Stations
   - MIT 6.823: Dynamic Scheduling</p>
</li>
<li>
<p>论文研究
   - "The Reservation Station and Dependencies"
   - "Complexity-Effective Superscalar Processors"</p>
</li>
</ol>
<h4 id="_20">验证策略<a class="headerlink" href="#_20" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<ol>
<li>功能测试</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Systemverilog</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-25-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-25-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-25-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-25-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-25-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-25-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-25-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-25-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-25-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-25-10">10</a></span>
<span class="normal"><a href="#__codelineno-25-11">11</a></span>
<span class="normal"><a href="#__codelineno-25-12">12</a></span>
<span class="normal"><a href="#__codelineno-25-13">13</a></span>
<span class="normal"><a href="#__codelineno-25-14">14</a></span>
<span class="normal"><a href="#__codelineno-25-15">15</a></span>
<span class="normal"><a href="#__codelineno-25-16">16</a></span>
<span class="normal"><a href="#__codelineno-25-17">17</a></span>
<span class="normal"><a href="#__codelineno-25-18">18</a></span>
<span class="normal"><a href="#__codelineno-25-19">19</a></span>
<span class="normal"><a href="#__codelineno-25-20">20</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1"></a><span class="c1">// 基本功能测试</span>
<a id="__codelineno-25-2" name="__codelineno-25-2"></a><span class="k">task</span><span class="w"> </span><span class="n">test_basic_functions</span><span class="p">();</span>
<a id="__codelineno-25-3" name="__codelineno-25-3"></a><span class="w">  </span><span class="c1">// 分发测试</span>
<a id="__codelineno-25-4" name="__codelineno-25-4"></a><span class="w">  </span><span class="n">test_dispatch</span><span class="p">();</span>
<a id="__codelineno-25-5" name="__codelineno-25-5"></a>
<a id="__codelineno-25-6" name="__codelineno-25-6"></a><span class="w">  </span><span class="c1">// 唤醒测试</span>
<a id="__codelineno-25-7" name="__codelineno-25-7"></a><span class="w">  </span><span class="n">test_wakeup</span><span class="p">();</span>
<a id="__codelineno-25-8" name="__codelineno-25-8"></a>
<a id="__codelineno-25-9" name="__codelineno-25-9"></a><span class="w">  </span><span class="c1">// 发射测试</span>
<a id="__codelineno-25-10" name="__codelineno-25-10"></a><span class="w">  </span><span class="n">test_issue</span><span class="p">();</span>
<a id="__codelineno-25-11" name="__codelineno-25-11"></a><span class="k">endtask</span>
<a id="__codelineno-25-12" name="__codelineno-25-12"></a>
<a id="__codelineno-25-13" name="__codelineno-25-13"></a><span class="c1">// 压力测试</span>
<a id="__codelineno-25-14" name="__codelineno-25-14"></a><span class="k">task</span><span class="w"> </span><span class="n">test_stress</span><span class="p">();</span>
<a id="__codelineno-25-15" name="__codelineno-25-15"></a><span class="w">  </span><span class="c1">// 满载测试</span>
<a id="__codelineno-25-16" name="__codelineno-25-16"></a><span class="w">  </span><span class="n">test_full_utilization</span><span class="p">();</span>
<a id="__codelineno-25-17" name="__codelineno-25-17"></a>
<a id="__codelineno-25-18" name="__codelineno-25-18"></a><span class="w">  </span><span class="c1">// 竞争测试</span>
<a id="__codelineno-25-19" name="__codelineno-25-19"></a><span class="w">  </span><span class="n">test_resource_contention</span><span class="p">();</span>
<a id="__codelineno-25-20" name="__codelineno-25-20"></a><span class="k">endtask</span>
</code></pre></div></td></tr></table></div>
<ol start="2">
<li>性能测试</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-26-1">1</a></span>
<span class="normal"><a href="#__codelineno-26-2">2</a></span>
<span class="normal"><a href="#__codelineno-26-3">3</a></span>
<span class="normal"><a href="#__codelineno-26-4">4</a></span>
<span class="normal"><a href="#__codelineno-26-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1"></a><span class="c1"># 分发带宽测试</span>
<a id="__codelineno-26-2" name="__codelineno-26-2"></a>./test_rs.sh<span class="w"> </span>--test<span class="w"> </span>dispatch_bw
<a id="__codelineno-26-3" name="__codelineno-26-3"></a>
<a id="__codelineno-26-4" name="__codelineno-26-4"></a><span class="c1"># 唤醒延迟测试</span>
<a id="__codelineno-26-5" name="__codelineno-26-5"></a>./test_rs.sh<span class="w"> </span>--test<span class="w"> </span>wakeup_latency
</code></pre></div></td></tr></table></div>
<h4 id="_21">实现项目<a class="headerlink" href="#_21" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<ol>
<li>基础保留站</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Markdown</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-27-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-27-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-27-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-27-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-27-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-27-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-27-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-27-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-27-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-27-10">10</a></span>
<span class="normal"><a href="#__codelineno-27-11">11</a></span>
<span class="normal"><a href="#__codelineno-27-12">12</a></span>
<span class="normal"><a href="#__codelineno-27-13">13</a></span>
<span class="normal"><a href="#__codelineno-27-14">14</a></span>
<span class="normal"><a href="#__codelineno-27-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1"></a>要求：
<a id="__codelineno-27-2" name="__codelineno-27-2"></a><span class="k">-</span><span class="w"> </span>支持基本ALU操作
<a id="__codelineno-27-3" name="__codelineno-27-3"></a><span class="k">-</span><span class="w"> </span>实现分发逻辑
<a id="__codelineno-27-4" name="__codelineno-27-4"></a><span class="k">-</span><span class="w"> </span>唤醒机制
<a id="__codelineno-27-5" name="__codelineno-27-5"></a><span class="k">-</span><span class="w"> </span>发射选择
<a id="__codelineno-27-6" name="__codelineno-27-6"></a>
<a id="__codelineno-27-7" name="__codelineno-27-7"></a>实现步骤：
<a id="__codelineno-27-8" name="__codelineno-27-8"></a><span class="k">1.</span> 条目设计
<a id="__codelineno-27-9" name="__codelineno-27-9"></a><span class="k">2.</span> 分发逻辑
<a id="__codelineno-27-10" name="__codelineno-27-10"></a><span class="k">3.</span> 唤醒电路
<a id="__codelineno-27-11" name="__codelineno-27-11"></a><span class="k">4.</span> 发射选择
<a id="__codelineno-27-12" name="__codelineno-27-12"></a>
<a id="__codelineno-27-13" name="__codelineno-27-13"></a>评估指标：
<a id="__codelineno-27-14" name="__codelineno-27-14"></a><span class="k">-</span><span class="w"> </span>分发带宽 = 4指令/周期
<a id="__codelineno-27-15" name="__codelineno-27-15"></a><span class="k">-</span><span class="w"> </span>唤醒延迟 &lt; 1周期
</code></pre></div></td></tr></table></div>
<ol start="2">
<li>高级保留站系统</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Markdown</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-28-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-28-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-28-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-28-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-28-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-28-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-28-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-28-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-28-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-28-10">10</a></span>
<span class="normal"><a href="#__codelineno-28-11">11</a></span>
<span class="normal"><a href="#__codelineno-28-12">12</a></span>
<span class="normal"><a href="#__codelineno-28-13">13</a></span>
<span class="normal"><a href="#__codelineno-28-14">14</a></span>
<span class="normal"><a href="#__codelineno-28-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1"></a>要求：
<a id="__codelineno-28-2" name="__codelineno-28-2"></a><span class="k">-</span><span class="w"> </span>多功能单元支持
<a id="__codelineno-28-3" name="__codelineno-28-3"></a><span class="k">-</span><span class="w"> </span>年龄优先级
<a id="__codelineno-28-4" name="__codelineno-28-4"></a><span class="k">-</span><span class="w"> </span>投机执行
<a id="__codelineno-28-5" name="__codelineno-28-5"></a><span class="k">-</span><span class="w"> </span>性能优化
<a id="__codelineno-28-6" name="__codelineno-28-6"></a>
<a id="__codelineno-28-7" name="__codelineno-28-7"></a>实现步骤：
<a id="__codelineno-28-8" name="__codelineno-28-8"></a><span class="k">1.</span> 扩展功能支持
<a id="__codelineno-28-9" name="__codelineno-28-9"></a><span class="k">2.</span> 优先级机制
<a id="__codelineno-28-10" name="__codelineno-28-10"></a><span class="k">3.</span> 投机状态管理
<a id="__codelineno-28-11" name="__codelineno-28-11"></a><span class="k">4.</span> 关键路径优化
<a id="__codelineno-28-12" name="__codelineno-28-12"></a>
<a id="__codelineno-28-13" name="__codelineno-28-13"></a>评估指标：
<a id="__codelineno-28-14" name="__codelineno-28-14"></a><span class="k">-</span><span class="w"> </span>利用率 &gt; 90%
<a id="__codelineno-28-15" name="__codelineno-28-15"></a><span class="k">-</span><span class="w"> </span>发射带宽 = 4指令/周期
</code></pre></div></td></tr></table></div>
<h3 id="5-reorder-buffer"><span>5.<span class="heti-spacing"> </span></span>重排序缓冲区<span><span class="heti-spacing"> </span>(Reorder Buffer)</span><a class="headerlink" href="#5-reorder-buffer" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<h4 id="_22">具体规格<a class="headerlink" href="#_22" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<ol>
<li>配置参数</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Verilog</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-29-1">1</a></span>
<span class="normal"><a href="#__codelineno-29-2">2</a></span>
<span class="normal"><a href="#__codelineno-29-3">3</a></span>
<span class="normal"><a href="#__codelineno-29-4">4</a></span>
<span class="normal"><a href="#__codelineno-29-5">5</a></span>
<span class="normal"><a href="#__codelineno-29-6">6</a></span>
<span class="normal"><a href="#__codelineno-29-7">7</a></span>
<span class="normal"><a href="#__codelineno-29-8">8</a></span>
<span class="normal"><a href="#__codelineno-29-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1"></a><span class="c1">// ROB配置</span>
<a id="__codelineno-29-2" name="__codelineno-29-2"></a><span class="k">parameter</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">ROB_SIZE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">128</span><span class="p">;</span><span class="w">          </span><span class="c1">// ROB总条目数</span>
<a id="__codelineno-29-3" name="__codelineno-29-3"></a><span class="k">parameter</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">COMMIT_WIDTH</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">4</span><span class="p">;</span><span class="w">        </span><span class="c1">// 每周期提交宽度</span>
<a id="__codelineno-29-4" name="__codelineno-29-4"></a><span class="k">parameter</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">DISPATCH_WIDTH</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">4</span><span class="p">;</span><span class="w">      </span><span class="c1">// 每周期分发宽度</span>
<a id="__codelineno-29-5" name="__codelineno-29-5"></a><span class="k">parameter</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">CHECKPOINT_NUM</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">8</span><span class="p">;</span><span class="w">      </span><span class="c1">// 检查点数量</span>
<a id="__codelineno-29-6" name="__codelineno-29-6"></a>
<a id="__codelineno-29-7" name="__codelineno-29-7"></a><span class="c1">// 异常处理配置</span>
<a id="__codelineno-29-8" name="__codelineno-29-8"></a><span class="k">parameter</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">EXCEPTION_CODE_WIDTH</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">5</span><span class="p">;</span><span class="w"> </span><span class="c1">// 异常码位宽</span>
<a id="__codelineno-29-9" name="__codelineno-29-9"></a><span class="k">parameter</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">CSR_ADDR_WIDTH</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">12</span><span class="p">;</span><span class="w">     </span><span class="c1">// CSR地址位宽</span>
</code></pre></div></td></tr></table></div>
<ol start="2">
<li>接口定义</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Verilog</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-30-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-30-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-30-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-30-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-30-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-30-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-30-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-30-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-30-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-30-10">10</a></span>
<span class="normal"><a href="#__codelineno-30-11">11</a></span>
<span class="normal"><a href="#__codelineno-30-12">12</a></span>
<span class="normal"><a href="#__codelineno-30-13">13</a></span>
<span class="normal"><a href="#__codelineno-30-14">14</a></span>
<span class="normal"><a href="#__codelineno-30-15">15</a></span>
<span class="normal"><a href="#__codelineno-30-16">16</a></span>
<span class="normal"><a href="#__codelineno-30-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1"></a><span class="c1">// 分发接口</span>
<a id="__codelineno-30-2" name="__codelineno-30-2"></a><span class="k">input</span><span class="w">  </span><span class="n">rob_dispatch_req_t</span><span class="w"> </span><span class="p">[</span><span class="n">DISPATCH_WIDTH</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">dispatch_req</span><span class="p">,</span>
<a id="__codelineno-30-3" name="__codelineno-30-3"></a><span class="k">output</span><span class="w"> </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="n">DISPATCH_WIDTH</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">              </span><span class="n">dispatch_ready</span><span class="p">,</span>
<a id="__codelineno-30-4" name="__codelineno-30-4"></a><span class="k">output</span><span class="w"> </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="n">ROB_INDEX_WIDTH</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">            </span><span class="n">rob_tail_ptr</span><span class="p">,</span>
<a id="__codelineno-30-5" name="__codelineno-30-5"></a>
<a id="__codelineno-30-6" name="__codelineno-30-6"></a><span class="c1">// 完成接口</span>
<a id="__codelineno-30-7" name="__codelineno-30-7"></a><span class="k">input</span><span class="w">  </span><span class="n">complete_t</span><span class="w"> </span><span class="p">[</span><span class="n">ISSUE_WIDTH</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">           </span><span class="n">complete_info</span><span class="p">,</span>
<a id="__codelineno-30-8" name="__codelineno-30-8"></a>
<a id="__codelineno-30-9" name="__codelineno-30-9"></a><span class="c1">// 提交接口</span>
<a id="__codelineno-30-10" name="__codelineno-30-10"></a><span class="k">output</span><span class="w"> </span><span class="n">commit_t</span><span class="w"> </span><span class="p">[</span><span class="n">COMMIT_WIDTH</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">            </span><span class="n">commit_info</span><span class="p">,</span>
<a id="__codelineno-30-11" name="__codelineno-30-11"></a><span class="k">output</span><span class="w"> </span><span class="kt">logic</span><span class="w">                                  </span><span class="n">exception_valid</span><span class="p">,</span>
<a id="__codelineno-30-12" name="__codelineno-30-12"></a><span class="k">output</span><span class="w"> </span><span class="n">exception_t</span><span class="w">                            </span><span class="n">exception_info</span><span class="p">,</span>
<a id="__codelineno-30-13" name="__codelineno-30-13"></a>
<a id="__codelineno-30-14" name="__codelineno-30-14"></a><span class="c1">// 检查点接口</span>
<a id="__codelineno-30-15" name="__codelineno-30-15"></a><span class="k">output</span><span class="w"> </span><span class="n">checkpoint_t</span><span class="w">                           </span><span class="n">checkpoint_out</span><span class="p">,</span>
<a id="__codelineno-30-16" name="__codelineno-30-16"></a><span class="k">input</span><span class="w">  </span><span class="n">checkpoint_t</span><span class="w">                           </span><span class="n">checkpoint_in</span><span class="p">,</span>
<a id="__codelineno-30-17" name="__codelineno-30-17"></a><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w">                                  </span><span class="n">recover_valid</span>
</code></pre></div></td></tr></table></div>
<h4 id="_23">核心算法<a class="headerlink" href="#_23" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<ol>
<li>提交控制</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Verilog</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-31-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-31-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-31-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-31-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-31-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-31-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-31-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-31-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-31-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-31-10">10</a></span>
<span class="normal"><a href="#__codelineno-31-11">11</a></span>
<span class="normal"><a href="#__codelineno-31-12">12</a></span>
<span class="normal"><a href="#__codelineno-31-13">13</a></span>
<span class="normal"><a href="#__codelineno-31-14">14</a></span>
<span class="normal"><a href="#__codelineno-31-15">15</a></span>
<span class="normal"><a href="#__codelineno-31-16">16</a></span>
<span class="normal"><a href="#__codelineno-31-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1"></a><span class="c1">// 提交逻辑</span>
<a id="__codelineno-31-2" name="__codelineno-31-2"></a><span class="k">always_comb</span><span class="w"> </span><span class="k">begin</span>
<a id="__codelineno-31-3" name="__codelineno-31-3"></a><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">commit_count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span>
<a id="__codelineno-31-4" name="__codelineno-31-4"></a><span class="w">  </span><span class="n">commit_valid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">'0</span><span class="p">;</span>
<a id="__codelineno-31-5" name="__codelineno-31-5"></a>
<a id="__codelineno-31-6" name="__codelineno-31-6"></a><span class="w">  </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">COMMIT_WIDTH</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span>
<a id="__codelineno-31-7" name="__codelineno-31-7"></a><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">rob_entry</span><span class="p">[</span><span class="n">head</span><span class="o">+</span><span class="n">i</span><span class="p">].</span><span class="n">complete</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">rob_entry</span><span class="p">[</span><span class="n">head</span><span class="o">+</span><span class="n">i</span><span class="p">].</span><span class="n">exception</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span>
<a id="__codelineno-31-8" name="__codelineno-31-8"></a><span class="w">      </span><span class="n">commit_valid</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="mb">'b1</span><span class="p">;</span>
<a id="__codelineno-31-9" name="__codelineno-31-9"></a><span class="w">      </span><span class="n">commit_count</span><span class="o">++</span><span class="p">;</span>
<a id="__codelineno-31-10" name="__codelineno-31-10"></a><span class="w">    </span><span class="k">end</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">begin</span>
<a id="__codelineno-31-11" name="__codelineno-31-11"></a><span class="w">      </span><span class="k">break</span><span class="p">;</span><span class="w"> </span><span class="c1">// 遇到未完成或异常指令停止提交</span>
<a id="__codelineno-31-12" name="__codelineno-31-12"></a><span class="w">    </span><span class="k">end</span>
<a id="__codelineno-31-13" name="__codelineno-31-13"></a><span class="w">  </span><span class="k">end</span>
<a id="__codelineno-31-14" name="__codelineno-31-14"></a>
<a id="__codelineno-31-15" name="__codelineno-31-15"></a><span class="w">  </span><span class="c1">// 更新头指针</span>
<a id="__codelineno-31-16" name="__codelineno-31-16"></a><span class="w">  </span><span class="n">next_head</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">head</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">commit_count</span><span class="p">;</span>
<a id="__codelineno-31-17" name="__codelineno-31-17"></a><span class="k">end</span>
</code></pre></div></td></tr></table></div>
<ol start="2">
<li>异常处理</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Verilog</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-32-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-32-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-32-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-32-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-32-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-32-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-32-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-32-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-32-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-32-10">10</a></span>
<span class="normal"><a href="#__codelineno-32-11">11</a></span>
<span class="normal"><a href="#__codelineno-32-12">12</a></span>
<span class="normal"><a href="#__codelineno-32-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1"></a><span class="c1">// 异常检测与处理</span>
<a id="__codelineno-32-2" name="__codelineno-32-2"></a><span class="k">always_comb</span><span class="w"> </span><span class="k">begin</span>
<a id="__codelineno-32-3" name="__codelineno-32-3"></a><span class="w">  </span><span class="n">exception_valid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="mb">'b0</span><span class="p">;</span>
<a id="__codelineno-32-4" name="__codelineno-32-4"></a><span class="w">  </span><span class="n">exception_info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">'0</span><span class="p">;</span>
<a id="__codelineno-32-5" name="__codelineno-32-5"></a>
<a id="__codelineno-32-6" name="__codelineno-32-6"></a><span class="w">  </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">ROB_SIZE</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span>
<a id="__codelineno-32-7" name="__codelineno-32-7"></a><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">rob_entry</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">valid</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">rob_entry</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">exception</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span>
<a id="__codelineno-32-8" name="__codelineno-32-8"></a><span class="w">      </span><span class="n">exception_valid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="mb">'b1</span><span class="p">;</span>
<a id="__codelineno-32-9" name="__codelineno-32-9"></a><span class="w">      </span><span class="n">exception_info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rob_entry</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">exception_info</span><span class="p">;</span>
<a id="__codelineno-32-10" name="__codelineno-32-10"></a><span class="w">      </span><span class="k">break</span><span class="p">;</span>
<a id="__codelineno-32-11" name="__codelineno-32-11"></a><span class="w">    </span><span class="k">end</span>
<a id="__codelineno-32-12" name="__codelineno-32-12"></a><span class="w">  </span><span class="k">end</span>
<a id="__codelineno-32-13" name="__codelineno-32-13"></a><span class="k">end</span>
</code></pre></div></td></tr></table></div>
<ol start="3">
<li>检查点机制</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Verilog</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-33-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-33-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-33-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-33-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-33-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-33-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-33-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-33-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-33-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-33-10">10</a></span>
<span class="normal"><a href="#__codelineno-33-11">11</a></span>
<span class="normal"><a href="#__codelineno-33-12">12</a></span>
<span class="normal"><a href="#__codelineno-33-13">13</a></span>
<span class="normal"><a href="#__codelineno-33-14">14</a></span>
<span class="normal"><a href="#__codelineno-33-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1"></a><span class="c1">// 检查点创建和恢复</span>
<a id="__codelineno-33-2" name="__codelineno-33-2"></a><span class="k">module</span><span class="w"> </span><span class="n">checkpoint_controller</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-33-3" name="__codelineno-33-3"></a><span class="w">  </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w">                  </span><span class="n">clk</span><span class="p">,</span>
<a id="__codelineno-33-4" name="__codelineno-33-4"></a><span class="w">  </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w">                  </span><span class="n">rst_n</span><span class="p">,</span>
<a id="__codelineno-33-5" name="__codelineno-33-5"></a>
<a id="__codelineno-33-6" name="__codelineno-33-6"></a><span class="w">  </span><span class="c1">// 创建检查点</span>
<a id="__codelineno-33-7" name="__codelineno-33-7"></a><span class="w">  </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w">                  </span><span class="n">create_cp_req</span><span class="p">,</span>
<a id="__codelineno-33-8" name="__codelineno-33-8"></a><span class="w">  </span><span class="k">input</span><span class="w">  </span><span class="n">rob_state_t</span><span class="w">            </span><span class="n">rob_state</span><span class="p">,</span>
<a id="__codelineno-33-9" name="__codelineno-33-9"></a><span class="w">  </span><span class="k">output</span><span class="w"> </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="n">CP_ID_WIDTH</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">cp_id</span><span class="p">,</span>
<a id="__codelineno-33-10" name="__codelineno-33-10"></a>
<a id="__codelineno-33-11" name="__codelineno-33-11"></a><span class="w">  </span><span class="c1">// 恢复检查点</span>
<a id="__codelineno-33-12" name="__codelineno-33-12"></a><span class="w">  </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w">                  </span><span class="n">recover_req</span><span class="p">,</span>
<a id="__codelineno-33-13" name="__codelineno-33-13"></a><span class="w">  </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="n">CP_ID_WIDTH</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">recover_cp_id</span><span class="p">,</span>
<a id="__codelineno-33-14" name="__codelineno-33-14"></a><span class="w">  </span><span class="k">output</span><span class="w"> </span><span class="n">rob_state_t</span><span class="w">            </span><span class="n">recovered_state</span>
<a id="__codelineno-33-15" name="__codelineno-33-15"></a><span class="p">);</span>
</code></pre></div></td></tr></table></div>
<h4 id="_24">推荐课程<a class="headerlink" href="#_24" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<ol>
<li>
<p>主要课程
   - Berkeley CS252: Advanced Processor Architecture
   - Stanford EE382A: Out-of-Order Execution
   - MIT 6.823: Recovery Mechanisms</p>
</li>
<li>
<p>论文学习
   - "ROB Organizations for Deep Pipelines"
   - "Checkpoint Processing and Recovery"
   - "Precise Exception Handling in OoO Processors"</p>
</li>
</ol>
<h4 id="_25">验证策略<a class="headerlink" href="#_25" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<ol>
<li>功能验证</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Systemverilog</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-34-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-34-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-34-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-34-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-34-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-34-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-34-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-34-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-34-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-34-10">10</a></span>
<span class="normal"><a href="#__codelineno-34-11">11</a></span>
<span class="normal"><a href="#__codelineno-34-12">12</a></span>
<span class="normal"><a href="#__codelineno-34-13">13</a></span>
<span class="normal"><a href="#__codelineno-34-14">14</a></span>
<span class="normal"><a href="#__codelineno-34-15">15</a></span>
<span class="normal"><a href="#__codelineno-34-16">16</a></span>
<span class="normal"><a href="#__codelineno-34-17">17</a></span>
<span class="normal"><a href="#__codelineno-34-18">18</a></span>
<span class="normal"><a href="#__codelineno-34-19">19</a></span>
<span class="normal"><a href="#__codelineno-34-20">20</a></span>
<span class="normal"><a href="#__codelineno-34-21">21</a></span>
<span class="normal"><a href="#__codelineno-34-22">22</a></span>
<span class="normal"><a href="#__codelineno-34-23">23</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1"></a><span class="c1">// 基本功能测试</span>
<a id="__codelineno-34-2" name="__codelineno-34-2"></a><span class="k">task</span><span class="w"> </span><span class="n">test_rob_basic</span><span class="p">();</span>
<a id="__codelineno-34-3" name="__codelineno-34-3"></a><span class="w">  </span><span class="c1">// 正常提交流程</span>
<a id="__codelineno-34-4" name="__codelineno-34-4"></a><span class="w">  </span><span class="n">test_normal_commit</span><span class="p">();</span>
<a id="__codelineno-34-5" name="__codelineno-34-5"></a>
<a id="__codelineno-34-6" name="__codelineno-34-6"></a><span class="w">  </span><span class="c1">// 异常处理</span>
<a id="__codelineno-34-7" name="__codelineno-34-7"></a><span class="w">  </span><span class="n">test_exception_handling</span><span class="p">();</span>
<a id="__codelineno-34-8" name="__codelineno-34-8"></a>
<a id="__codelineno-34-9" name="__codelineno-34-9"></a><span class="w">  </span><span class="c1">// 检查点恢复</span>
<a id="__codelineno-34-10" name="__codelineno-34-10"></a><span class="w">  </span><span class="n">test_checkpoint_recovery</span><span class="p">();</span>
<a id="__codelineno-34-11" name="__codelineno-34-11"></a><span class="k">endtask</span>
<a id="__codelineno-34-12" name="__codelineno-34-12"></a>
<a id="__codelineno-34-13" name="__codelineno-34-13"></a><span class="c1">// 压力测试</span>
<a id="__codelineno-34-14" name="__codelineno-34-14"></a><span class="k">task</span><span class="w"> </span><span class="n">test_rob_stress</span><span class="p">();</span>
<a id="__codelineno-34-15" name="__codelineno-34-15"></a><span class="w">  </span><span class="c1">// 满载运行</span>
<a id="__codelineno-34-16" name="__codelineno-34-16"></a><span class="w">  </span><span class="n">test_full_rob</span><span class="p">();</span>
<a id="__codelineno-34-17" name="__codelineno-34-17"></a>
<a id="__codelineno-34-18" name="__codelineno-34-18"></a><span class="w">  </span><span class="c1">// 频繁异常</span>
<a id="__codelineno-34-19" name="__codelineno-34-19"></a><span class="w">  </span><span class="n">test_frequent_exceptions</span><span class="p">();</span>
<a id="__codelineno-34-20" name="__codelineno-34-20"></a>
<a id="__codelineno-34-21" name="__codelineno-34-21"></a><span class="w">  </span><span class="c1">// 快速恢复</span>
<a id="__codelineno-34-22" name="__codelineno-34-22"></a><span class="w">  </span><span class="n">test_rapid_recovery</span><span class="p">();</span>
<a id="__codelineno-34-23" name="__codelineno-34-23"></a><span class="k">endtask</span>
</code></pre></div></td></tr></table></div>
<ol start="2">
<li>性能测试</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-35-1">1</a></span>
<span class="normal"><a href="#__codelineno-35-2">2</a></span>
<span class="normal"><a href="#__codelineno-35-3">3</a></span>
<span class="normal"><a href="#__codelineno-35-4">4</a></span>
<span class="normal"><a href="#__codelineno-35-5">5</a></span>
<span class="normal"><a href="#__codelineno-35-6">6</a></span>
<span class="normal"><a href="#__codelineno-35-7">7</a></span>
<span class="normal"><a href="#__codelineno-35-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1"></a><span class="c1"># 提交带宽测试</span>
<a id="__codelineno-35-2" name="__codelineno-35-2"></a>./test_rob.sh<span class="w"> </span>--mode<span class="w"> </span>commit_bandwidth
<a id="__codelineno-35-3" name="__codelineno-35-3"></a>
<a id="__codelineno-35-4" name="__codelineno-35-4"></a><span class="c1"># 恢复延迟测试</span>
<a id="__codelineno-35-5" name="__codelineno-35-5"></a>./test_rob.sh<span class="w"> </span>--mode<span class="w"> </span>recovery_latency
<a id="__codelineno-35-6" name="__codelineno-35-6"></a>
<a id="__codelineno-35-7" name="__codelineno-35-7"></a><span class="c1"># 检查点开销分析</span>
<a id="__codelineno-35-8" name="__codelineno-35-8"></a>./analyze_checkpoint.sh<span class="w"> </span>--stats<span class="w"> </span>overhead
</code></pre></div></td></tr></table></div>
<h4 id="_26">实现项目<a class="headerlink" href="#_26" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<ol>
<li>基础<span><span class="heti-spacing"> </span>ROB</span></li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Markdown</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-36-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-36-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-36-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-36-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-36-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-36-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-36-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-36-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-36-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-36-10">10</a></span>
<span class="normal"><a href="#__codelineno-36-11">11</a></span>
<span class="normal"><a href="#__codelineno-36-12">12</a></span>
<span class="normal"><a href="#__codelineno-36-13">13</a></span>
<span class="normal"><a href="#__codelineno-36-14">14</a></span>
<span class="normal"><a href="#__codelineno-36-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1"></a>要求：
<a id="__codelineno-36-2" name="__codelineno-36-2"></a><span class="k">-</span><span class="w"> </span>128条目大小
<a id="__codelineno-36-3" name="__codelineno-36-3"></a><span class="k">-</span><span class="w"> </span>4宽度提交
<a id="__codelineno-36-4" name="__codelineno-36-4"></a><span class="k">-</span><span class="w"> </span>基本异常处理
<a id="__codelineno-36-5" name="__codelineno-36-5"></a><span class="k">-</span><span class="w"> </span>简单检查点
<a id="__codelineno-36-6" name="__codelineno-36-6"></a>
<a id="__codelineno-36-7" name="__codelineno-36-7"></a>实现步骤：
<a id="__codelineno-36-8" name="__codelineno-36-8"></a><span class="k">1.</span> 条目管理
<a id="__codelineno-36-9" name="__codelineno-36-9"></a><span class="k">2.</span> 提交逻辑
<a id="__codelineno-36-10" name="__codelineno-36-10"></a><span class="k">3.</span> 异常处理
<a id="__codelineno-36-11" name="__codelineno-36-11"></a><span class="k">4.</span> 检查点机制
<a id="__codelineno-36-12" name="__codelineno-36-12"></a>
<a id="__codelineno-36-13" name="__codelineno-36-13"></a>评估指标：
<a id="__codelineno-36-14" name="__codelineno-36-14"></a><span class="k">-</span><span class="w"> </span>提交带宽 = 4指令/周期
<a id="__codelineno-36-15" name="__codelineno-36-15"></a><span class="k">-</span><span class="w"> </span>恢复延迟 &lt; 10周期
</code></pre></div></td></tr></table></div>
<ol start="2">
<li>高级<span class="heti-skip"><span class="heti-spacing"> </span>ROB<span class="heti-spacing"> </span></span>系统</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Markdown</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-37-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-37-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-37-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-37-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-37-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-37-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-37-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-37-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-37-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-37-10">10</a></span>
<span class="normal"><a href="#__codelineno-37-11">11</a></span>
<span class="normal"><a href="#__codelineno-37-12">12</a></span>
<span class="normal"><a href="#__codelineno-37-13">13</a></span>
<span class="normal"><a href="#__codelineno-37-14">14</a></span>
<span class="normal"><a href="#__codelineno-37-15">15</a></span>
<span class="normal"><a href="#__codelineno-37-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1"></a>要求：
<a id="__codelineno-37-2" name="__codelineno-37-2"></a><span class="k">-</span><span class="w"> </span>256条目支持
<a id="__codelineno-37-3" name="__codelineno-37-3"></a><span class="k">-</span><span class="w"> </span>选择性重排提交
<a id="__codelineno-37-4" name="__codelineno-37-4"></a><span class="k">-</span><span class="w"> </span>精确异常
<a id="__codelineno-37-5" name="__codelineno-37-5"></a><span class="k">-</span><span class="w"> </span>多级检查点
<a id="__codelineno-37-6" name="__codelineno-37-6"></a>
<a id="__codelineno-37-7" name="__codelineno-37-7"></a>实现步骤：
<a id="__codelineno-37-8" name="__codelineno-37-8"></a><span class="k">1.</span> 扩展条目管理
<a id="__codelineno-37-9" name="__codelineno-37-9"></a><span class="k">2.</span> 优化提交逻辑
<a id="__codelineno-37-10" name="__codelineno-37-10"></a><span class="k">3.</span> 增强异常处理
<a id="__codelineno-37-11" name="__codelineno-37-11"></a><span class="k">4.</span> 改进检查点系统
<a id="__codelineno-37-12" name="__codelineno-37-12"></a>
<a id="__codelineno-37-13" name="__codelineno-37-13"></a>评估指标：
<a id="__codelineno-37-14" name="__codelineno-37-14"></a><span class="k">-</span><span class="w"> </span>提交带宽 &gt;= 4指令/周期
<a id="__codelineno-37-15" name="__codelineno-37-15"></a><span class="k">-</span><span class="w"> </span>恢复延迟 &lt; 8周期
<a id="__codelineno-37-16" name="__codelineno-37-16"></a><span class="k">-</span><span class="w"> </span>检查点开销 &lt; 5%
</code></pre></div></td></tr></table></div>
<h3 id="6-loadstore-queue"><span>6.<span class="heti-spacing"> </span></span>访存队列<span><span class="heti-spacing"> </span>(Load/Store Queue)</span><a class="headerlink" href="#6-loadstore-queue" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<h4 id="_27">具体规格<a class="headerlink" href="#_27" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<ol>
<li>配置参数</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Verilog</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-38-1">1</a></span>
<span class="normal"><a href="#__codelineno-38-2">2</a></span>
<span class="normal"><a href="#__codelineno-38-3">3</a></span>
<span class="normal"><a href="#__codelineno-38-4">4</a></span>
<span class="normal"><a href="#__codelineno-38-5">5</a></span>
<span class="normal"><a href="#__codelineno-38-6">6</a></span>
<span class="normal"><a href="#__codelineno-38-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1"></a><span class="c1">// LSQ配置</span>
<a id="__codelineno-38-2" name="__codelineno-38-2"></a><span class="k">parameter</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">LQ_SIZE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">32</span><span class="p">;</span><span class="w">            </span><span class="c1">// Load队列大小</span>
<a id="__codelineno-38-3" name="__codelineno-38-3"></a><span class="k">parameter</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">SQ_SIZE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">24</span><span class="p">;</span><span class="w">            </span><span class="c1">// Store队列大小</span>
<a id="__codelineno-38-4" name="__codelineno-38-4"></a><span class="k">parameter</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">DISPATCH_WIDTH</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">4</span><span class="p">;</span><span class="w">      </span><span class="c1">// 分发宽度</span>
<a id="__codelineno-38-5" name="__codelineno-38-5"></a><span class="k">parameter</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">COMMIT_WIDTH</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">4</span><span class="p">;</span><span class="w">        </span><span class="c1">// 提交宽度</span>
<a id="__codelineno-38-6" name="__codelineno-38-6"></a><span class="k">parameter</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">ADDR_WIDTH</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">64</span><span class="p">;</span><span class="w">         </span><span class="c1">// 地址位宽</span>
<a id="__codelineno-38-7" name="__codelineno-38-7"></a><span class="k">parameter</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">DATA_WIDTH</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">64</span><span class="p">;</span><span class="w">         </span><span class="c1">// 数据位宽</span>
</code></pre></div></td></tr></table></div>
<ol start="2">
<li>接口定义</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Verilog</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-39-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-39-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-39-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-39-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-39-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-39-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-39-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-39-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-39-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-39-10">10</a></span>
<span class="normal"><a href="#__codelineno-39-11">11</a></span>
<span class="normal"><a href="#__codelineno-39-12">12</a></span>
<span class="normal"><a href="#__codelineno-39-13">13</a></span>
<span class="normal"><a href="#__codelineno-39-14">14</a></span>
<span class="normal"><a href="#__codelineno-39-15">15</a></span>
<span class="normal"><a href="#__codelineno-39-16">16</a></span>
<span class="normal"><a href="#__codelineno-39-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1"></a><span class="c1">// 分发接口</span>
<a id="__codelineno-39-2" name="__codelineno-39-2"></a><span class="k">input</span><span class="w">  </span><span class="n">lsq_dispatch_req_t</span><span class="w"> </span><span class="p">[</span><span class="n">DISPATCH_WIDTH</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">dispatch_req</span><span class="p">,</span>
<a id="__codelineno-39-3" name="__codelineno-39-3"></a><span class="k">output</span><span class="w"> </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="n">DISPATCH_WIDTH</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">              </span><span class="n">dispatch_ready</span><span class="p">,</span>
<a id="__codelineno-39-4" name="__codelineno-39-4"></a>
<a id="__codelineno-39-5" name="__codelineno-39-5"></a><span class="c1">// 执行接口</span>
<a id="__codelineno-39-6" name="__codelineno-39-6"></a><span class="k">input</span><span class="w">  </span><span class="n">execute_req_t</span><span class="w">                           </span><span class="n">ld_execute</span><span class="p">,</span>
<a id="__codelineno-39-7" name="__codelineno-39-7"></a><span class="k">input</span><span class="w">  </span><span class="n">execute_req_t</span><span class="w">                           </span><span class="n">st_execute</span><span class="p">,</span>
<a id="__codelineno-39-8" name="__codelineno-39-8"></a><span class="k">output</span><span class="w"> </span><span class="kt">logic</span><span class="w">                                   </span><span class="n">ld_ready</span><span class="p">,</span>
<a id="__codelineno-39-9" name="__codelineno-39-9"></a><span class="k">output</span><span class="w"> </span><span class="kt">logic</span><span class="w">                                   </span><span class="n">st_ready</span><span class="p">,</span>
<a id="__codelineno-39-10" name="__codelineno-39-10"></a>
<a id="__codelineno-39-11" name="__codelineno-39-11"></a><span class="c1">// 提交接口</span>
<a id="__codelineno-39-12" name="__codelineno-39-12"></a><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="n">COMMIT_WIDTH</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">               </span><span class="n">commit_valid</span><span class="p">,</span>
<a id="__codelineno-39-13" name="__codelineno-39-13"></a><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="n">COMMIT_WIDTH</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">               </span><span class="n">commit_store</span><span class="p">,</span>
<a id="__codelineno-39-14" name="__codelineno-39-14"></a>
<a id="__codelineno-39-15" name="__codelineno-39-15"></a><span class="c1">// 缓存接口</span>
<a id="__codelineno-39-16" name="__codelineno-39-16"></a><span class="k">output</span><span class="w"> </span><span class="n">cache_req_t</span><span class="w">                            </span><span class="n">cache_req</span><span class="p">,</span>
<a id="__codelineno-39-17" name="__codelineno-39-17"></a><span class="k">input</span><span class="w">  </span><span class="n">cache_resp_t</span><span class="w">                           </span><span class="n">cache_resp</span>
</code></pre></div></td></tr></table></div>
<h4 id="_28">核心算法<a class="headerlink" href="#_28" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<ol>
<li>内存依赖检查</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Verilog</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-40-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-40-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-40-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-40-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-40-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-40-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-40-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-40-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-40-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-40-10">10</a></span>
<span class="normal"><a href="#__codelineno-40-11">11</a></span>
<span class="normal"><a href="#__codelineno-40-12">12</a></span>
<span class="normal"><a href="#__codelineno-40-13">13</a></span>
<span class="normal"><a href="#__codelineno-40-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1"></a><span class="c1">// 地址比较逻辑</span>
<a id="__codelineno-40-2" name="__codelineno-40-2"></a><span class="k">module</span><span class="w"> </span><span class="n">address_compare</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-40-3" name="__codelineno-40-3"></a><span class="w">  </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="n">ADDR_WIDTH</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">ld_addr</span><span class="p">,</span>
<a id="__codelineno-40-4" name="__codelineno-40-4"></a><span class="w">  </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="n">SQ_SIZE</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">][</span><span class="n">ADDR_WIDTH</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">sq_addr</span><span class="p">,</span>
<a id="__codelineno-40-5" name="__codelineno-40-5"></a><span class="w">  </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="n">SQ_SIZE</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">sq_valid</span><span class="p">,</span>
<a id="__codelineno-40-6" name="__codelineno-40-6"></a><span class="w">  </span><span class="k">output</span><span class="w"> </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="n">SQ_SIZE</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">match</span>
<a id="__codelineno-40-7" name="__codelineno-40-7"></a><span class="p">);</span>
<a id="__codelineno-40-8" name="__codelineno-40-8"></a>
<a id="__codelineno-40-9" name="__codelineno-40-9"></a><span class="k">always_comb</span><span class="w"> </span><span class="k">begin</span>
<a id="__codelineno-40-10" name="__codelineno-40-10"></a><span class="w">  </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">SQ_SIZE</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span>
<a id="__codelineno-40-11" name="__codelineno-40-11"></a><span class="w">    </span><span class="n">match</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sq_valid</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">ld_addr</span><span class="p">[</span><span class="n">ADDR_WIDTH</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">3</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>
<a id="__codelineno-40-12" name="__codelineno-40-12"></a><span class="w">                              </span><span class="n">sq_addr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">ADDR_WIDTH</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">3</span><span class="p">]);</span>
<a id="__codelineno-40-13" name="__codelineno-40-13"></a><span class="w">  </span><span class="k">end</span>
<a id="__codelineno-40-14" name="__codelineno-40-14"></a><span class="k">end</span>
</code></pre></div></td></tr></table></div>
<ol start="2">
<li>数据转发</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Verilog</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-41-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-41-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-41-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-41-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-41-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-41-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-41-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-41-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-41-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-41-10">10</a></span>
<span class="normal"><a href="#__codelineno-41-11">11</a></span>
<span class="normal"><a href="#__codelineno-41-12">12</a></span>
<span class="normal"><a href="#__codelineno-41-13">13</a></span>
<span class="normal"><a href="#__codelineno-41-14">14</a></span>
<span class="normal"><a href="#__codelineno-41-15">15</a></span>
<span class="normal"><a href="#__codelineno-41-16">16</a></span>
<span class="normal"><a href="#__codelineno-41-17">17</a></span>
<span class="normal"><a href="#__codelineno-41-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1"></a><span class="c1">// Store-to-Load转发</span>
<a id="__codelineno-41-2" name="__codelineno-41-2"></a><span class="k">module</span><span class="w"> </span><span class="n">store_forward</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-41-3" name="__codelineno-41-3"></a><span class="w">  </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="n">DATA_WIDTH</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">ld_data</span><span class="p">,</span>
<a id="__codelineno-41-4" name="__codelineno-41-4"></a><span class="w">  </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">ld_mask</span><span class="p">,</span>
<a id="__codelineno-41-5" name="__codelineno-41-5"></a><span class="w">  </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="n">DATA_WIDTH</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">st_data</span><span class="p">,</span>
<a id="__codelineno-41-6" name="__codelineno-41-6"></a><span class="w">  </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">st_mask</span><span class="p">,</span>
<a id="__codelineno-41-7" name="__codelineno-41-7"></a><span class="w">  </span><span class="k">output</span><span class="w"> </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="n">DATA_WIDTH</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">forward_data</span><span class="p">,</span>
<a id="__codelineno-41-8" name="__codelineno-41-8"></a><span class="w">  </span><span class="k">output</span><span class="w"> </span><span class="kt">logic</span><span class="w"> </span><span class="n">forward_valid</span>
<a id="__codelineno-41-9" name="__codelineno-41-9"></a><span class="p">);</span>
<a id="__codelineno-41-10" name="__codelineno-41-10"></a>
<a id="__codelineno-41-11" name="__codelineno-41-11"></a><span class="k">always_comb</span><span class="w"> </span><span class="k">begin</span>
<a id="__codelineno-41-12" name="__codelineno-41-12"></a><span class="w">  </span><span class="n">forward_valid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ld_mask</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">st_mask</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ld_mask</span><span class="p">;</span>
<a id="__codelineno-41-13" name="__codelineno-41-13"></a><span class="w">  </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="mh">8</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span>
<a id="__codelineno-41-14" name="__codelineno-41-14"></a><span class="w">    </span><span class="n">forward_data</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="mh">8</span><span class="w"> </span><span class="o">+:</span><span class="w"> </span><span class="mh">8</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">st_mask</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">?</span><span class="w"> </span>
<a id="__codelineno-41-15" name="__codelineno-41-15"></a><span class="w">                             </span><span class="n">st_data</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="mh">8</span><span class="w"> </span><span class="o">+:</span><span class="w"> </span><span class="mh">8</span><span class="p">]</span><span class="w"> </span><span class="o">:</span><span class="w"> </span>
<a id="__codelineno-41-16" name="__codelineno-41-16"></a><span class="w">                             </span><span class="n">ld_data</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="mh">8</span><span class="w"> </span><span class="o">+:</span><span class="w"> </span><span class="mh">8</span><span class="p">];</span>
<a id="__codelineno-41-17" name="__codelineno-41-17"></a><span class="w">  </span><span class="k">end</span>
<a id="__codelineno-41-18" name="__codelineno-41-18"></a><span class="k">end</span>
</code></pre></div></td></tr></table></div>
<ol start="3">
<li>内存重排序</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Verilog</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-42-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-42-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-42-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-42-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-42-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-42-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-42-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-42-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-42-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-42-10">10</a></span>
<span class="normal"><a href="#__codelineno-42-11">11</a></span>
<span class="normal"><a href="#__codelineno-42-12">12</a></span>
<span class="normal"><a href="#__codelineno-42-13">13</a></span>
<span class="normal"><a href="#__codelineno-42-14">14</a></span>
<span class="normal"><a href="#__codelineno-42-15">15</a></span>
<span class="normal"><a href="#__codelineno-42-16">16</a></span>
<span class="normal"><a href="#__codelineno-42-17">17</a></span>
<span class="normal"><a href="#__codelineno-42-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1"></a><span class="c1">// Load重排策略</span>
<a id="__codelineno-42-2" name="__codelineno-42-2"></a><span class="k">module</span><span class="w"> </span><span class="n">load_reorder</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-42-3" name="__codelineno-42-3"></a><span class="w">  </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="n">LQ_SIZE</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">load_valid</span><span class="p">,</span>
<a id="__codelineno-42-4" name="__codelineno-42-4"></a><span class="w">  </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="n">LQ_SIZE</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">load_ready</span><span class="p">,</span>
<a id="__codelineno-42-5" name="__codelineno-42-5"></a><span class="w">  </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="n">LQ_SIZE</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">load_depend</span><span class="p">,</span>
<a id="__codelineno-42-6" name="__codelineno-42-6"></a><span class="w">  </span><span class="k">output</span><span class="w"> </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="n">LQ_SIZE</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">load_issue</span>
<a id="__codelineno-42-7" name="__codelineno-42-7"></a><span class="p">);</span>
<a id="__codelineno-42-8" name="__codelineno-42-8"></a>
<a id="__codelineno-42-9" name="__codelineno-42-9"></a><span class="c1">// 优先级编码</span>
<a id="__codelineno-42-10" name="__codelineno-42-10"></a><span class="k">always_comb</span><span class="w"> </span><span class="k">begin</span>
<a id="__codelineno-42-11" name="__codelineno-42-11"></a><span class="w">  </span><span class="n">load_issue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">'0</span><span class="p">;</span>
<a id="__codelineno-42-12" name="__codelineno-42-12"></a><span class="w">  </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">LQ_SIZE</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span>
<a id="__codelineno-42-13" name="__codelineno-42-13"></a><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">load_valid</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">load_ready</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">load_depend</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="w"> </span><span class="k">begin</span>
<a id="__codelineno-42-14" name="__codelineno-42-14"></a><span class="w">      </span><span class="n">load_issue</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="mb">'b1</span><span class="p">;</span>
<a id="__codelineno-42-15" name="__codelineno-42-15"></a><span class="w">      </span><span class="k">break</span><span class="p">;</span>
<a id="__codelineno-42-16" name="__codelineno-42-16"></a><span class="w">    </span><span class="k">end</span>
<a id="__codelineno-42-17" name="__codelineno-42-17"></a><span class="w">  </span><span class="k">end</span>
<a id="__codelineno-42-18" name="__codelineno-42-18"></a><span class="k">end</span>
</code></pre></div></td></tr></table></div>
<h4 id="_29">推荐课程<a class="headerlink" href="#_29" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<ol>
<li>
<p>主课程
   - MIT 6.823: Memory Systems
   - Stanford CS316: Modern Memory Systems
   - Berkeley CS252: Memory Ordering</p>
</li>
<li>
<p>论文研究
   - "Memory Dependency Prediction"
   - "Store-Load Forwarding Techniques"
   - "Speculative Memory Disambiguation"</p>
</li>
</ol>
<h4 id="_30">验证策略<a class="headerlink" href="#_30" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<ol>
<li>功能测试</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Systemverilog</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-43-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-43-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-43-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-43-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-43-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-43-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-43-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-43-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-43-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-43-10">10</a></span>
<span class="normal"><a href="#__codelineno-43-11">11</a></span>
<span class="normal"><a href="#__codelineno-43-12">12</a></span>
<span class="normal"><a href="#__codelineno-43-13">13</a></span>
<span class="normal"><a href="#__codelineno-43-14">14</a></span>
<span class="normal"><a href="#__codelineno-43-15">15</a></span>
<span class="normal"><a href="#__codelineno-43-16">16</a></span>
<span class="normal"><a href="#__codelineno-43-17">17</a></span>
<span class="normal"><a href="#__codelineno-43-18">18</a></span>
<span class="normal"><a href="#__codelineno-43-19">19</a></span>
<span class="normal"><a href="#__codelineno-43-20">20</a></span>
<span class="normal"><a href="#__codelineno-43-21">21</a></span>
<span class="normal"><a href="#__codelineno-43-22">22</a></span>
<span class="normal"><a href="#__codelineno-43-23">23</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1"></a><span class="c1">// 基本功能测试</span>
<a id="__codelineno-43-2" name="__codelineno-43-2"></a><span class="k">task</span><span class="w"> </span><span class="n">test_lsq_basic</span><span class="p">();</span>
<a id="__codelineno-43-3" name="__codelineno-43-3"></a><span class="w">  </span><span class="c1">// Load执行</span>
<a id="__codelineno-43-4" name="__codelineno-43-4"></a><span class="w">  </span><span class="n">test_load_execution</span><span class="p">();</span>
<a id="__codelineno-43-5" name="__codelineno-43-5"></a>
<a id="__codelineno-43-6" name="__codelineno-43-6"></a><span class="w">  </span><span class="c1">// Store提交</span>
<a id="__codelineno-43-7" name="__codelineno-43-7"></a><span class="w">  </span><span class="n">test_store_commit</span><span class="p">();</span>
<a id="__codelineno-43-8" name="__codelineno-43-8"></a>
<a id="__codelineno-43-9" name="__codelineno-43-9"></a><span class="w">  </span><span class="c1">// 依赖检查</span>
<a id="__codelineno-43-10" name="__codelineno-43-10"></a><span class="w">  </span><span class="n">test_dependency_check</span><span class="p">();</span>
<a id="__codelineno-43-11" name="__codelineno-43-11"></a><span class="k">endtask</span>
<a id="__codelineno-43-12" name="__codelineno-43-12"></a>
<a id="__codelineno-43-13" name="__codelineno-43-13"></a><span class="c1">// 特殊场景测试</span>
<a id="__codelineno-43-14" name="__codelineno-43-14"></a><span class="k">task</span><span class="w"> </span><span class="n">test_lsq_special</span><span class="p">();</span>
<a id="__codelineno-43-15" name="__codelineno-43-15"></a><span class="w">  </span><span class="c1">// 部分重叠</span>
<a id="__codelineno-43-16" name="__codelineno-43-16"></a><span class="w">  </span><span class="n">test_partial_overlap</span><span class="p">();</span>
<a id="__codelineno-43-17" name="__codelineno-43-17"></a>
<a id="__codelineno-43-18" name="__codelineno-43-18"></a><span class="w">  </span><span class="c1">// 重排序冲突</span>
<a id="__codelineno-43-19" name="__codelineno-43-19"></a><span class="w">  </span><span class="n">test_reorder_conflict</span><span class="p">();</span>
<a id="__codelineno-43-20" name="__codelineno-43-20"></a>
<a id="__codelineno-43-21" name="__codelineno-43-21"></a><span class="w">  </span><span class="c1">// 转发失败</span>
<a id="__codelineno-43-22" name="__codelineno-43-22"></a><span class="w">  </span><span class="n">test_forward_fail</span><span class="p">();</span>
<a id="__codelineno-43-23" name="__codelineno-43-23"></a><span class="k">endtask</span>
</code></pre></div></td></tr></table></div>
<ol start="2">
<li>性能测试</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-44-1">1</a></span>
<span class="normal"><a href="#__codelineno-44-2">2</a></span>
<span class="normal"><a href="#__codelineno-44-3">3</a></span>
<span class="normal"><a href="#__codelineno-44-4">4</a></span>
<span class="normal"><a href="#__codelineno-44-5">5</a></span>
<span class="normal"><a href="#__codelineno-44-6">6</a></span>
<span class="normal"><a href="#__codelineno-44-7">7</a></span>
<span class="normal"><a href="#__codelineno-44-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1"></a><span class="c1"># 访存带宽测试</span>
<a id="__codelineno-44-2" name="__codelineno-44-2"></a>./test_lsq.sh<span class="w"> </span>--mode<span class="w"> </span>memory_bandwidth
<a id="__codelineno-44-3" name="__codelineno-44-3"></a>
<a id="__codelineno-44-4" name="__codelineno-44-4"></a><span class="c1"># 依赖预测准确率</span>
<a id="__codelineno-44-5" name="__codelineno-44-5"></a>./test_lsq.sh<span class="w"> </span>--mode<span class="w"> </span>pred_accuracy
<a id="__codelineno-44-6" name="__codelineno-44-6"></a>
<a id="__codelineno-44-7" name="__codelineno-44-7"></a><span class="c1"># 转发命中率</span>
<a id="__codelineno-44-8" name="__codelineno-44-8"></a>./test_lsq.sh<span class="w"> </span>--mode<span class="w"> </span>forward_rate
</code></pre></div></td></tr></table></div>
<h4 id="_31">实现项目<a class="headerlink" href="#_31" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<ol>
<li>基础<span><span class="heti-spacing"> </span>LSQ</span></li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Markdown</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-45-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-45-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-45-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-45-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-45-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-45-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-45-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-45-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-45-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-45-10">10</a></span>
<span class="normal"><a href="#__codelineno-45-11">11</a></span>
<span class="normal"><a href="#__codelineno-45-12">12</a></span>
<span class="normal"><a href="#__codelineno-45-13">13</a></span>
<span class="normal"><a href="#__codelineno-45-14">14</a></span>
<span class="normal"><a href="#__codelineno-45-15">15</a></span>
<span class="normal"><a href="#__codelineno-45-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1"></a>要求：
<a id="__codelineno-45-2" name="__codelineno-45-2"></a><span class="k">-</span><span class="w"> </span>32条Load队列
<a id="__codelineno-45-3" name="__codelineno-45-3"></a><span class="k">-</span><span class="w"> </span>24条Store队列
<a id="__codelineno-45-4" name="__codelineno-45-4"></a><span class="k">-</span><span class="w"> </span>基本依赖检查
<a id="__codelineno-45-5" name="__codelineno-45-5"></a><span class="k">-</span><span class="w"> </span>简单转发
<a id="__codelineno-45-6" name="__codelineno-45-6"></a>
<a id="__codelineno-45-7" name="__codelineno-45-7"></a>实现步骤：
<a id="__codelineno-45-8" name="__codelineno-45-8"></a><span class="k">1.</span> 队列管理
<a id="__codelineno-45-9" name="__codelineno-45-9"></a><span class="k">2.</span> 依赖检查
<a id="__codelineno-45-10" name="__codelineno-45-10"></a><span class="k">3.</span> 转发逻辑
<a id="__codelineno-45-11" name="__codelineno-45-11"></a><span class="k">4.</span> 提交控制
<a id="__codelineno-45-12" name="__codelineno-45-12"></a>
<a id="__codelineno-45-13" name="__codelineno-45-13"></a>评估指标：
<a id="__codelineno-45-14" name="__codelineno-45-14"></a><span class="k">-</span><span class="w"> </span>Load带宽 = 2/周期
<a id="__codelineno-45-15" name="__codelineno-45-15"></a><span class="k">-</span><span class="w"> </span>Store带宽 = 1/周期
<a id="__codelineno-45-16" name="__codelineno-45-16"></a><span class="k">-</span><span class="w"> </span>转发命中率 &gt; 80%
</code></pre></div></td></tr></table></div>
<ol start="2">
<li>高级<span class="heti-skip"><span class="heti-spacing"> </span>LSQ<span class="heti-spacing"> </span></span>系统</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Markdown</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-46-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-46-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-46-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-46-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-46-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-46-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-46-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-46-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-46-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-46-10">10</a></span>
<span class="normal"><a href="#__codelineno-46-11">11</a></span>
<span class="normal"><a href="#__codelineno-46-12">12</a></span>
<span class="normal"><a href="#__codelineno-46-13">13</a></span>
<span class="normal"><a href="#__codelineno-46-14">14</a></span>
<span class="normal"><a href="#__codelineno-46-15">15</a></span>
<span class="normal"><a href="#__codelineno-46-16">16</a></span>
<span class="normal"><a href="#__codelineno-46-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1"></a>要求：
<a id="__codelineno-46-2" name="__codelineno-46-2"></a><span class="k">-</span><span class="w"> </span>预测依赖
<a id="__codelineno-46-3" name="__codelineno-46-3"></a><span class="k">-</span><span class="w"> </span>投机执行
<a id="__codelineno-46-4" name="__codelineno-46-4"></a><span class="k">-</span><span class="w"> </span>高效转发
<a id="__codelineno-46-5" name="__codelineno-46-5"></a><span class="k">-</span><span class="w"> </span>违例恢复
<a id="__codelineno-46-6" name="__codelineno-46-6"></a>
<a id="__codelineno-46-7" name="__codelineno-46-7"></a>实现步骤：
<a id="__codelineno-46-8" name="__codelineno-46-8"></a><span class="k">1.</span> 依赖预测器
<a id="__codelineno-46-9" name="__codelineno-46-9"></a><span class="k">2.</span> 投机执行逻辑
<a id="__codelineno-46-10" name="__codelineno-46-10"></a><span class="k">3.</span> 优化转发
<a id="__codelineno-46-11" name="__codelineno-46-11"></a><span class="k">4.</span> 违例处理
<a id="__codelineno-46-12" name="__codelineno-46-12"></a>
<a id="__codelineno-46-13" name="__codelineno-46-13"></a>评估指标：
<a id="__codelineno-46-14" name="__codelineno-46-14"></a><span class="k">-</span><span class="w"> </span>Load带宽 &gt;= 2/周期
<a id="__codelineno-46-15" name="__codelineno-46-15"></a><span class="k">-</span><span class="w"> </span>Store带宽 &gt;= 1/周期
<a id="__codelineno-46-16" name="__codelineno-46-16"></a><span class="k">-</span><span class="w"> </span>预测准确率 &gt; 90%
<a id="__codelineno-46-17" name="__codelineno-46-17"></a><span class="k">-</span><span class="w"> </span>转发命中率 &gt; 90%
</code></pre></div></td></tr></table></div>
<h3 id="7-cache-subsystem"><span>7.<span class="heti-spacing"> </span></span>缓存子系统<span><span class="heti-spacing"> </span>(Cache Subsystem)</span><a class="headerlink" href="#7-cache-subsystem" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<h4 id="_32">具体规格<a class="headerlink" href="#_32" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<ol>
<li><span>L1<span class="heti-spacing"> </span></span>缓存配置</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Verilog</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-47-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-47-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-47-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-47-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-47-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-47-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-47-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-47-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-47-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-47-10">10</a></span>
<span class="normal"><a href="#__codelineno-47-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1"></a><span class="c1">// I-Cache配置</span>
<a id="__codelineno-47-2" name="__codelineno-47-2"></a><span class="k">parameter</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">ICACHE_SIZE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">32</span><span class="o">*</span><span class="mh">1024</span><span class="p">;</span><span class="w">    </span><span class="c1">// 32KB</span>
<a id="__codelineno-47-3" name="__codelineno-47-3"></a><span class="k">parameter</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">ICACHE_WAYS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">4</span><span class="p">;</span><span class="w">          </span><span class="c1">// 4路组相联</span>
<a id="__codelineno-47-4" name="__codelineno-47-4"></a><span class="k">parameter</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">ICACHE_LINE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">64</span><span class="p">;</span><span class="w">         </span><span class="c1">// 64B cache line</span>
<a id="__codelineno-47-5" name="__codelineno-47-5"></a>
<a id="__codelineno-47-6" name="__codelineno-47-6"></a><span class="c1">// D-Cache配置</span>
<a id="__codelineno-47-7" name="__codelineno-47-7"></a><span class="k">parameter</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">DCACHE_SIZE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">32</span><span class="o">*</span><span class="mh">1024</span><span class="p">;</span><span class="w">    </span><span class="c1">// 32KB</span>
<a id="__codelineno-47-8" name="__codelineno-47-8"></a><span class="k">parameter</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">DCACHE_WAYS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">8</span><span class="p">;</span><span class="w">          </span><span class="c1">// 8路组相联</span>
<a id="__codelineno-47-9" name="__codelineno-47-9"></a><span class="k">parameter</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">DCACHE_LINE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">64</span><span class="p">;</span><span class="w">         </span><span class="c1">// 64B cache line</span>
<a id="__codelineno-47-10" name="__codelineno-47-10"></a><span class="k">parameter</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">MSHR_NUM</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">8</span><span class="p">;</span><span class="w">             </span><span class="c1">// 8个MSHR条目</span>
<a id="__codelineno-47-11" name="__codelineno-47-11"></a><span class="k">parameter</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">WB_ENTRIES</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">16</span><span class="p">;</span><span class="w">          </span><span class="c1">// 16条写缓冲</span>
</code></pre></div></td></tr></table></div>
<ol start="2">
<li><span>L2<span class="heti-spacing"> </span></span>缓存配置</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Verilog</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-48-1">1</a></span>
<span class="normal"><a href="#__codelineno-48-2">2</a></span>
<span class="normal"><a href="#__codelineno-48-3">3</a></span>
<span class="normal"><a href="#__codelineno-48-4">4</a></span>
<span class="normal"><a href="#__codelineno-48-5">5</a></span>
<span class="normal"><a href="#__codelineno-48-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1"></a><span class="c1">// L2配置</span>
<a id="__codelineno-48-2" name="__codelineno-48-2"></a><span class="k">parameter</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">L2_SIZE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">256</span><span class="o">*</span><span class="mh">1024</span><span class="p">;</span><span class="w">       </span><span class="c1">// 256KB</span>
<a id="__codelineno-48-3" name="__codelineno-48-3"></a><span class="k">parameter</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">L2_WAYS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">8</span><span class="p">;</span><span class="w">              </span><span class="c1">// 8路组相联</span>
<a id="__codelineno-48-4" name="__codelineno-48-4"></a><span class="k">parameter</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">L2_LINE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">64</span><span class="p">;</span><span class="w">             </span><span class="c1">// 64B cache line</span>
<a id="__codelineno-48-5" name="__codelineno-48-5"></a><span class="k">parameter</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">L2_BANKS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">4</span><span class="p">;</span><span class="w">             </span><span class="c1">// 4个bank</span>
<a id="__codelineno-48-6" name="__codelineno-48-6"></a><span class="k">parameter</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">L2_MSHR_NUM</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">16</span><span class="p">;</span><span class="w">         </span><span class="c1">// 16个MSHR条目</span>
</code></pre></div></td></tr></table></div>
<ol start="3">
<li>接口定义</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Verilog</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-49-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-49-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-49-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-49-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-49-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-49-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-49-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-49-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-49-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-49-10">10</a></span>
<span class="normal"><a href="#__codelineno-49-11">11</a></span>
<span class="normal"><a href="#__codelineno-49-12">12</a></span>
<span class="normal"><a href="#__codelineno-49-13">13</a></span>
<span class="normal"><a href="#__codelineno-49-14">14</a></span>
<span class="normal"><a href="#__codelineno-49-15">15</a></span>
<span class="normal"><a href="#__codelineno-49-16">16</a></span>
<span class="normal"><a href="#__codelineno-49-17">17</a></span>
<span class="normal"><a href="#__codelineno-49-18">18</a></span>
<span class="normal"><a href="#__codelineno-49-19">19</a></span>
<span class="normal"><a href="#__codelineno-49-20">20</a></span>
<span class="normal"><a href="#__codelineno-49-21">21</a></span>
<span class="normal"><a href="#__codelineno-49-22">22</a></span>
<span class="normal"><a href="#__codelineno-49-23">23</a></span>
<span class="normal"><a href="#__codelineno-49-24">24</a></span>
<span class="normal"><a href="#__codelineno-49-25">25</a></span>
<span class="normal"><a href="#__codelineno-49-26">26</a></span>
<span class="normal"><a href="#__codelineno-49-27">27</a></span>
<span class="normal"><a href="#__codelineno-49-28">28</a></span>
<span class="normal"><a href="#__codelineno-49-29">29</a></span>
<span class="normal"><a href="#__codelineno-49-30">30</a></span>
<span class="normal"><a href="#__codelineno-49-31">31</a></span>
<span class="normal"><a href="#__codelineno-49-32">32</a></span>
<span class="normal"><a href="#__codelineno-49-33">33</a></span>
<span class="normal"><a href="#__codelineno-49-34">34</a></span>
<span class="normal"><a href="#__codelineno-49-35">35</a></span>
<span class="normal"><a href="#__codelineno-49-36">36</a></span>
<span class="normal"><a href="#__codelineno-49-37">37</a></span>
<span class="normal"><a href="#__codelineno-49-38">38</a></span>
<span class="normal"><a href="#__codelineno-49-39">39</a></span>
<span class="normal"><a href="#__codelineno-49-40">40</a></span>
<span class="normal"><a href="#__codelineno-49-41">41</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1"></a><span class="c1">// L1 I-Cache接口</span>
<a id="__codelineno-49-2" name="__codelineno-49-2"></a><span class="n">interface</span><span class="w"> </span><span class="n">icache_if</span><span class="p">;</span>
<a id="__codelineno-49-3" name="__codelineno-49-3"></a><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="mh">63</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">req_pc</span><span class="p">;</span>
<a id="__codelineno-49-4" name="__codelineno-49-4"></a><span class="w">  </span><span class="kt">logic</span><span class="w">        </span><span class="n">req_valid</span><span class="p">;</span>
<a id="__codelineno-49-5" name="__codelineno-49-5"></a><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="mh">255</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">resp_data</span><span class="p">;</span>
<a id="__codelineno-49-6" name="__codelineno-49-6"></a><span class="w">  </span><span class="kt">logic</span><span class="w">        </span><span class="n">resp_valid</span><span class="p">;</span>
<a id="__codelineno-49-7" name="__codelineno-49-7"></a><span class="n">endinterface</span>
<a id="__codelineno-49-8" name="__codelineno-49-8"></a>
<a id="__codelineno-49-9" name="__codelineno-49-9"></a><span class="c1">// L1 D-Cache接口</span>
<a id="__codelineno-49-10" name="__codelineno-49-10"></a><span class="n">interface</span><span class="w"> </span><span class="n">dcache_if</span><span class="p">;</span>
<a id="__codelineno-49-11" name="__codelineno-49-11"></a><span class="w">  </span><span class="c1">// 访问请求</span>
<a id="__codelineno-49-12" name="__codelineno-49-12"></a><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="mh">63</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">req_addr</span><span class="p">;</span>
<a id="__codelineno-49-13" name="__codelineno-49-13"></a><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="mh">63</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">req_data</span><span class="p">;</span>
<a id="__codelineno-49-14" name="__codelineno-49-14"></a><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">  </span><span class="n">req_mask</span><span class="p">;</span>
<a id="__codelineno-49-15" name="__codelineno-49-15"></a><span class="w">  </span><span class="kt">logic</span><span class="w">        </span><span class="n">req_wen</span><span class="p">;</span>
<a id="__codelineno-49-16" name="__codelineno-49-16"></a><span class="w">  </span><span class="kt">logic</span><span class="w">        </span><span class="n">req_valid</span><span class="p">;</span>
<a id="__codelineno-49-17" name="__codelineno-49-17"></a>
<a id="__codelineno-49-18" name="__codelineno-49-18"></a><span class="w">  </span><span class="c1">// 响应</span>
<a id="__codelineno-49-19" name="__codelineno-49-19"></a><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="mh">63</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">resp_data</span><span class="p">;</span>
<a id="__codelineno-49-20" name="__codelineno-49-20"></a><span class="w">  </span><span class="kt">logic</span><span class="w">        </span><span class="n">resp_valid</span><span class="p">;</span>
<a id="__codelineno-49-21" name="__codelineno-49-21"></a><span class="w">  </span><span class="kt">logic</span><span class="w">        </span><span class="n">resp_retry</span><span class="p">;</span>
<a id="__codelineno-49-22" name="__codelineno-49-22"></a><span class="n">endinterface</span>
<a id="__codelineno-49-23" name="__codelineno-49-23"></a>
<a id="__codelineno-49-24" name="__codelineno-49-24"></a><span class="c1">// L2接口</span>
<a id="__codelineno-49-25" name="__codelineno-49-25"></a><span class="n">interface</span><span class="w"> </span><span class="n">l2_if</span><span class="p">;</span>
<a id="__codelineno-49-26" name="__codelineno-49-26"></a><span class="w">  </span><span class="c1">// L1请求</span>
<a id="__codelineno-49-27" name="__codelineno-49-27"></a><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="mh">63</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">l1_req_addr</span><span class="p">;</span>
<a id="__codelineno-49-28" name="__codelineno-49-28"></a><span class="w">  </span><span class="kt">logic</span><span class="w">        </span><span class="n">l1_req_valid</span><span class="p">;</span>
<a id="__codelineno-49-29" name="__codelineno-49-29"></a><span class="w">  </span><span class="kt">logic</span><span class="w">        </span><span class="n">l1_req_wen</span><span class="p">;</span>
<a id="__codelineno-49-30" name="__codelineno-49-30"></a><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="mh">63</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">l1_req_data</span><span class="p">;</span>
<a id="__codelineno-49-31" name="__codelineno-49-31"></a>
<a id="__codelineno-49-32" name="__codelineno-49-32"></a><span class="w">  </span><span class="c1">// L2响应</span>
<a id="__codelineno-49-33" name="__codelineno-49-33"></a><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="mh">63</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">l2_resp_data</span><span class="p">;</span>
<a id="__codelineno-49-34" name="__codelineno-49-34"></a><span class="w">  </span><span class="kt">logic</span><span class="w">        </span><span class="n">l2_resp_valid</span><span class="p">;</span>
<a id="__codelineno-49-35" name="__codelineno-49-35"></a>
<a id="__codelineno-49-36" name="__codelineno-49-36"></a><span class="w">  </span><span class="c1">// 内存接口</span>
<a id="__codelineno-49-37" name="__codelineno-49-37"></a><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="mh">63</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">mem_req_addr</span><span class="p">;</span>
<a id="__codelineno-49-38" name="__codelineno-49-38"></a><span class="w">  </span><span class="kt">logic</span><span class="w">        </span><span class="n">mem_req_valid</span><span class="p">;</span>
<a id="__codelineno-49-39" name="__codelineno-49-39"></a><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="mh">63</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">mem_resp_data</span><span class="p">;</span>
<a id="__codelineno-49-40" name="__codelineno-49-40"></a><span class="w">  </span><span class="kt">logic</span><span class="w">        </span><span class="n">mem_resp_valid</span><span class="p">;</span>
<a id="__codelineno-49-41" name="__codelineno-49-41"></a><span class="n">endinterface</span>
</code></pre></div></td></tr></table></div>
<h4 id="_33">核心算法<a class="headerlink" href="#_33" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<ol>
<li>替换策略</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Verilog</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-50-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-50-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-50-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-50-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-50-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-50-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-50-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-50-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-50-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-50-10">10</a></span>
<span class="normal"><a href="#__codelineno-50-11">11</a></span>
<span class="normal"><a href="#__codelineno-50-12">12</a></span>
<span class="normal"><a href="#__codelineno-50-13">13</a></span>
<span class="normal"><a href="#__codelineno-50-14">14</a></span>
<span class="normal"><a href="#__codelineno-50-15">15</a></span>
<span class="normal"><a href="#__codelineno-50-16">16</a></span>
<span class="normal"><a href="#__codelineno-50-17">17</a></span>
<span class="normal"><a href="#__codelineno-50-18">18</a></span>
<span class="normal"><a href="#__codelineno-50-19">19</a></span>
<span class="normal"><a href="#__codelineno-50-20">20</a></span>
<span class="normal"><a href="#__codelineno-50-21">21</a></span>
<span class="normal"><a href="#__codelineno-50-22">22</a></span>
<span class="normal"><a href="#__codelineno-50-23">23</a></span>
<span class="normal"><a href="#__codelineno-50-24">24</a></span>
<span class="normal"><a href="#__codelineno-50-25">25</a></span>
<span class="normal"><a href="#__codelineno-50-26">26</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1"></a><span class="c1">// PLRU (Pseudo-LRU)实现</span>
<a id="__codelineno-50-2" name="__codelineno-50-2"></a><span class="k">module</span><span class="w"> </span><span class="n">plru</span><span class="w"> </span><span class="p">#(</span>
<a id="__codelineno-50-3" name="__codelineno-50-3"></a><span class="w">  </span><span class="k">parameter</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">WAYS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">8</span>
<a id="__codelineno-50-4" name="__codelineno-50-4"></a><span class="p">)(</span>
<a id="__codelineno-50-5" name="__codelineno-50-5"></a><span class="w">  </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="n">clk</span><span class="p">,</span>
<a id="__codelineno-50-6" name="__codelineno-50-6"></a><span class="w">  </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="n">rst_n</span><span class="p">,</span>
<a id="__codelineno-50-7" name="__codelineno-50-7"></a>
<a id="__codelineno-50-8" name="__codelineno-50-8"></a><span class="w">  </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="n">WAYS</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">access</span><span class="p">,</span>
<a id="__codelineno-50-9" name="__codelineno-50-9"></a><span class="w">  </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="n">update</span><span class="p">,</span>
<a id="__codelineno-50-10" name="__codelineno-50-10"></a><span class="w">  </span><span class="k">output</span><span class="w"> </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="n">$clog2</span><span class="p">(</span><span class="n">WAYS</span><span class="p">)</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">replace_way</span>
<a id="__codelineno-50-11" name="__codelineno-50-11"></a><span class="p">);</span>
<a id="__codelineno-50-12" name="__codelineno-50-12"></a>
<a id="__codelineno-50-13" name="__codelineno-50-13"></a><span class="c1">// 二叉树实现</span>
<a id="__codelineno-50-14" name="__codelineno-50-14"></a><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="n">WAYS</span><span class="o">-</span><span class="mh">2</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">plru_bits</span><span class="p">;</span>
<a id="__codelineno-50-15" name="__codelineno-50-15"></a>
<a id="__codelineno-50-16" name="__codelineno-50-16"></a><span class="c1">// 更新逻辑</span>
<a id="__codelineno-50-17" name="__codelineno-50-17"></a><span class="k">always_ff</span><span class="w"> </span><span class="p">@(</span><span class="k">posedge</span><span class="w"> </span><span class="n">clk</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span>
<a id="__codelineno-50-18" name="__codelineno-50-18"></a><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">rst_n</span><span class="p">)</span>
<a id="__codelineno-50-19" name="__codelineno-50-19"></a><span class="w">    </span><span class="n">plru_bits</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="m">'0</span><span class="p">;</span>
<a id="__codelineno-50-20" name="__codelineno-50-20"></a><span class="w">  </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">update</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span>
<a id="__codelineno-50-21" name="__codelineno-50-21"></a><span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">WAYS</span><span class="o">-</span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span>
<a id="__codelineno-50-22" name="__codelineno-50-22"></a><span class="w">      </span><span class="k">if</span><span class="p">(</span><span class="n">access</span><span class="p">[</span><span class="n">tree_to_way</span><span class="p">(</span><span class="n">i</span><span class="p">)])</span>
<a id="__codelineno-50-23" name="__codelineno-50-23"></a><span class="w">        </span><span class="n">plru_bits</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="o">~</span><span class="n">plru_bits</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<a id="__codelineno-50-24" name="__codelineno-50-24"></a><span class="w">    </span><span class="k">end</span>
<a id="__codelineno-50-25" name="__codelineno-50-25"></a><span class="w">  </span><span class="k">end</span>
<a id="__codelineno-50-26" name="__codelineno-50-26"></a><span class="k">end</span>
</code></pre></div></td></tr></table></div>
<ol start="2">
<li><span>MSHR<span class="heti-spacing"> </span></span>设计</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Verilog</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-51-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-51-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-51-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-51-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-51-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-51-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-51-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-51-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-51-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-51-10">10</a></span>
<span class="normal"><a href="#__codelineno-51-11">11</a></span>
<span class="normal"><a href="#__codelineno-51-12">12</a></span>
<span class="normal"><a href="#__codelineno-51-13">13</a></span>
<span class="normal"><a href="#__codelineno-51-14">14</a></span>
<span class="normal"><a href="#__codelineno-51-15">15</a></span>
<span class="normal"><a href="#__codelineno-51-16">16</a></span>
<span class="normal"><a href="#__codelineno-51-17">17</a></span>
<span class="normal"><a href="#__codelineno-51-18">18</a></span>
<span class="normal"><a href="#__codelineno-51-19">19</a></span>
<span class="normal"><a href="#__codelineno-51-20">20</a></span>
<span class="normal"><a href="#__codelineno-51-21">21</a></span>
<span class="normal"><a href="#__codelineno-51-22">22</a></span>
<span class="normal"><a href="#__codelineno-51-23">23</a></span>
<span class="normal"><a href="#__codelineno-51-24">24</a></span>
<span class="normal"><a href="#__codelineno-51-25">25</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-51-1" name="__codelineno-51-1"></a><span class="c1">// Miss Status Holding Register</span>
<a id="__codelineno-51-2" name="__codelineno-51-2"></a><span class="k">module</span><span class="w"> </span><span class="n">mshr</span><span class="w"> </span><span class="p">#(</span>
<a id="__codelineno-51-3" name="__codelineno-51-3"></a><span class="w">  </span><span class="k">parameter</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">ENTRIES</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">8</span><span class="p">,</span>
<a id="__codelineno-51-4" name="__codelineno-51-4"></a><span class="w">  </span><span class="k">parameter</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">ADDR_WIDTH</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">64</span><span class="p">,</span>
<a id="__codelineno-51-5" name="__codelineno-51-5"></a><span class="w">  </span><span class="k">parameter</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">DATA_WIDTH</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">512</span>
<a id="__codelineno-51-6" name="__codelineno-51-6"></a><span class="p">)(</span>
<a id="__codelineno-51-7" name="__codelineno-51-7"></a><span class="w">  </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="n">clk</span><span class="p">,</span>
<a id="__codelineno-51-8" name="__codelineno-51-8"></a><span class="w">  </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="n">rst_n</span><span class="p">,</span>
<a id="__codelineno-51-9" name="__codelineno-51-9"></a>
<a id="__codelineno-51-10" name="__codelineno-51-10"></a><span class="w">  </span><span class="c1">// 新miss请求</span>
<a id="__codelineno-51-11" name="__codelineno-51-11"></a><span class="w">  </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="n">ADDR_WIDTH</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">miss_addr</span><span class="p">,</span>
<a id="__codelineno-51-12" name="__codelineno-51-12"></a><span class="w">  </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w">                  </span><span class="n">miss_valid</span><span class="p">,</span>
<a id="__codelineno-51-13" name="__codelineno-51-13"></a><span class="w">  </span><span class="k">output</span><span class="w"> </span><span class="kt">logic</span><span class="w">                  </span><span class="n">mshr_ready</span><span class="p">,</span>
<a id="__codelineno-51-14" name="__codelineno-51-14"></a>
<a id="__codelineno-51-15" name="__codelineno-51-15"></a><span class="w">  </span><span class="c1">// Fill响应</span>
<a id="__codelineno-51-16" name="__codelineno-51-16"></a><span class="w">  </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="n">ADDR_WIDTH</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">fill_addr</span><span class="p">,</span>
<a id="__codelineno-51-17" name="__codelineno-51-17"></a><span class="w">  </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="n">DATA_WIDTH</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">fill_data</span><span class="p">,</span>
<a id="__codelineno-51-18" name="__codelineno-51-18"></a><span class="w">  </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w">                  </span><span class="n">fill_valid</span><span class="p">,</span>
<a id="__codelineno-51-19" name="__codelineno-51-19"></a>
<a id="__codelineno-51-20" name="__codelineno-51-20"></a><span class="w">  </span><span class="c1">// 依赖请求</span>
<a id="__codelineno-51-21" name="__codelineno-51-21"></a><span class="w">  </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="n">ADDR_WIDTH</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">dep_addr</span><span class="p">,</span>
<a id="__codelineno-51-22" name="__codelineno-51-22"></a><span class="w">  </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w">                  </span><span class="n">dep_valid</span><span class="p">,</span>
<a id="__codelineno-51-23" name="__codelineno-51-23"></a><span class="w">  </span><span class="k">output</span><span class="w"> </span><span class="kt">logic</span><span class="w">                  </span><span class="n">dep_hit</span><span class="p">,</span>
<a id="__codelineno-51-24" name="__codelineno-51-24"></a><span class="w">  </span><span class="k">output</span><span class="w"> </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="n">$clog2</span><span class="p">(</span><span class="n">ENTRIES</span><span class="p">)</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">dep_mshr_id</span>
<a id="__codelineno-51-25" name="__codelineno-51-25"></a><span class="p">);</span>
</code></pre></div></td></tr></table></div>
<ol start="3">
<li>预取逻辑</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Verilog</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-52-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-52-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-52-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-52-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-52-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-52-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-52-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-52-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-52-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-52-10">10</a></span>
<span class="normal"><a href="#__codelineno-52-11">11</a></span>
<span class="normal"><a href="#__codelineno-52-12">12</a></span>
<span class="normal"><a href="#__codelineno-52-13">13</a></span>
<span class="normal"><a href="#__codelineno-52-14">14</a></span>
<span class="normal"><a href="#__codelineno-52-15">15</a></span>
<span class="normal"><a href="#__codelineno-52-16">16</a></span>
<span class="normal"><a href="#__codelineno-52-17">17</a></span>
<span class="normal"><a href="#__codelineno-52-18">18</a></span>
<span class="normal"><a href="#__codelineno-52-19">19</a></span>
<span class="normal"><a href="#__codelineno-52-20">20</a></span>
<span class="normal"><a href="#__codelineno-52-21">21</a></span>
<span class="normal"><a href="#__codelineno-52-22">22</a></span>
<span class="normal"><a href="#__codelineno-52-23">23</a></span>
<span class="normal"><a href="#__codelineno-52-24">24</a></span>
<span class="normal"><a href="#__codelineno-52-25">25</a></span>
<span class="normal"><a href="#__codelineno-52-26">26</a></span>
<span class="normal"><a href="#__codelineno-52-27">27</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-52-1" name="__codelineno-52-1"></a><span class="c1">// 流式预取器</span>
<a id="__codelineno-52-2" name="__codelineno-52-2"></a><span class="k">module</span><span class="w"> </span><span class="n">stream_prefetcher</span><span class="w"> </span><span class="p">#(</span>
<a id="__codelineno-52-3" name="__codelineno-52-3"></a><span class="w">  </span><span class="k">parameter</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">STREAMS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">4</span><span class="p">,</span>
<a id="__codelineno-52-4" name="__codelineno-52-4"></a><span class="w">  </span><span class="k">parameter</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">DEPTH</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">4</span>
<a id="__codelineno-52-5" name="__codelineno-52-5"></a><span class="p">)(</span>
<a id="__codelineno-52-6" name="__codelineno-52-6"></a><span class="w">  </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="n">clk</span><span class="p">,</span>
<a id="__codelineno-52-7" name="__codelineno-52-7"></a><span class="w">  </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="n">rst_n</span><span class="p">,</span>
<a id="__codelineno-52-8" name="__codelineno-52-8"></a>
<a id="__codelineno-52-9" name="__codelineno-52-9"></a><span class="w">  </span><span class="c1">// 访问监控</span>
<a id="__codelineno-52-10" name="__codelineno-52-10"></a><span class="w">  </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="mh">63</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">access_addr</span><span class="p">,</span>
<a id="__codelineno-52-11" name="__codelineno-52-11"></a><span class="w">  </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w">        </span><span class="n">access_valid</span><span class="p">,</span>
<a id="__codelineno-52-12" name="__codelineno-52-12"></a>
<a id="__codelineno-52-13" name="__codelineno-52-13"></a><span class="w">  </span><span class="c1">// 预取请求</span>
<a id="__codelineno-52-14" name="__codelineno-52-14"></a><span class="w">  </span><span class="k">output</span><span class="w"> </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="mh">63</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">pf_addr</span><span class="p">,</span>
<a id="__codelineno-52-15" name="__codelineno-52-15"></a><span class="w">  </span><span class="k">output</span><span class="w"> </span><span class="kt">logic</span><span class="w">        </span><span class="n">pf_valid</span><span class="p">,</span>
<a id="__codelineno-52-16" name="__codelineno-52-16"></a><span class="w">  </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w">        </span><span class="n">pf_ready</span>
<a id="__codelineno-52-17" name="__codelineno-52-17"></a><span class="p">);</span>
<a id="__codelineno-52-18" name="__codelineno-52-18"></a>
<a id="__codelineno-52-19" name="__codelineno-52-19"></a><span class="c1">// 流跟踪器</span>
<a id="__codelineno-52-20" name="__codelineno-52-20"></a><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="k">packed</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-52-21" name="__codelineno-52-21"></a><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="mh">63</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">base</span><span class="p">;</span>
<a id="__codelineno-52-22" name="__codelineno-52-22"></a><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="mh">63</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">stride</span><span class="p">;</span>
<a id="__codelineno-52-23" name="__codelineno-52-23"></a><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="mh">2</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">  </span><span class="n">conf</span><span class="p">;</span>
<a id="__codelineno-52-24" name="__codelineno-52-24"></a><span class="w">  </span><span class="kt">logic</span><span class="w">        </span><span class="n">valid</span><span class="p">;</span>
<a id="__codelineno-52-25" name="__codelineno-52-25"></a><span class="p">}</span><span class="w"> </span><span class="n">stream_t</span><span class="p">;</span>
<a id="__codelineno-52-26" name="__codelineno-52-26"></a>
<a id="__codelineno-52-27" name="__codelineno-52-27"></a><span class="n">stream_t</span><span class="w"> </span><span class="n">streams</span><span class="w"> </span><span class="p">[</span><span class="n">STREAMS</span><span class="p">];</span>
</code></pre></div></td></tr></table></div>
<h4 id="_34">推荐课程<a class="headerlink" href="#_34" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<ol>
<li>
<p>主课程
   - MIT 6.823: Cache Memory Systems
   - Stanford EE382A: Memory Hierarchy Design
   - CMU 18-447: Cache Design</p>
</li>
<li>
<p>工程实践
   - "High Performance Cache Designs"
   - "Modern Cache Architecture"
   - RISC-V缓存实现指南</p>
</li>
</ol>
<h4 id="_35">验证策略<a class="headerlink" href="#_35" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<ol>
<li>功能测试</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Systemverilog</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-53-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-53-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-53-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-53-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-53-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-53-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-53-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-53-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-53-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-53-10">10</a></span>
<span class="normal"><a href="#__codelineno-53-11">11</a></span>
<span class="normal"><a href="#__codelineno-53-12">12</a></span>
<span class="normal"><a href="#__codelineno-53-13">13</a></span>
<span class="normal"><a href="#__codelineno-53-14">14</a></span>
<span class="normal"><a href="#__codelineno-53-15">15</a></span>
<span class="normal"><a href="#__codelineno-53-16">16</a></span>
<span class="normal"><a href="#__codelineno-53-17">17</a></span>
<span class="normal"><a href="#__codelineno-53-18">18</a></span>
<span class="normal"><a href="#__codelineno-53-19">19</a></span>
<span class="normal"><a href="#__codelineno-53-20">20</a></span>
<span class="normal"><a href="#__codelineno-53-21">21</a></span>
<span class="normal"><a href="#__codelineno-53-22">22</a></span>
<span class="normal"><a href="#__codelineno-53-23">23</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-53-1" name="__codelineno-53-1"></a><span class="c1">// 基本功能测试</span>
<a id="__codelineno-53-2" name="__codelineno-53-2"></a><span class="k">task</span><span class="w"> </span><span class="n">test_cache_basic</span><span class="p">();</span>
<a id="__codelineno-53-3" name="__codelineno-53-3"></a><span class="w">  </span><span class="c1">// 读写操作</span>
<a id="__codelineno-53-4" name="__codelineno-53-4"></a><span class="w">  </span><span class="n">test_read_write</span><span class="p">();</span>
<a id="__codelineno-53-5" name="__codelineno-53-5"></a>
<a id="__codelineno-53-6" name="__codelineno-53-6"></a><span class="w">  </span><span class="c1">// 替换策略</span>
<a id="__codelineno-53-7" name="__codelineno-53-7"></a><span class="w">  </span><span class="n">test_replacement</span><span class="p">();</span>
<a id="__codelineno-53-8" name="__codelineno-53-8"></a>
<a id="__codelineno-53-9" name="__codelineno-53-9"></a><span class="w">  </span><span class="c1">// Miss处理</span>
<a id="__codelineno-53-10" name="__codelineno-53-10"></a><span class="w">  </span><span class="n">test_miss_handling</span><span class="p">();</span>
<a id="__codelineno-53-11" name="__codelineno-53-11"></a><span class="k">endtask</span>
<a id="__codelineno-53-12" name="__codelineno-53-12"></a>
<a id="__codelineno-53-13" name="__codelineno-53-13"></a><span class="c1">// 高级特性测试</span>
<a id="__codelineno-53-14" name="__codelineno-53-14"></a><span class="k">task</span><span class="w"> </span><span class="n">test_cache_advanced</span><span class="p">();</span>
<a id="__codelineno-53-15" name="__codelineno-53-15"></a><span class="w">  </span><span class="c1">// 预取效果</span>
<a id="__codelineno-53-16" name="__codelineno-53-16"></a><span class="w">  </span><span class="n">test_prefetch</span><span class="p">();</span>
<a id="__codelineno-53-17" name="__codelineno-53-17"></a>
<a id="__codelineno-53-18" name="__codelineno-53-18"></a><span class="w">  </span><span class="c1">// MSHR处理</span>
<a id="__codelineno-53-19" name="__codelineno-53-19"></a><span class="w">  </span><span class="n">test_mshr</span><span class="p">();</span>
<a id="__codelineno-53-20" name="__codelineno-53-20"></a>
<a id="__codelineno-53-21" name="__codelineno-53-21"></a><span class="w">  </span><span class="c1">// 写缓冲</span>
<a id="__codelineno-53-22" name="__codelineno-53-22"></a><span class="w">  </span><span class="n">test_write_buffer</span><span class="p">();</span>
<a id="__codelineno-53-23" name="__codelineno-53-23"></a><span class="k">endtask</span>
</code></pre></div></td></tr></table></div>
<ol start="2">
<li>性能测试</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-54-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-54-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-54-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-54-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-54-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-54-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-54-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-54-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-54-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-54-10">10</a></span>
<span class="normal"><a href="#__codelineno-54-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-54-1" name="__codelineno-54-1"></a><span class="c1"># 命中率测试</span>
<a id="__codelineno-54-2" name="__codelineno-54-2"></a>./cache_test.sh<span class="w"> </span>--mode<span class="w"> </span>hit_rate
<a id="__codelineno-54-3" name="__codelineno-54-3"></a>
<a id="__codelineno-54-4" name="__codelineno-54-4"></a><span class="c1"># 带宽测试</span>
<a id="__codelineno-54-5" name="__codelineno-54-5"></a>./cache_test.sh<span class="w"> </span>--mode<span class="w"> </span>bandwidth
<a id="__codelineno-54-6" name="__codelineno-54-6"></a>
<a id="__codelineno-54-7" name="__codelineno-54-7"></a><span class="c1"># 延迟测试</span>
<a id="__codelineno-54-8" name="__codelineno-54-8"></a>./cache_test.sh<span class="w"> </span>--mode<span class="w"> </span>latency
<a id="__codelineno-54-9" name="__codelineno-54-9"></a>
<a id="__codelineno-54-10" name="__codelineno-54-10"></a><span class="c1"># 预取效果</span>
<a id="__codelineno-54-11" name="__codelineno-54-11"></a>./cache_test.sh<span class="w"> </span>--mode<span class="w"> </span>prefetch_accuracy
</code></pre></div></td></tr></table></div>
<h4 id="_36">实现项目<a class="headerlink" href="#_36" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<ol>
<li>基础缓存系统</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Markdown</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-55-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-55-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-55-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-55-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-55-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-55-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-55-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-55-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-55-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-55-10">10</a></span>
<span class="normal"><a href="#__codelineno-55-11">11</a></span>
<span class="normal"><a href="#__codelineno-55-12">12</a></span>
<span class="normal"><a href="#__codelineno-55-13">13</a></span>
<span class="normal"><a href="#__codelineno-55-14">14</a></span>
<span class="normal"><a href="#__codelineno-55-15">15</a></span>
<span class="normal"><a href="#__codelineno-55-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-55-1" name="__codelineno-55-1"></a>要求：
<a id="__codelineno-55-2" name="__codelineno-55-2"></a><span class="k">-</span><span class="w"> </span>L1 I/D-Cache (32KB)
<a id="__codelineno-55-3" name="__codelineno-55-3"></a><span class="k">-</span><span class="w"> </span>基本MSHR
<a id="__codelineno-55-4" name="__codelineno-55-4"></a><span class="k">-</span><span class="w"> </span>简单预取
<a id="__codelineno-55-5" name="__codelineno-55-5"></a><span class="k">-</span><span class="w"> </span>写缓冲
<a id="__codelineno-55-6" name="__codelineno-55-6"></a>
<a id="__codelineno-55-7" name="__codelineno-55-7"></a>实现步骤：
<a id="__codelineno-55-8" name="__codelineno-55-8"></a><span class="k">1.</span> Cache控制器
<a id="__codelineno-55-9" name="__codelineno-55-9"></a><span class="k">2.</span> MSHR实现
<a id="__codelineno-55-10" name="__codelineno-55-10"></a><span class="k">3.</span> 替换策略
<a id="__codelineno-55-11" name="__codelineno-55-11"></a><span class="k">4.</span> 预取器
<a id="__codelineno-55-12" name="__codelineno-55-12"></a>
<a id="__codelineno-55-13" name="__codelineno-55-13"></a>评估指标：
<a id="__codelineno-55-14" name="__codelineno-55-14"></a><span class="k">-</span><span class="w"> </span>I-Cache命中率 &gt; 95%
<a id="__codelineno-55-15" name="__codelineno-55-15"></a><span class="k">-</span><span class="w"> </span>D-Cache命中率 &gt; 90%
<a id="__codelineno-55-16" name="__codelineno-55-16"></a><span class="k">-</span><span class="w"> </span>平均访问延迟 &lt; 3周期
</code></pre></div></td></tr></table></div>
<ol start="2">
<li>高级缓存系统</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Markdown</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-56-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-56-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-56-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-56-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-56-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-56-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-56-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-56-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-56-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-56-10">10</a></span>
<span class="normal"><a href="#__codelineno-56-11">11</a></span>
<span class="normal"><a href="#__codelineno-56-12">12</a></span>
<span class="normal"><a href="#__codelineno-56-13">13</a></span>
<span class="normal"><a href="#__codelineno-56-14">14</a></span>
<span class="normal"><a href="#__codelineno-56-15">15</a></span>
<span class="normal"><a href="#__codelineno-56-16">16</a></span>
<span class="normal"><a href="#__codelineno-56-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-56-1" name="__codelineno-56-1"></a>要求：
<a id="__codelineno-56-2" name="__codelineno-56-2"></a><span class="k">-</span><span class="w"> </span>多级缓存(L1+L2)
<a id="__codelineno-56-3" name="__codelineno-56-3"></a><span class="k">-</span><span class="w"> </span>复杂预取
<a id="__codelineno-56-4" name="__codelineno-56-4"></a><span class="k">-</span><span class="w"> </span>高级MSHR
<a id="__codelineno-56-5" name="__codelineno-56-5"></a><span class="k">-</span><span class="w"> </span>优化写策略
<a id="__codelineno-56-6" name="__codelineno-56-6"></a>
<a id="__codelineno-56-7" name="__codelineno-56-7"></a>实现步骤：
<a id="__codelineno-56-8" name="__codelineno-56-8"></a><span class="k">1.</span> L2设计
<a id="__codelineno-56-9" name="__codelineno-56-9"></a><span class="k">2.</span> 高级预取器
<a id="__codelineno-56-10" name="__codelineno-56-10"></a><span class="k">3.</span> MSHR优化
<a id="__codelineno-56-11" name="__codelineno-56-11"></a><span class="k">4.</span> 带宽优化
<a id="__codelineno-56-12" name="__codelineno-56-12"></a>
<a id="__codelineno-56-13" name="__codelineno-56-13"></a>评估指标：
<a id="__codelineno-56-14" name="__codelineno-56-14"></a><span class="k">-</span><span class="w"> </span>L1命中率 &gt; 95%
<a id="__codelineno-56-15" name="__codelineno-56-15"></a><span class="k">-</span><span class="w"> </span>L2命中率 &gt; 80%
<a id="__codelineno-56-16" name="__codelineno-56-16"></a><span class="k">-</span><span class="w"> </span>预取准确率 &gt; 85%
<a id="__codelineno-56-17" name="__codelineno-56-17"></a><span class="k">-</span><span class="w"> </span>平均访问延迟 &lt; 5周期
</code></pre></div></td></tr></table></div>
<h3 id="8-memory-interface"><span>8.<span class="heti-spacing"> </span></span>主存接口<span><span class="heti-spacing"> </span>(Memory Interface)</span><a class="headerlink" href="#8-memory-interface" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<h4 id="_37">具体规格<a class="headerlink" href="#_37" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<ol>
<li>配置参数</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Verilog</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-57-1">1</a></span>
<span class="normal"><a href="#__codelineno-57-2">2</a></span>
<span class="normal"><a href="#__codelineno-57-3">3</a></span>
<span class="normal"><a href="#__codelineno-57-4">4</a></span>
<span class="normal"><a href="#__codelineno-57-5">5</a></span>
<span class="normal"><a href="#__codelineno-57-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-57-1" name="__codelineno-57-1"></a><span class="c1">// 内存接口配置</span>
<a id="__codelineno-57-2" name="__codelineno-57-2"></a><span class="k">parameter</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">AXI_ID_WIDTH</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">4</span><span class="p">;</span>
<a id="__codelineno-57-3" name="__codelineno-57-3"></a><span class="k">parameter</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">AXI_ADDR_WIDTH</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">64</span><span class="p">;</span>
<a id="__codelineno-57-4" name="__codelineno-57-4"></a><span class="k">parameter</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">AXI_DATA_WIDTH</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">512</span><span class="p">;</span>
<a id="__codelineno-57-5" name="__codelineno-57-5"></a><span class="k">parameter</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">MAX_TRANS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">16</span><span class="p">;</span>
<a id="__codelineno-57-6" name="__codelineno-57-6"></a><span class="k">parameter</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">MAX_BURST</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">8</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
<ol start="2">
<li>接口定义</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Verilog</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-58-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-58-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-58-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-58-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-58-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-58-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-58-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-58-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-58-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-58-10">10</a></span>
<span class="normal"><a href="#__codelineno-58-11">11</a></span>
<span class="normal"><a href="#__codelineno-58-12">12</a></span>
<span class="normal"><a href="#__codelineno-58-13">13</a></span>
<span class="normal"><a href="#__codelineno-58-14">14</a></span>
<span class="normal"><a href="#__codelineno-58-15">15</a></span>
<span class="normal"><a href="#__codelineno-58-16">16</a></span>
<span class="normal"><a href="#__codelineno-58-17">17</a></span>
<span class="normal"><a href="#__codelineno-58-18">18</a></span>
<span class="normal"><a href="#__codelineno-58-19">19</a></span>
<span class="normal"><a href="#__codelineno-58-20">20</a></span>
<span class="normal"><a href="#__codelineno-58-21">21</a></span>
<span class="normal"><a href="#__codelineno-58-22">22</a></span>
<span class="normal"><a href="#__codelineno-58-23">23</a></span>
<span class="normal"><a href="#__codelineno-58-24">24</a></span>
<span class="normal"><a href="#__codelineno-58-25">25</a></span>
<span class="normal"><a href="#__codelineno-58-26">26</a></span>
<span class="normal"><a href="#__codelineno-58-27">27</a></span>
<span class="normal"><a href="#__codelineno-58-28">28</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-58-1" name="__codelineno-58-1"></a><span class="c1">// AXI接口</span>
<a id="__codelineno-58-2" name="__codelineno-58-2"></a><span class="n">interface</span><span class="w"> </span><span class="n">axi_if</span><span class="p">;</span>
<a id="__codelineno-58-3" name="__codelineno-58-3"></a><span class="w">  </span><span class="c1">// 地址通道</span>
<a id="__codelineno-58-4" name="__codelineno-58-4"></a><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="n">AXI_ID_WIDTH</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">   </span><span class="n">awid</span><span class="p">;</span>
<a id="__codelineno-58-5" name="__codelineno-58-5"></a><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="n">AXI_ADDR_WIDTH</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">awaddr</span><span class="p">;</span>
<a id="__codelineno-58-6" name="__codelineno-58-6"></a><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">                </span><span class="n">awlen</span><span class="p">;</span>
<a id="__codelineno-58-7" name="__codelineno-58-7"></a><span class="w">  </span><span class="kt">logic</span><span class="w">                      </span><span class="n">awvalid</span><span class="p">;</span>
<a id="__codelineno-58-8" name="__codelineno-58-8"></a><span class="w">  </span><span class="kt">logic</span><span class="w">                      </span><span class="n">awready</span><span class="p">;</span>
<a id="__codelineno-58-9" name="__codelineno-58-9"></a>
<a id="__codelineno-58-10" name="__codelineno-58-10"></a><span class="w">  </span><span class="c1">// 写数据通道</span>
<a id="__codelineno-58-11" name="__codelineno-58-11"></a><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="n">AXI_DATA_WIDTH</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">wdata</span><span class="p">;</span>
<a id="__codelineno-58-12" name="__codelineno-58-12"></a><span class="w">  </span><span class="kt">logic</span><span class="w">                      </span><span class="n">wlast</span><span class="p">;</span>
<a id="__codelineno-58-13" name="__codelineno-58-13"></a><span class="w">  </span><span class="kt">logic</span><span class="w">                      </span><span class="n">wvalid</span><span class="p">;</span>
<a id="__codelineno-58-14" name="__codelineno-58-14"></a><span class="w">  </span><span class="kt">logic</span><span class="w">                      </span><span class="n">wready</span><span class="p">;</span>
<a id="__codelineno-58-15" name="__codelineno-58-15"></a>
<a id="__codelineno-58-16" name="__codelineno-58-16"></a><span class="w">  </span><span class="c1">// 读地址通道</span>
<a id="__codelineno-58-17" name="__codelineno-58-17"></a><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="n">AXI_ID_WIDTH</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">   </span><span class="n">arid</span><span class="p">;</span>
<a id="__codelineno-58-18" name="__codelineno-58-18"></a><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="n">AXI_ADDR_WIDTH</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">araddr</span><span class="p">;</span>
<a id="__codelineno-58-19" name="__codelineno-58-19"></a><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">                </span><span class="n">arlen</span><span class="p">;</span>
<a id="__codelineno-58-20" name="__codelineno-58-20"></a><span class="w">  </span><span class="kt">logic</span><span class="w">                      </span><span class="n">arvalid</span><span class="p">;</span>
<a id="__codelineno-58-21" name="__codelineno-58-21"></a><span class="w">  </span><span class="kt">logic</span><span class="w">                      </span><span class="n">arready</span><span class="p">;</span>
<a id="__codelineno-58-22" name="__codelineno-58-22"></a>
<a id="__codelineno-58-23" name="__codelineno-58-23"></a><span class="w">  </span><span class="c1">// 读数据通道</span>
<a id="__codelineno-58-24" name="__codelineno-58-24"></a><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="n">AXI_DATA_WIDTH</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">rdata</span><span class="p">;</span>
<a id="__codelineno-58-25" name="__codelineno-58-25"></a><span class="w">  </span><span class="kt">logic</span><span class="w">                      </span><span class="n">rlast</span><span class="p">;</span>
<a id="__codelineno-58-26" name="__codelineno-58-26"></a><span class="w">  </span><span class="kt">logic</span><span class="w">                      </span><span class="n">rvalid</span><span class="p">;</span>
<a id="__codelineno-58-27" name="__codelineno-58-27"></a><span class="w">  </span><span class="kt">logic</span><span class="w">                      </span><span class="n">rready</span><span class="p">;</span>
<a id="__codelineno-58-28" name="__codelineno-58-28"></a><span class="n">endinterface</span>
</code></pre></div></td></tr></table></div>
<h3 id="8-memory-interface_1"><span>8.<span class="heti-spacing"> </span></span>主存接口<span class="heti-skip"><span class="heti-spacing"> </span>(Memory Interface)<span class="heti-spacing"> </span></span>续<a class="headerlink" href="#8-memory-interface_1" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<h4 id="_38">核心算法<a class="headerlink" href="#_38" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<ol>
<li>访问调度</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Verilog</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-59-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-59-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-59-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-59-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-59-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-59-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-59-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-59-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-59-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-59-10">10</a></span>
<span class="normal"><a href="#__codelineno-59-11">11</a></span>
<span class="normal"><a href="#__codelineno-59-12">12</a></span>
<span class="normal"><a href="#__codelineno-59-13">13</a></span>
<span class="normal"><a href="#__codelineno-59-14">14</a></span>
<span class="normal"><a href="#__codelineno-59-15">15</a></span>
<span class="normal"><a href="#__codelineno-59-16">16</a></span>
<span class="normal"><a href="#__codelineno-59-17">17</a></span>
<span class="normal"><a href="#__codelineno-59-18">18</a></span>
<span class="normal"><a href="#__codelineno-59-19">19</a></span>
<span class="normal"><a href="#__codelineno-59-20">20</a></span>
<span class="normal"><a href="#__codelineno-59-21">21</a></span>
<span class="normal"><a href="#__codelineno-59-22">22</a></span>
<span class="normal"><a href="#__codelineno-59-23">23</a></span>
<span class="normal"><a href="#__codelineno-59-24">24</a></span>
<span class="normal"><a href="#__codelineno-59-25">25</a></span>
<span class="normal"><a href="#__codelineno-59-26">26</a></span>
<span class="normal"><a href="#__codelineno-59-27">27</a></span>
<span class="normal"><a href="#__codelineno-59-28">28</a></span>
<span class="normal"><a href="#__codelineno-59-29">29</a></span>
<span class="normal"><a href="#__codelineno-59-30">30</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-59-1" name="__codelineno-59-1"></a><span class="c1">// 内存访问调度器</span>
<a id="__codelineno-59-2" name="__codelineno-59-2"></a><span class="k">module</span><span class="w"> </span><span class="n">memory_scheduler</span><span class="w"> </span><span class="p">#(</span>
<a id="__codelineno-59-3" name="__codelineno-59-3"></a><span class="w">  </span><span class="k">parameter</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">MAX_TRANS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">16</span><span class="p">,</span>
<a id="__codelineno-59-4" name="__codelineno-59-4"></a><span class="w">  </span><span class="k">parameter</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">MAX_BURST</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">8</span>
<a id="__codelineno-59-5" name="__codelineno-59-5"></a><span class="p">)(</span>
<a id="__codelineno-59-6" name="__codelineno-59-6"></a><span class="w">  </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="n">clk</span><span class="p">,</span>
<a id="__codelineno-59-7" name="__codelineno-59-7"></a><span class="w">  </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="n">rst_n</span><span class="p">,</span>
<a id="__codelineno-59-8" name="__codelineno-59-8"></a>
<a id="__codelineno-59-9" name="__codelineno-59-9"></a><span class="w">  </span><span class="c1">// 请求队列接口</span>
<a id="__codelineno-59-10" name="__codelineno-59-10"></a><span class="w">  </span><span class="k">input</span><span class="w">  </span><span class="n">mem_req_t</span><span class="w"> </span><span class="p">[</span><span class="n">MAX_TRANS</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">req_queue</span><span class="p">,</span>
<a id="__codelineno-59-11" name="__codelineno-59-11"></a><span class="w">  </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="n">MAX_TRANS</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">     </span><span class="n">req_valid</span><span class="p">,</span>
<a id="__codelineno-59-12" name="__codelineno-59-12"></a><span class="w">  </span><span class="k">output</span><span class="w"> </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="n">MAX_TRANS</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">     </span><span class="n">req_grant</span><span class="p">,</span>
<a id="__codelineno-59-13" name="__codelineno-59-13"></a>
<a id="__codelineno-59-14" name="__codelineno-59-14"></a><span class="w">  </span><span class="c1">// DRAM时序控制</span>
<a id="__codelineno-59-15" name="__codelineno-59-15"></a><span class="w">  </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w">                     </span><span class="n">bank_ready</span><span class="p">,</span>
<a id="__codelineno-59-16" name="__codelineno-59-16"></a><span class="w">  </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="mh">3</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">              </span><span class="n">bank_status</span><span class="p">,</span>
<a id="__codelineno-59-17" name="__codelineno-59-17"></a><span class="w">  </span><span class="k">output</span><span class="w"> </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="mh">3</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">              </span><span class="n">bank_select</span><span class="p">,</span>
<a id="__codelineno-59-18" name="__codelineno-59-18"></a>
<a id="__codelineno-59-19" name="__codelineno-59-19"></a><span class="w">  </span><span class="c1">// 优先级控制</span>
<a id="__codelineno-59-20" name="__codelineno-59-20"></a><span class="w">  </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">              </span><span class="n">req_priority</span><span class="w"> </span><span class="p">[</span><span class="n">MAX_TRANS</span><span class="p">]</span>
<a id="__codelineno-59-21" name="__codelineno-59-21"></a><span class="p">);</span>
<a id="__codelineno-59-22" name="__codelineno-59-22"></a>
<a id="__codelineno-59-23" name="__codelineno-59-23"></a><span class="c1">// 行缓冲命中优先调度</span>
<a id="__codelineno-59-24" name="__codelineno-59-24"></a><span class="k">always_comb</span><span class="w"> </span><span class="k">begin</span>
<a id="__codelineno-59-25" name="__codelineno-59-25"></a><span class="w">  </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">MAX_TRANS</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span>
<a id="__codelineno-59-26" name="__codelineno-59-26"></a><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">req_valid</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">is_row_hit</span><span class="p">(</span><span class="n">req_queue</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">addr</span><span class="p">))</span><span class="w"> </span><span class="k">begin</span>
<a id="__codelineno-59-27" name="__codelineno-59-27"></a><span class="w">      </span><span class="n">row_hit_mask</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="mb">'b1</span><span class="p">;</span>
<a id="__codelineno-59-28" name="__codelineno-59-28"></a><span class="w">    </span><span class="k">end</span>
<a id="__codelineno-59-29" name="__codelineno-59-29"></a><span class="w">  </span><span class="k">end</span>
<a id="__codelineno-59-30" name="__codelineno-59-30"></a><span class="k">end</span>
</code></pre></div></td></tr></table></div>
<ol start="2">
<li>写合并</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Verilog</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-60-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-60-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-60-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-60-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-60-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-60-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-60-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-60-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-60-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-60-10">10</a></span>
<span class="normal"><a href="#__codelineno-60-11">11</a></span>
<span class="normal"><a href="#__codelineno-60-12">12</a></span>
<span class="normal"><a href="#__codelineno-60-13">13</a></span>
<span class="normal"><a href="#__codelineno-60-14">14</a></span>
<span class="normal"><a href="#__codelineno-60-15">15</a></span>
<span class="normal"><a href="#__codelineno-60-16">16</a></span>
<span class="normal"><a href="#__codelineno-60-17">17</a></span>
<span class="normal"><a href="#__codelineno-60-18">18</a></span>
<span class="normal"><a href="#__codelineno-60-19">19</a></span>
<span class="normal"><a href="#__codelineno-60-20">20</a></span>
<span class="normal"><a href="#__codelineno-60-21">21</a></span>
<span class="normal"><a href="#__codelineno-60-22">22</a></span>
<span class="normal"><a href="#__codelineno-60-23">23</a></span>
<span class="normal"><a href="#__codelineno-60-24">24</a></span>
<span class="normal"><a href="#__codelineno-60-25">25</a></span>
<span class="normal"><a href="#__codelineno-60-26">26</a></span>
<span class="normal"><a href="#__codelineno-60-27">27</a></span>
<span class="normal"><a href="#__codelineno-60-28">28</a></span>
<span class="normal"><a href="#__codelineno-60-29">29</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-60-1" name="__codelineno-60-1"></a><span class="c1">// 写请求合并器</span>
<a id="__codelineno-60-2" name="__codelineno-60-2"></a><span class="k">module</span><span class="w"> </span><span class="n">write_combiner</span><span class="w"> </span><span class="p">#(</span>
<a id="__codelineno-60-3" name="__codelineno-60-3"></a><span class="w">  </span><span class="k">parameter</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">ENTRIES</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">8</span><span class="p">,</span>
<a id="__codelineno-60-4" name="__codelineno-60-4"></a><span class="w">  </span><span class="k">parameter</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">LINE_SIZE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">64</span>
<a id="__codelineno-60-5" name="__codelineno-60-5"></a><span class="p">)(</span>
<a id="__codelineno-60-6" name="__codelineno-60-6"></a><span class="w">  </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="n">clk</span><span class="p">,</span>
<a id="__codelineno-60-7" name="__codelineno-60-7"></a><span class="w">  </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="n">rst_n</span><span class="p">,</span>
<a id="__codelineno-60-8" name="__codelineno-60-8"></a>
<a id="__codelineno-60-9" name="__codelineno-60-9"></a><span class="w">  </span><span class="c1">// 写请求接口</span>
<a id="__codelineno-60-10" name="__codelineno-60-10"></a><span class="w">  </span><span class="k">input</span><span class="w">  </span><span class="n">write_req_t</span><span class="w">                </span><span class="n">wr_req</span><span class="p">,</span>
<a id="__codelineno-60-11" name="__codelineno-60-11"></a><span class="w">  </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w">                      </span><span class="n">wr_valid</span><span class="p">,</span>
<a id="__codelineno-60-12" name="__codelineno-60-12"></a><span class="w">  </span><span class="k">output</span><span class="w"> </span><span class="kt">logic</span><span class="w">                      </span><span class="n">wr_ready</span><span class="p">,</span>
<a id="__codelineno-60-13" name="__codelineno-60-13"></a>
<a id="__codelineno-60-14" name="__codelineno-60-14"></a><span class="w">  </span><span class="c1">// 合并写请求输出</span>
<a id="__codelineno-60-15" name="__codelineno-60-15"></a><span class="w">  </span><span class="k">output</span><span class="w"> </span><span class="n">write_req_t</span><span class="w">                </span><span class="n">combined_req</span><span class="p">,</span>
<a id="__codelineno-60-16" name="__codelineno-60-16"></a><span class="w">  </span><span class="k">output</span><span class="w"> </span><span class="kt">logic</span><span class="w">                      </span><span class="n">combined_valid</span><span class="p">,</span>
<a id="__codelineno-60-17" name="__codelineno-60-17"></a><span class="w">  </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w">                      </span><span class="n">combined_ready</span>
<a id="__codelineno-60-18" name="__codelineno-60-18"></a><span class="p">);</span>
<a id="__codelineno-60-19" name="__codelineno-60-19"></a>
<a id="__codelineno-60-20" name="__codelineno-60-20"></a><span class="c1">// 合并逻辑</span>
<a id="__codelineno-60-21" name="__codelineno-60-21"></a><span class="k">always_comb</span><span class="w"> </span><span class="k">begin</span>
<a id="__codelineno-60-22" name="__codelineno-60-22"></a><span class="w">  </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">ENTRIES</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span>
<a id="__codelineno-60-23" name="__codelineno-60-23"></a><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">entry_valid</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>
<a id="__codelineno-60-24" name="__codelineno-60-24"></a><span class="w">       </span><span class="p">(</span><span class="n">wr_req</span><span class="p">.</span><span class="n">addr</span><span class="p">[</span><span class="n">LINE_SIZE</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">6</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">entry_addr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">LINE_SIZE</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">6</span><span class="p">]))</span><span class="w"> </span><span class="k">begin</span>
<a id="__codelineno-60-25" name="__codelineno-60-25"></a><span class="w">      </span><span class="c1">// 合并同cache line的写请求</span>
<a id="__codelineno-60-26" name="__codelineno-60-26"></a><span class="w">      </span><span class="n">merge_mask</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="mb">'b1</span><span class="p">;</span>
<a id="__codelineno-60-27" name="__codelineno-60-27"></a><span class="w">    </span><span class="k">end</span>
<a id="__codelineno-60-28" name="__codelineno-60-28"></a><span class="w">  </span><span class="k">end</span>
<a id="__codelineno-60-29" name="__codelineno-60-29"></a><span class="k">end</span>
</code></pre></div></td></tr></table></div>
<ol start="3">
<li>读预取</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Verilog</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-61-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-61-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-61-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-61-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-61-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-61-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-61-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-61-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-61-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-61-10">10</a></span>
<span class="normal"><a href="#__codelineno-61-11">11</a></span>
<span class="normal"><a href="#__codelineno-61-12">12</a></span>
<span class="normal"><a href="#__codelineno-61-13">13</a></span>
<span class="normal"><a href="#__codelineno-61-14">14</a></span>
<span class="normal"><a href="#__codelineno-61-15">15</a></span>
<span class="normal"><a href="#__codelineno-61-16">16</a></span>
<span class="normal"><a href="#__codelineno-61-17">17</a></span>
<span class="normal"><a href="#__codelineno-61-18">18</a></span>
<span class="normal"><a href="#__codelineno-61-19">19</a></span>
<span class="normal"><a href="#__codelineno-61-20">20</a></span>
<span class="normal"><a href="#__codelineno-61-21">21</a></span>
<span class="normal"><a href="#__codelineno-61-22">22</a></span>
<span class="normal"><a href="#__codelineno-61-23">23</a></span>
<span class="normal"><a href="#__codelineno-61-24">24</a></span>
<span class="normal"><a href="#__codelineno-61-25">25</a></span>
<span class="normal"><a href="#__codelineno-61-26">26</a></span>
<span class="normal"><a href="#__codelineno-61-27">27</a></span>
<span class="normal"><a href="#__codelineno-61-28">28</a></span>
<span class="normal"><a href="#__codelineno-61-29">29</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-61-1" name="__codelineno-61-1"></a><span class="c1">// 读预取控制器</span>
<a id="__codelineno-61-2" name="__codelineno-61-2"></a><span class="k">module</span><span class="w"> </span><span class="n">read_prefetcher</span><span class="w"> </span><span class="p">#(</span>
<a id="__codelineno-61-3" name="__codelineno-61-3"></a><span class="w">  </span><span class="k">parameter</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">PF_DEPTH</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">4</span><span class="p">,</span>
<a id="__codelineno-61-4" name="__codelineno-61-4"></a><span class="w">  </span><span class="k">parameter</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">PF_STREAMS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">4</span>
<a id="__codelineno-61-5" name="__codelineno-61-5"></a><span class="p">)(</span>
<a id="__codelineno-61-6" name="__codelineno-61-6"></a><span class="w">  </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="n">clk</span><span class="p">,</span>
<a id="__codelineno-61-7" name="__codelineno-61-7"></a><span class="w">  </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="n">rst_n</span><span class="p">,</span>
<a id="__codelineno-61-8" name="__codelineno-61-8"></a>
<a id="__codelineno-61-9" name="__codelineno-61-9"></a><span class="w">  </span><span class="c1">// 读请求监控</span>
<a id="__codelineno-61-10" name="__codelineno-61-10"></a><span class="w">  </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="mh">63</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">rd_addr</span><span class="p">,</span>
<a id="__codelineno-61-11" name="__codelineno-61-11"></a><span class="w">  </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w">        </span><span class="n">rd_valid</span><span class="p">,</span>
<a id="__codelineno-61-12" name="__codelineno-61-12"></a>
<a id="__codelineno-61-13" name="__codelineno-61-13"></a><span class="w">  </span><span class="c1">// 预取请求</span>
<a id="__codelineno-61-14" name="__codelineno-61-14"></a><span class="w">  </span><span class="k">output</span><span class="w"> </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="mh">63</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">pf_addr</span><span class="p">,</span>
<a id="__codelineno-61-15" name="__codelineno-61-15"></a><span class="w">  </span><span class="k">output</span><span class="w"> </span><span class="kt">logic</span><span class="w">        </span><span class="n">pf_valid</span><span class="p">,</span>
<a id="__codelineno-61-16" name="__codelineno-61-16"></a><span class="w">  </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w">        </span><span class="n">pf_ready</span><span class="p">,</span>
<a id="__codelineno-61-17" name="__codelineno-61-17"></a>
<a id="__codelineno-61-18" name="__codelineno-61-18"></a><span class="w">  </span><span class="c1">// 预取反馈</span>
<a id="__codelineno-61-19" name="__codelineno-61-19"></a><span class="w">  </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w">        </span><span class="n">pf_hit</span><span class="p">,</span>
<a id="__codelineno-61-20" name="__codelineno-61-20"></a><span class="w">  </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w">        </span><span class="n">pf_miss</span>
<a id="__codelineno-61-21" name="__codelineno-61-21"></a><span class="p">);</span>
<a id="__codelineno-61-22" name="__codelineno-61-22"></a>
<a id="__codelineno-61-23" name="__codelineno-61-23"></a><span class="c1">// 自适应预取深度控制</span>
<a id="__codelineno-61-24" name="__codelineno-61-24"></a><span class="k">always_ff</span><span class="w"> </span><span class="p">@(</span><span class="k">posedge</span><span class="w"> </span><span class="n">clk</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span>
<a id="__codelineno-61-25" name="__codelineno-61-25"></a><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">pf_hit</span><span class="p">)</span>
<a id="__codelineno-61-26" name="__codelineno-61-26"></a><span class="w">    </span><span class="n">pf_degree</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="p">(</span><span class="n">pf_degree</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">PF_DEPTH</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">pf_degree</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mh">1</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">PF_DEPTH</span><span class="p">;</span>
<a id="__codelineno-61-27" name="__codelineno-61-27"></a><span class="w">  </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">pf_miss</span><span class="p">)</span>
<a id="__codelineno-61-28" name="__codelineno-61-28"></a><span class="w">    </span><span class="n">pf_degree</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="p">(</span><span class="n">pf_degree</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">pf_degree</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mh">1</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span>
<a id="__codelineno-61-29" name="__codelineno-61-29"></a><span class="k">end</span>
</code></pre></div></td></tr></table></div>
<h4 id="_39">推荐课程<a class="headerlink" href="#_39" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<ol>
<li>
<p>主课程
   - CMU 18-447: Memory Systems
   - Stanford CS316: Modern Memory Hierarchy
   - MIT 6.823: Memory System Architecture</p>
</li>
<li>
<p><span>DRAM<span class="heti-spacing"> </span></span>专题
   - "DRAM Technology and Architecture"
   - "Modern DRAM Memory Systems"
   - DDR4/5规范解读</p>
</li>
</ol>
<h4 id="_40">验证策略<a class="headerlink" href="#_40" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<ol>
<li>功能测试</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Systemverilog</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-62-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-62-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-62-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-62-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-62-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-62-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-62-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-62-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-62-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-62-10">10</a></span>
<span class="normal"><a href="#__codelineno-62-11">11</a></span>
<span class="normal"><a href="#__codelineno-62-12">12</a></span>
<span class="normal"><a href="#__codelineno-62-13">13</a></span>
<span class="normal"><a href="#__codelineno-62-14">14</a></span>
<span class="normal"><a href="#__codelineno-62-15">15</a></span>
<span class="normal"><a href="#__codelineno-62-16">16</a></span>
<span class="normal"><a href="#__codelineno-62-17">17</a></span>
<span class="normal"><a href="#__codelineno-62-18">18</a></span>
<span class="normal"><a href="#__codelineno-62-19">19</a></span>
<span class="normal"><a href="#__codelineno-62-20">20</a></span>
<span class="normal"><a href="#__codelineno-62-21">21</a></span>
<span class="normal"><a href="#__codelineno-62-22">22</a></span>
<span class="normal"><a href="#__codelineno-62-23">23</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-62-1" name="__codelineno-62-1"></a><span class="c1">// 接口协议测试</span>
<a id="__codelineno-62-2" name="__codelineno-62-2"></a><span class="k">task</span><span class="w"> </span><span class="n">test_axi_protocol</span><span class="p">();</span>
<a id="__codelineno-62-3" name="__codelineno-62-3"></a><span class="w">  </span><span class="c1">// 基本传输</span>
<a id="__codelineno-62-4" name="__codelineno-62-4"></a><span class="w">  </span><span class="n">test_single_transfer</span><span class="p">();</span>
<a id="__codelineno-62-5" name="__codelineno-62-5"></a>
<a id="__codelineno-62-6" name="__codelineno-62-6"></a><span class="w">  </span><span class="c1">// 突发传输</span>
<a id="__codelineno-62-7" name="__codelineno-62-7"></a><span class="w">  </span><span class="n">test_burst_transfer</span><span class="p">();</span>
<a id="__codelineno-62-8" name="__codelineno-62-8"></a>
<a id="__codelineno-62-9" name="__codelineno-62-9"></a><span class="w">  </span><span class="c1">// 乱序响应</span>
<a id="__codelineno-62-10" name="__codelineno-62-10"></a><span class="w">  </span><span class="n">test_out_of_order_resp</span><span class="p">();</span>
<a id="__codelineno-62-11" name="__codelineno-62-11"></a><span class="k">endtask</span>
<a id="__codelineno-62-12" name="__codelineno-62-12"></a>
<a id="__codelineno-62-13" name="__codelineno-62-13"></a><span class="c1">// 性能测试</span>
<a id="__codelineno-62-14" name="__codelineno-62-14"></a><span class="k">task</span><span class="w"> </span><span class="n">test_memory_perf</span><span class="p">();</span>
<a id="__codelineno-62-15" name="__codelineno-62-15"></a><span class="w">  </span><span class="c1">// 带宽测试</span>
<a id="__codelineno-62-16" name="__codelineno-62-16"></a><span class="w">  </span><span class="n">test_bandwidth</span><span class="p">();</span>
<a id="__codelineno-62-17" name="__codelineno-62-17"></a>
<a id="__codelineno-62-18" name="__codelineno-62-18"></a><span class="w">  </span><span class="c1">// 延迟测试</span>
<a id="__codelineno-62-19" name="__codelineno-62-19"></a><span class="w">  </span><span class="n">test_latency</span><span class="p">();</span>
<a id="__codelineno-62-20" name="__codelineno-62-20"></a>
<a id="__codelineno-62-21" name="__codelineno-62-21"></a><span class="w">  </span><span class="c1">// 并发测试</span>
<a id="__codelineno-62-22" name="__codelineno-62-22"></a><span class="w">  </span><span class="n">test_concurrent_access</span><span class="p">();</span>
<a id="__codelineno-62-23" name="__codelineno-62-23"></a><span class="k">endtask</span>
</code></pre></div></td></tr></table></div>
<ol start="2">
<li>压力测试</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Systemverilog</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-63-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-63-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-63-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-63-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-63-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-63-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-63-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-63-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-63-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-63-10">10</a></span>
<span class="normal"><a href="#__codelineno-63-11">11</a></span>
<span class="normal"><a href="#__codelineno-63-12">12</a></span>
<span class="normal"><a href="#__codelineno-63-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-63-1" name="__codelineno-63-1"></a><span class="c1">// 极限测试</span>
<a id="__codelineno-63-2" name="__codelineno-63-2"></a><span class="k">task</span><span class="w"> </span><span class="n">test_stress</span><span class="p">();</span>
<a id="__codelineno-63-3" name="__codelineno-63-3"></a><span class="w">  </span><span class="k">fork</span>
<a id="__codelineno-63-4" name="__codelineno-63-4"></a><span class="w">    </span><span class="c1">// 最大突发长度</span>
<a id="__codelineno-63-5" name="__codelineno-63-5"></a><span class="w">    </span><span class="n">test_max_burst</span><span class="p">();</span>
<a id="__codelineno-63-6" name="__codelineno-63-6"></a>
<a id="__codelineno-63-7" name="__codelineno-63-7"></a><span class="w">    </span><span class="c1">// 队列满载</span>
<a id="__codelineno-63-8" name="__codelineno-63-8"></a><span class="w">    </span><span class="n">test_queue_full</span><span class="p">();</span>
<a id="__codelineno-63-9" name="__codelineno-63-9"></a>
<a id="__codelineno-63-10" name="__codelineno-63-10"></a><span class="w">    </span><span class="c1">// bank冲突</span>
<a id="__codelineno-63-11" name="__codelineno-63-11"></a><span class="w">    </span><span class="n">test_bank_conflicts</span><span class="p">();</span>
<a id="__codelineno-63-12" name="__codelineno-63-12"></a><span class="w">  </span><span class="k">join</span>
<a id="__codelineno-63-13" name="__codelineno-63-13"></a><span class="k">endtask</span>
</code></pre></div></td></tr></table></div>
<h3 id="9-verification-platform"><span>9.<span class="heti-spacing"> </span></span>验证平台<span><span class="heti-spacing"> </span>(Verification Platform)</span><a class="headerlink" href="#9-verification-platform" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<h4 id="_41">整体架构<a class="headerlink" href="#_41" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<ol>
<li>环境配置</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Systemverilog</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-64-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-64-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-64-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-64-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-64-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-64-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-64-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-64-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-64-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-64-10">10</a></span>
<span class="normal"><a href="#__codelineno-64-11">11</a></span>
<span class="normal"><a href="#__codelineno-64-12">12</a></span>
<span class="normal"><a href="#__codelineno-64-13">13</a></span>
<span class="normal"><a href="#__codelineno-64-14">14</a></span>
<span class="normal"><a href="#__codelineno-64-15">15</a></span>
<span class="normal"><a href="#__codelineno-64-16">16</a></span>
<span class="normal"><a href="#__codelineno-64-17">17</a></span>
<span class="normal"><a href="#__codelineno-64-18">18</a></span>
<span class="normal"><a href="#__codelineno-64-19">19</a></span>
<span class="normal"><a href="#__codelineno-64-20">20</a></span>
<span class="normal"><a href="#__codelineno-64-21">21</a></span>
<span class="normal"><a href="#__codelineno-64-22">22</a></span>
<span class="normal"><a href="#__codelineno-64-23">23</a></span>
<span class="normal"><a href="#__codelineno-64-24">24</a></span>
<span class="normal"><a href="#__codelineno-64-25">25</a></span>
<span class="normal"><a href="#__codelineno-64-26">26</a></span>
<span class="normal"><a href="#__codelineno-64-27">27</a></span>
<span class="normal"><a href="#__codelineno-64-28">28</a></span>
<span class="normal"><a href="#__codelineno-64-29">29</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-64-1" name="__codelineno-64-1"></a><span class="c1">// 顶层配置</span>
<a id="__codelineno-64-2" name="__codelineno-64-2"></a><span class="kd">class</span><span class="w"> </span><span class="nc">processor_config</span><span class="p">;</span>
<a id="__codelineno-64-3" name="__codelineno-64-3"></a><span class="w">  </span><span class="c1">// 基本配置</span>
<a id="__codelineno-64-4" name="__codelineno-64-4"></a><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="n">fetch_width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span>
<a id="__codelineno-64-5" name="__codelineno-64-5"></a><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="n">dispatch_width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span>
<a id="__codelineno-64-6" name="__codelineno-64-6"></a><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="n">commit_width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span>
<a id="__codelineno-64-7" name="__codelineno-64-7"></a>
<a id="__codelineno-64-8" name="__codelineno-64-8"></a><span class="w">  </span><span class="c1">// 组件配置</span>
<a id="__codelineno-64-9" name="__codelineno-64-9"></a><span class="w">  </span><span class="n">rob_config_t</span><span class="w">    </span><span class="n">rob_cfg</span><span class="p">;</span>
<a id="__codelineno-64-10" name="__codelineno-64-10"></a><span class="w">  </span><span class="n">cache_config_t</span><span class="w">  </span><span class="n">cache_cfg</span><span class="p">;</span>
<a id="__codelineno-64-11" name="__codelineno-64-11"></a><span class="w">  </span><span class="n">lsq_config_t</span><span class="w">    </span><span class="n">lsq_cfg</span><span class="p">;</span>
<a id="__codelineno-64-12" name="__codelineno-64-12"></a>
<a id="__codelineno-64-13" name="__codelineno-64-13"></a><span class="w">  </span><span class="c1">// 仿真控制</span>
<a id="__codelineno-64-14" name="__codelineno-64-14"></a><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="n">max_cycles</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1000000</span><span class="p">;</span>
<a id="__codelineno-64-15" name="__codelineno-64-15"></a><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="n">warmup_cycles</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10000</span><span class="p">;</span>
<a id="__codelineno-64-16" name="__codelineno-64-16"></a><span class="w">  </span><span class="kt">string</span><span class="w">        </span><span class="n">test_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"sanity"</span><span class="p">;</span>
<a id="__codelineno-64-17" name="__codelineno-64-17"></a><span class="kd">endclass</span>
<a id="__codelineno-64-18" name="__codelineno-64-18"></a>
<a id="__codelineno-64-19" name="__codelineno-64-19"></a><span class="c1">// 验证环境</span>
<a id="__codelineno-64-20" name="__codelineno-64-20"></a><span class="kd">class</span><span class="w"> </span><span class="nc">processor_env</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="nc">uvm_env</span><span class="p">;</span>
<a id="__codelineno-64-21" name="__codelineno-64-21"></a><span class="w">  </span><span class="c1">// 组件实例</span>
<a id="__codelineno-64-22" name="__codelineno-64-22"></a><span class="w">  </span><span class="n">processor_agent</span><span class="w">    </span><span class="n">p_agent</span><span class="p">;</span>
<a id="__codelineno-64-23" name="__codelineno-64-23"></a><span class="w">  </span><span class="n">memory_agent</span><span class="w">      </span><span class="n">m_agent</span><span class="p">;</span>
<a id="__codelineno-64-24" name="__codelineno-64-24"></a><span class="w">  </span><span class="n">scoreboard</span><span class="w">        </span><span class="n">sb</span><span class="p">;</span>
<a id="__codelineno-64-25" name="__codelineno-64-25"></a><span class="w">  </span><span class="n">coverage</span><span class="w">          </span><span class="n">cov</span><span class="p">;</span>
<a id="__codelineno-64-26" name="__codelineno-64-26"></a>
<a id="__codelineno-64-27" name="__codelineno-64-27"></a><span class="w">  </span><span class="c1">// 虚拟序列</span>
<a id="__codelineno-64-28" name="__codelineno-64-28"></a><span class="w">  </span><span class="n">processor_sequencer</span><span class="w">  </span><span class="n">p_sequencer</span><span class="p">;</span>
<a id="__codelineno-64-29" name="__codelineno-64-29"></a><span class="kd">endclass</span>
</code></pre></div></td></tr></table></div>
<ol start="2">
<li>测试用例</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Systemverilog</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-65-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-65-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-65-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-65-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-65-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-65-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-65-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-65-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-65-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-65-10">10</a></span>
<span class="normal"><a href="#__codelineno-65-11">11</a></span>
<span class="normal"><a href="#__codelineno-65-12">12</a></span>
<span class="normal"><a href="#__codelineno-65-13">13</a></span>
<span class="normal"><a href="#__codelineno-65-14">14</a></span>
<span class="normal"><a href="#__codelineno-65-15">15</a></span>
<span class="normal"><a href="#__codelineno-65-16">16</a></span>
<span class="normal"><a href="#__codelineno-65-17">17</a></span>
<span class="normal"><a href="#__codelineno-65-18">18</a></span>
<span class="normal"><a href="#__codelineno-65-19">19</a></span>
<span class="normal"><a href="#__codelineno-65-20">20</a></span>
<span class="normal"><a href="#__codelineno-65-21">21</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-65-1" name="__codelineno-65-1"></a><span class="c1">// 基本功能测试</span>
<a id="__codelineno-65-2" name="__codelineno-65-2"></a><span class="kd">class</span><span class="w"> </span><span class="nc">basic_test</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="nc">processor_test_base</span><span class="p">;</span>
<a id="__codelineno-65-3" name="__codelineno-65-3"></a><span class="w">  </span><span class="no">`uvm_component_utils</span><span class="p">(</span><span class="n">basic_test</span><span class="p">)</span>
<a id="__codelineno-65-4" name="__codelineno-65-4"></a>
<a id="__codelineno-65-5" name="__codelineno-65-5"></a><span class="w">  </span><span class="k">virtual</span><span class="w"> </span><span class="k">task</span><span class="w"> </span><span class="n">run_phase</span><span class="p">(</span><span class="n">uvm_phase</span><span class="w"> </span><span class="n">phase</span><span class="p">);</span>
<a id="__codelineno-65-6" name="__codelineno-65-6"></a><span class="w">    </span><span class="c1">// 指令序列</span>
<a id="__codelineno-65-7" name="__codelineno-65-7"></a><span class="w">    </span><span class="n">inst_sequence</span><span class="w"> </span><span class="n">seq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">inst_sequence</span><span class="o">::</span><span class="n">type_id</span><span class="o">::</span><span class="n">create</span><span class="p">(</span><span class="s">"seq"</span><span class="p">);</span>
<a id="__codelineno-65-8" name="__codelineno-65-8"></a>
<a id="__codelineno-65-9" name="__codelineno-65-9"></a><span class="w">    </span><span class="n">phase</span><span class="p">.</span><span class="n">raise_objection</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<a id="__codelineno-65-10" name="__codelineno-65-10"></a><span class="w">    </span><span class="n">seq</span><span class="p">.</span><span class="n">start</span><span class="p">(</span><span class="n">p_sequencer</span><span class="p">);</span>
<a id="__codelineno-65-11" name="__codelineno-65-11"></a><span class="w">    </span><span class="n">phase</span><span class="p">.</span><span class="n">drop_objection</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<a id="__codelineno-65-12" name="__codelineno-65-12"></a><span class="w">  </span><span class="k">endtask</span>
<a id="__codelineno-65-13" name="__codelineno-65-13"></a><span class="kd">endclass</span>
<a id="__codelineno-65-14" name="__codelineno-65-14"></a>
<a id="__codelineno-65-15" name="__codelineno-65-15"></a><span class="c1">// 回归测试套件</span>
<a id="__codelineno-65-16" name="__codelineno-65-16"></a><span class="kd">class</span><span class="w"> </span><span class="nc">regression_suite</span><span class="p">;</span>
<a id="__codelineno-65-17" name="__codelineno-65-17"></a><span class="w">  </span><span class="n">basic_test</span><span class="w">        </span><span class="n">basic</span><span class="p">;</span>
<a id="__codelineno-65-18" name="__codelineno-65-18"></a><span class="w">  </span><span class="n">exception_test</span><span class="w">    </span><span class="n">exception</span><span class="p">;</span>
<a id="__codelineno-65-19" name="__codelineno-65-19"></a><span class="w">  </span><span class="n">stress_test</span><span class="w">      </span><span class="n">stress</span><span class="p">;</span>
<a id="__codelineno-65-20" name="__codelineno-65-20"></a><span class="w">  </span><span class="n">performance_test</span><span class="w">  </span><span class="n">perf</span><span class="p">;</span>
<a id="__codelineno-65-21" name="__codelineno-65-21"></a><span class="kd">endclass</span>
</code></pre></div></td></tr></table></div>
<h4 id="_42">仿真环境<a class="headerlink" href="#_42" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<ol>
<li>波形跟踪</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Verilog</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-66-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-66-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-66-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-66-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-66-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-66-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-66-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-66-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-66-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-66-10">10</a></span>
<span class="normal"><a href="#__codelineno-66-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-66-1" name="__codelineno-66-1"></a><span class="c1">// 波形转储</span>
<a id="__codelineno-66-2" name="__codelineno-66-2"></a><span class="k">module</span><span class="w"> </span><span class="n">waveform_dump</span><span class="p">;</span>
<a id="__codelineno-66-3" name="__codelineno-66-3"></a><span class="w">  </span><span class="k">initial</span><span class="w"> </span><span class="k">begin</span>
<a id="__codelineno-66-4" name="__codelineno-66-4"></a><span class="w">    </span><span class="n">$dumpfile</span><span class="p">(</span><span class="s">"processor.vcd"</span><span class="p">);</span>
<a id="__codelineno-66-5" name="__codelineno-66-5"></a><span class="w">    </span><span class="n">$dumpvars</span><span class="p">(</span><span class="mh">0</span><span class="p">,</span><span class="w"> </span><span class="n">processor_top</span><span class="p">);</span>
<a id="__codelineno-66-6" name="__codelineno-66-6"></a>
<a id="__codelineno-66-7" name="__codelineno-66-7"></a><span class="w">    </span><span class="c1">// 选择性转储</span>
<a id="__codelineno-66-8" name="__codelineno-66-8"></a><span class="w">    </span><span class="n">$dumpvars</span><span class="p">(</span><span class="mh">1</span><span class="p">,</span><span class="w"> </span><span class="n">processor_top</span><span class="p">.</span><span class="n">rob</span><span class="p">);</span>
<a id="__codelineno-66-9" name="__codelineno-66-9"></a><span class="w">    </span><span class="n">$dumpvars</span><span class="p">(</span><span class="mh">1</span><span class="p">,</span><span class="w"> </span><span class="n">processor_top</span><span class="p">.</span><span class="n">lsq</span><span class="p">);</span>
<a id="__codelineno-66-10" name="__codelineno-66-10"></a><span class="w">  </span><span class="k">end</span>
<a id="__codelineno-66-11" name="__codelineno-66-11"></a><span class="k">endmodule</span>
</code></pre></div></td></tr></table></div>
<ol start="2">
<li>性能监控</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Verilog</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-67-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-67-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-67-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-67-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-67-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-67-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-67-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-67-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-67-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-67-10">10</a></span>
<span class="normal"><a href="#__codelineno-67-11">11</a></span>
<span class="normal"><a href="#__codelineno-67-12">12</a></span>
<span class="normal"><a href="#__codelineno-67-13">13</a></span>
<span class="normal"><a href="#__codelineno-67-14">14</a></span>
<span class="normal"><a href="#__codelineno-67-15">15</a></span>
<span class="normal"><a href="#__codelineno-67-16">16</a></span>
<span class="normal"><a href="#__codelineno-67-17">17</a></span>
<span class="normal"><a href="#__codelineno-67-18">18</a></span>
<span class="normal"><a href="#__codelineno-67-19">19</a></span>
<span class="normal"><a href="#__codelineno-67-20">20</a></span>
<span class="normal"><a href="#__codelineno-67-21">21</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-67-1" name="__codelineno-67-1"></a><span class="c1">// 性能计数器</span>
<a id="__codelineno-67-2" name="__codelineno-67-2"></a><span class="k">module</span><span class="w"> </span><span class="n">performance_counter</span><span class="w"> </span><span class="p">#(</span>
<a id="__codelineno-67-3" name="__codelineno-67-3"></a><span class="w">  </span><span class="k">parameter</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">COUNTERS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">16</span>
<a id="__codelineno-67-4" name="__codelineno-67-4"></a><span class="p">)(</span>
<a id="__codelineno-67-5" name="__codelineno-67-5"></a><span class="w">  </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="n">clk</span><span class="p">,</span>
<a id="__codelineno-67-6" name="__codelineno-67-6"></a><span class="w">  </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="n">rst_n</span><span class="p">,</span>
<a id="__codelineno-67-7" name="__codelineno-67-7"></a>
<a id="__codelineno-67-8" name="__codelineno-67-8"></a><span class="w">  </span><span class="c1">// 事件计数</span>
<a id="__codelineno-67-9" name="__codelineno-67-9"></a><span class="w">  </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="n">COUNTERS</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">event_inc</span><span class="p">,</span>
<a id="__codelineno-67-10" name="__codelineno-67-10"></a>
<a id="__codelineno-67-11" name="__codelineno-67-11"></a><span class="w">  </span><span class="c1">// 计数器值</span>
<a id="__codelineno-67-12" name="__codelineno-67-12"></a><span class="w">  </span><span class="k">output</span><span class="w"> </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="mh">63</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">counter_value</span><span class="w"> </span><span class="p">[</span><span class="n">COUNTERS</span><span class="p">]</span>
<a id="__codelineno-67-13" name="__codelineno-67-13"></a><span class="p">);</span>
<a id="__codelineno-67-14" name="__codelineno-67-14"></a>
<a id="__codelineno-67-15" name="__codelineno-67-15"></a><span class="c1">// 周期计数器</span>
<a id="__codelineno-67-16" name="__codelineno-67-16"></a><span class="k">always_ff</span><span class="w"> </span><span class="p">@(</span><span class="k">posedge</span><span class="w"> </span><span class="n">clk</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span>
<a id="__codelineno-67-17" name="__codelineno-67-17"></a><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">rst_n</span><span class="p">)</span>
<a id="__codelineno-67-18" name="__codelineno-67-18"></a><span class="w">    </span><span class="n">cycle_count</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="m">'0</span><span class="p">;</span>
<a id="__codelineno-67-19" name="__codelineno-67-19"></a><span class="w">  </span><span class="k">else</span>
<a id="__codelineno-67-20" name="__codelineno-67-20"></a><span class="w">    </span><span class="n">cycle_count</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">cycle_count</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span>
<a id="__codelineno-67-21" name="__codelineno-67-21"></a><span class="k">end</span>
</code></pre></div></td></tr></table></div>
<h4 id="_43">分析工具<a class="headerlink" href="#_43" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<ol>
<li>性能分析</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Python</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-68-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-68-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-68-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-68-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-68-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-68-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-68-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-68-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-68-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-68-10">10</a></span>
<span class="normal"><a href="#__codelineno-68-11">11</a></span>
<span class="normal"><a href="#__codelineno-68-12">12</a></span>
<span class="normal"><a href="#__codelineno-68-13">13</a></span>
<span class="normal"><a href="#__codelineno-68-14">14</a></span>
<span class="normal"><a href="#__codelineno-68-15">15</a></span>
<span class="normal"><a href="#__codelineno-68-16">16</a></span>
<span class="normal"><a href="#__codelineno-68-17">17</a></span>
<span class="normal"><a href="#__codelineno-68-18">18</a></span>
<span class="normal"><a href="#__codelineno-68-19">19</a></span>
<span class="normal"><a href="#__codelineno-68-20">20</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-68-1" name="__codelineno-68-1"></a><span class="c1"># 性能统计脚本</span>
<a id="__codelineno-68-2" name="__codelineno-68-2"></a><span class="k">def</span> <span class="nf">analyze_performance</span><span class="p">():</span>
<a id="__codelineno-68-3" name="__codelineno-68-3"></a>    <span class="c1"># IPC计算</span>
<a id="__codelineno-68-4" name="__codelineno-68-4"></a>    <span class="n">total_inst</span> <span class="o">=</span> <span class="n">get_committed_inst</span><span class="p">()</span>
<a id="__codelineno-68-5" name="__codelineno-68-5"></a>    <span class="n">total_cycles</span> <span class="o">=</span> <span class="n">get_cycle_count</span><span class="p">()</span>
<a id="__codelineno-68-6" name="__codelineno-68-6"></a>    <span class="n">ipc</span> <span class="o">=</span> <span class="n">total_inst</span> <span class="o">/</span> <span class="n">total_cycles</span>
<a id="__codelineno-68-7" name="__codelineno-68-7"></a>
<a id="__codelineno-68-8" name="__codelineno-68-8"></a>    <span class="c1"># 缓存分析</span>
<a id="__codelineno-68-9" name="__codelineno-68-9"></a>    <span class="n">l1i_miss_rate</span> <span class="o">=</span> <span class="n">get_icache_misses</span><span class="p">()</span> <span class="o">/</span> <span class="n">get_icache_accesses</span><span class="p">()</span>
<a id="__codelineno-68-10" name="__codelineno-68-10"></a>    <span class="n">l1d_miss_rate</span> <span class="o">=</span> <span class="n">get_dcache_misses</span><span class="p">()</span> <span class="o">/</span> <span class="n">get_dcache_accesses</span><span class="p">()</span>
<a id="__codelineno-68-11" name="__codelineno-68-11"></a>
<a id="__codelineno-68-12" name="__codelineno-68-12"></a>    <span class="c1"># 分支预测</span>
<a id="__codelineno-68-13" name="__codelineno-68-13"></a>    <span class="n">bp_accuracy</span> <span class="o">=</span> <span class="n">get_correct_predictions</span><span class="p">()</span> <span class="o">/</span> <span class="n">get_total_branches</span><span class="p">()</span>
<a id="__codelineno-68-14" name="__codelineno-68-14"></a>
<a id="__codelineno-68-15" name="__codelineno-68-15"></a>    <span class="k">return</span> <span class="p">{</span>
<a id="__codelineno-68-16" name="__codelineno-68-16"></a>        <span class="s1">'ipc'</span><span class="p">:</span> <span class="n">ipc</span><span class="p">,</span>
<a id="__codelineno-68-17" name="__codelineno-68-17"></a>        <span class="s1">'l1i_miss_rate'</span><span class="p">:</span> <span class="n">l1i_miss_rate</span><span class="p">,</span>
<a id="__codelineno-68-18" name="__codelineno-68-18"></a>        <span class="s1">'l1d_miss_rate'</span><span class="p">:</span> <span class="n">l1d_miss_rate</span><span class="p">,</span>
<a id="__codelineno-68-19" name="__codelineno-68-19"></a>        <span class="s1">'bp_accuracy'</span><span class="p">:</span> <span class="n">bp_accuracy</span>
<a id="__codelineno-68-20" name="__codelineno-68-20"></a>    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ol start="2">
<li>调试工具</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Python</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-69-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-69-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-69-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-69-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-69-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-69-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-69-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-69-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-69-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-69-10">10</a></span>
<span class="normal"><a href="#__codelineno-69-11">11</a></span>
<span class="normal"><a href="#__codelineno-69-12">12</a></span>
<span class="normal"><a href="#__codelineno-69-13">13</a></span>
<span class="normal"><a href="#__codelineno-69-14">14</a></span>
<span class="normal"><a href="#__codelineno-69-15">15</a></span>
<span class="normal"><a href="#__codelineno-69-16">16</a></span>
<span class="normal"><a href="#__codelineno-69-17">17</a></span>
<span class="normal"><a href="#__codelineno-69-18">18</a></span>
<span class="normal"><a href="#__codelineno-69-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-69-1" name="__codelineno-69-1"></a><span class="c1"># 指令跟踪</span>
<a id="__codelineno-69-2" name="__codelineno-69-2"></a><span class="k">def</span> <span class="nf">instruction_trace</span><span class="p">():</span>
<a id="__codelineno-69-3" name="__codelineno-69-3"></a>    <span class="c1"># 记录每条指令</span>
<a id="__codelineno-69-4" name="__codelineno-69-4"></a>    <span class="k">class</span> <span class="nc">InstructionRecord</span><span class="p">:</span>
<a id="__codelineno-69-5" name="__codelineno-69-5"></a>        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-69-6" name="__codelineno-69-6"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pc</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-69-7" name="__codelineno-69-7"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">inst</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-69-8" name="__codelineno-69-8"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">rob_id</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-69-9" name="__codelineno-69-9"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">dispatch_cycle</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-69-10" name="__codelineno-69-10"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">complete_cycle</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-69-11" name="__codelineno-69-11"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">commit_cycle</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-69-12" name="__codelineno-69-12"></a>
<a id="__codelineno-69-13" name="__codelineno-69-13"></a>    <span class="c1"># 分析关键路径</span>
<a id="__codelineno-69-14" name="__codelineno-69-14"></a>    <span class="k">def</span> <span class="nf">analyze_critical_path</span><span class="p">():</span>
<a id="__codelineno-69-15" name="__codelineno-69-15"></a>        <span class="n">inst_records</span> <span class="o">=</span> <span class="n">get_instruction_records</span><span class="p">()</span>
<a id="__codelineno-69-16" name="__codelineno-69-16"></a>        <span class="k">for</span> <span class="n">inst</span> <span class="ow">in</span> <span class="n">inst_records</span><span class="p">:</span>
<a id="__codelineno-69-17" name="__codelineno-69-17"></a>            <span class="n">disp_to_comp</span> <span class="o">=</span> <span class="n">inst</span><span class="o">.</span><span class="n">complete_cycle</span> <span class="o">-</span> <span class="n">inst</span><span class="o">.</span><span class="n">dispatch_cycle</span>
<a id="__codelineno-69-18" name="__codelineno-69-18"></a>            <span class="n">comp_to_commit</span> <span class="o">=</span> <span class="n">inst</span><span class="o">.</span><span class="n">commit_cycle</span> <span class="o">-</span> <span class="n">inst</span><span class="o">.</span><span class="n">complete_cycle</span>
<a id="__codelineno-69-19" name="__codelineno-69-19"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Inst </span><span class="si">{</span><span class="n">inst</span><span class="o">.</span><span class="n">pc</span><span class="si">:</span><span class="s2">x</span><span class="si">}</span><span class="s2">: dispatch-&gt;complete=</span><span class="si">{</span><span class="n">disp_to_comp</span><span class="si">}</span><span class="s2">, complete-&gt;commit=</span><span class="si">{</span><span class="n">comp_to_commit</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<h4 id="_44">协同开发工具<a class="headerlink" href="#_44" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<ol>
<li>版本控制</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-70-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-70-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-70-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-70-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-70-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-70-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-70-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-70-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-70-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-70-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-70-1" name="__codelineno-70-1"></a><span class="c1"># Git工作流</span>
<a id="__codelineno-70-2" name="__codelineno-70-2"></a>git<span class="w"> </span>flow<span class="w"> </span>init
<a id="__codelineno-70-3" name="__codelineno-70-3"></a>
<a id="__codelineno-70-4" name="__codelineno-70-4"></a><span class="c1"># 特性开发</span>
<a id="__codelineno-70-5" name="__codelineno-70-5"></a>git<span class="w"> </span>flow<span class="w"> </span>feature<span class="w"> </span>start<span class="w"> </span>new_feature
<a id="__codelineno-70-6" name="__codelineno-70-6"></a>git<span class="w"> </span>flow<span class="w"> </span>feature<span class="w"> </span>finish<span class="w"> </span>new_feature
<a id="__codelineno-70-7" name="__codelineno-70-7"></a>
<a id="__codelineno-70-8" name="__codelineno-70-8"></a><span class="c1"># 版本发布</span>
<a id="__codelineno-70-9" name="__codelineno-70-9"></a>git<span class="w"> </span>flow<span class="w"> </span>release<span class="w"> </span>start<span class="w"> </span>v1.0
<a id="__codelineno-70-10" name="__codelineno-70-10"></a>git<span class="w"> </span>flow<span class="w"> </span>release<span class="w"> </span>finish<span class="w"> </span>v1.0
</code></pre></div></td></tr></table></div>
<ol start="2">
<li>持续集成</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">YAML</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-71-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-71-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-71-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-71-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-71-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-71-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-71-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-71-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-71-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-71-10">10</a></span>
<span class="normal"><a href="#__codelineno-71-11">11</a></span>
<span class="normal"><a href="#__codelineno-71-12">12</a></span>
<span class="normal"><a href="#__codelineno-71-13">13</a></span>
<span class="normal"><a href="#__codelineno-71-14">14</a></span>
<span class="normal"><a href="#__codelineno-71-15">15</a></span>
<span class="normal"><a href="#__codelineno-71-16">16</a></span>
<span class="normal"><a href="#__codelineno-71-17">17</a></span>
<span class="normal"><a href="#__codelineno-71-18">18</a></span>
<span class="normal"><a href="#__codelineno-71-19">19</a></span>
<span class="normal"><a href="#__codelineno-71-20">20</a></span>
<span class="normal"><a href="#__codelineno-71-21">21</a></span>
<span class="normal"><a href="#__codelineno-71-22">22</a></span>
<span class="normal"><a href="#__codelineno-71-23">23</a></span>
<span class="normal"><a href="#__codelineno-71-24">24</a></span>
<span class="normal"><a href="#__codelineno-71-25">25</a></span>
<span class="normal"><a href="#__codelineno-71-26">26</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-71-1" name="__codelineno-71-1"></a><span class="c1"># Jenkins Pipeline</span>
<a id="__codelineno-71-2" name="__codelineno-71-2"></a><span class="l l-Scalar l-Scalar-Plain">pipeline {</span>
<a id="__codelineno-71-3" name="__codelineno-71-3"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">agent any</span>
<a id="__codelineno-71-4" name="__codelineno-71-4"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">stages {</span>
<a id="__codelineno-71-5" name="__codelineno-71-5"></a><span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">stage('Build') {</span>
<a id="__codelineno-71-6" name="__codelineno-71-6"></a><span class="w">            </span><span class="l l-Scalar l-Scalar-Plain">steps {</span>
<a id="__codelineno-71-7" name="__codelineno-71-7"></a><span class="w">                </span><span class="l l-Scalar l-Scalar-Plain">sh 'make build'</span>
<a id="__codelineno-71-8" name="__codelineno-71-8"></a><span class="w">            </span><span class="l l-Scalar l-Scalar-Plain">}</span>
<a id="__codelineno-71-9" name="__codelineno-71-9"></a><span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">}</span>
<a id="__codelineno-71-10" name="__codelineno-71-10"></a><span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">stage('Unit Test') {</span>
<a id="__codelineno-71-11" name="__codelineno-71-11"></a><span class="w">            </span><span class="l l-Scalar l-Scalar-Plain">steps {</span>
<a id="__codelineno-71-12" name="__codelineno-71-12"></a><span class="w">                </span><span class="l l-Scalar l-Scalar-Plain">sh './run_unit_tests.sh'</span>
<a id="__codelineno-71-13" name="__codelineno-71-13"></a><span class="w">            </span><span class="l l-Scalar l-Scalar-Plain">}</span>
<a id="__codelineno-71-14" name="__codelineno-71-14"></a><span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">}</span>
<a id="__codelineno-71-15" name="__codelineno-71-15"></a><span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">stage('Regression') {</span>
<a id="__codelineno-71-16" name="__codelineno-71-16"></a><span class="w">            </span><span class="l l-Scalar l-Scalar-Plain">steps {</span>
<a id="__codelineno-71-17" name="__codelineno-71-17"></a><span class="w">                </span><span class="l l-Scalar l-Scalar-Plain">sh './run_regression.sh'</span>
<a id="__codelineno-71-18" name="__codelineno-71-18"></a><span class="w">            </span><span class="l l-Scalar l-Scalar-Plain">}</span>
<a id="__codelineno-71-19" name="__codelineno-71-19"></a><span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">}</span>
<a id="__codelineno-71-20" name="__codelineno-71-20"></a><span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">stage('Performance') {</span>
<a id="__codelineno-71-21" name="__codelineno-71-21"></a><span class="w">            </span><span class="l l-Scalar l-Scalar-Plain">steps {</span>
<a id="__codelineno-71-22" name="__codelineno-71-22"></a><span class="w">                </span><span class="l l-Scalar l-Scalar-Plain">sh './run_perf_tests.sh'</span>
<a id="__codelineno-71-23" name="__codelineno-71-23"></a><span class="w">            </span><span class="l l-Scalar l-Scalar-Plain">}</span>
<a id="__codelineno-71-24" name="__codelineno-71-24"></a><span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">}</span>
<a id="__codelineno-71-25" name="__codelineno-71-25"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">}</span>
<a id="__codelineno-71-26" name="__codelineno-71-26"></a><span class="l l-Scalar l-Scalar-Plain">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="10-linux"><span>10. Linux<span class="heti-spacing"> </span></span>移植<a class="headerlink" href="#10-linux" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<h4 id="_45">启动流程<a class="headerlink" href="#_45" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<ol>
<li>Boot ROM</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Verilog</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-72-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-72-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-72-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-72-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-72-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-72-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-72-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-72-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-72-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-72-10">10</a></span>
<span class="normal"><a href="#__codelineno-72-11">11</a></span>
<span class="normal"><a href="#__codelineno-72-12">12</a></span>
<span class="normal"><a href="#__codelineno-72-13">13</a></span>
<span class="normal"><a href="#__codelineno-72-14">14</a></span>
<span class="normal"><a href="#__codelineno-72-15">15</a></span>
<span class="normal"><a href="#__codelineno-72-16">16</a></span>
<span class="normal"><a href="#__codelineno-72-17">17</a></span>
<span class="normal"><a href="#__codelineno-72-18">18</a></span>
<span class="normal"><a href="#__codelineno-72-19">19</a></span>
<span class="normal"><a href="#__codelineno-72-20">20</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-72-1" name="__codelineno-72-1"></a><span class="c1">// Boot ROM实现</span>
<a id="__codelineno-72-2" name="__codelineno-72-2"></a><span class="k">module</span><span class="w"> </span><span class="n">boot_rom</span><span class="w"> </span><span class="p">#(</span>
<a id="__codelineno-72-3" name="__codelineno-72-3"></a><span class="w">  </span><span class="k">parameter</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">ROM_SIZE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">4096</span>
<a id="__codelineno-72-4" name="__codelineno-72-4"></a><span class="p">)(</span>
<a id="__codelineno-72-5" name="__codelineno-72-5"></a><span class="w">  </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w">        </span><span class="n">clk</span><span class="p">,</span>
<a id="__codelineno-72-6" name="__codelineno-72-6"></a><span class="w">  </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="mh">11</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">addr</span><span class="p">,</span>
<a id="__codelineno-72-7" name="__codelineno-72-7"></a><span class="w">  </span><span class="k">output</span><span class="w"> </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="mh">31</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">data</span>
<a id="__codelineno-72-8" name="__codelineno-72-8"></a><span class="p">);</span>
<a id="__codelineno-72-9" name="__codelineno-72-9"></a>
<a id="__codelineno-72-10" name="__codelineno-72-10"></a><span class="c1">// ROM内容</span>
<a id="__codelineno-72-11" name="__codelineno-72-11"></a><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="mh">31</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">rom</span><span class="w"> </span><span class="p">[</span><span class="n">ROM_SIZE</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">];</span>
<a id="__codelineno-72-12" name="__codelineno-72-12"></a>
<a id="__codelineno-72-13" name="__codelineno-72-13"></a><span class="k">initial</span><span class="w"> </span><span class="k">begin</span>
<a id="__codelineno-72-14" name="__codelineno-72-14"></a><span class="w">  </span><span class="nb">$readmemh</span><span class="p">(</span><span class="s">"boot.hex"</span><span class="p">,</span><span class="w"> </span><span class="n">rom</span><span class="p">);</span>
<a id="__codelineno-72-15" name="__codelineno-72-15"></a><span class="k">end</span>
<a id="__codelineno-72-16" name="__codelineno-72-16"></a>
<a id="__codelineno-72-17" name="__codelineno-72-17"></a><span class="c1">// 读取逻辑</span>
<a id="__codelineno-72-18" name="__codelineno-72-18"></a><span class="k">always_ff</span><span class="w"> </span><span class="p">@(</span><span class="k">posedge</span><span class="w"> </span><span class="n">clk</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span>
<a id="__codelineno-72-19" name="__codelineno-72-19"></a><span class="w">  </span><span class="n">data</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">rom</span><span class="p">[</span><span class="n">addr</span><span class="p">];</span>
<a id="__codelineno-72-20" name="__codelineno-72-20"></a><span class="k">end</span>
</code></pre></div></td></tr></table></div>
<ol start="2">
<li><span>OpenSBI<span class="heti-spacing"> </span></span>移植</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">C</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-73-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-73-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-73-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-73-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-73-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-73-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-73-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-73-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-73-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-73-10">10</a></span>
<span class="normal"><a href="#__codelineno-73-11">11</a></span>
<span class="normal"><a href="#__codelineno-73-12">12</a></span>
<span class="normal"><a href="#__codelineno-73-13">13</a></span>
<span class="normal"><a href="#__codelineno-73-14">14</a></span>
<span class="normal"><a href="#__codelineno-73-15">15</a></span>
<span class="normal"><a href="#__codelineno-73-16">16</a></span>
<span class="normal"><a href="#__codelineno-73-17">17</a></span>
<span class="normal"><a href="#__codelineno-73-18">18</a></span>
<span class="normal"><a href="#__codelineno-73-19">19</a></span>
<span class="normal"><a href="#__codelineno-73-20">20</a></span>
<span class="normal"><a href="#__codelineno-73-21">21</a></span>
<span class="normal"><a href="#__codelineno-73-22">22</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-73-1" name="__codelineno-73-1"></a><span class="c1">// 平台定义</span>
<a id="__codelineno-73-2" name="__codelineno-73-2"></a><span class="k">const</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">platform_override</span><span class="w"> </span><span class="n">platform_override</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-73-3" name="__codelineno-73-3"></a><span class="w">    </span><span class="p">.</span><span class="n">match_table</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">platform_match_table</span><span class="p">,</span>
<a id="__codelineno-73-4" name="__codelineno-73-4"></a><span class="w">    </span><span class="p">.</span><span class="n">cold_boot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">platform_cold_boot</span><span class="p">,</span>
<a id="__codelineno-73-5" name="__codelineno-73-5"></a><span class="w">    </span><span class="p">.</span><span class="n">warm_reboot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">platform_warm_reboot</span><span class="p">,</span>
<a id="__codelineno-73-6" name="__codelineno-73-6"></a><span class="w">    </span><span class="p">.</span><span class="n">system_reset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">platform_system_reset</span>
<a id="__codelineno-73-7" name="__codelineno-73-7"></a><span class="p">};</span>
<a id="__codelineno-73-8" name="__codelineno-73-8"></a>
<a id="__codelineno-73-9" name="__codelineno-73-9"></a><span class="c1">// 初始化函数</span>
<a id="__codelineno-73-10" name="__codelineno-73-10"></a><span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">platform_cold_boot</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<a id="__codelineno-73-11" name="__codelineno-73-11"></a><span class="p">{</span>
<a id="__codelineno-73-12" name="__codelineno-73-12"></a><span class="w">    </span><span class="c1">// 初始化中断控制器</span>
<a id="__codelineno-73-13" name="__codelineno-73-13"></a><span class="w">    </span><span class="n">plic_init</span><span class="p">();</span>
<a id="__codelineno-73-14" name="__codelineno-73-14"></a>
<a id="__codelineno-73-15" name="__codelineno-73-15"></a><span class="w">    </span><span class="c1">// 配置串口</span>
<a id="__codelineno-73-16" name="__codelineno-73-16"></a><span class="w">    </span><span class="n">uart_init</span><span class="p">();</span>
<a id="__codelineno-73-17" name="__codelineno-73-17"></a>
<a id="__codelineno-73-18" name="__codelineno-73-18"></a><span class="w">    </span><span class="c1">// 设置时钟</span>
<a id="__codelineno-73-19" name="__codelineno-73-19"></a><span class="w">    </span><span class="n">clint_init</span><span class="p">();</span>
<a id="__codelineno-73-20" name="__codelineno-73-20"></a>
<a id="__codelineno-73-21" name="__codelineno-73-21"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-73-22" name="__codelineno-73-22"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h4 id="_46">内核配置<a class="headerlink" href="#_46" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<ol>
<li>配置文件</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-74-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-74-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-74-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-74-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-74-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-74-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-74-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-74-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-74-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-74-10">10</a></span>
<span class="normal"><a href="#__codelineno-74-11">11</a></span>
<span class="normal"><a href="#__codelineno-74-12">12</a></span>
<span class="normal"><a href="#__codelineno-74-13">13</a></span>
<span class="normal"><a href="#__codelineno-74-14">14</a></span>
<span class="normal"><a href="#__codelineno-74-15">15</a></span>
<span class="normal"><a href="#__codelineno-74-16">16</a></span>
<span class="normal"><a href="#__codelineno-74-17">17</a></span>
<span class="normal"><a href="#__codelineno-74-18">18</a></span>
<span class="normal"><a href="#__codelineno-74-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-74-1" name="__codelineno-74-1"></a><span class="c1"># defconfig示例</span>
<a id="__codelineno-74-2" name="__codelineno-74-2"></a><span class="nv">CONFIG_RISCV</span><span class="o">=</span>y
<a id="__codelineno-74-3" name="__codelineno-74-3"></a><span class="nv">CONFIG_64BIT</span><span class="o">=</span>y
<a id="__codelineno-74-4" name="__codelineno-74-4"></a><span class="nv">CONFIG_SMP</span><span class="o">=</span>y
<a id="__codelineno-74-5" name="__codelineno-74-5"></a><span class="nv">CONFIG_NUMA</span><span class="o">=</span>n
<a id="__codelineno-74-6" name="__codelineno-74-6"></a>
<a id="__codelineno-74-7" name="__codelineno-74-7"></a><span class="c1"># 内存配置</span>
<a id="__codelineno-74-8" name="__codelineno-74-8"></a><span class="nv">CONFIG_PHYS_RAM_BASE_ADDRESS</span><span class="o">=</span>0x80000000
<a id="__codelineno-74-9" name="__codelineno-74-9"></a><span class="nv">CONFIG_RAM_SIZE</span><span class="o">=</span>0x40000000
<a id="__codelineno-74-10" name="__codelineno-74-10"></a>
<a id="__codelineno-74-11" name="__codelineno-74-11"></a><span class="c1"># 处理器特性</span>
<a id="__codelineno-74-12" name="__codelineno-74-12"></a><span class="nv">CONFIG_RISCV_ISA_C</span><span class="o">=</span>y
<a id="__codelineno-74-13" name="__codelineno-74-13"></a><span class="nv">CONFIG_RISCV_ISA_A</span><span class="o">=</span>y
<a id="__codelineno-74-14" name="__codelineno-74-14"></a><span class="nv">CONFIG_FPU</span><span class="o">=</span>y
<a id="__codelineno-74-15" name="__codelineno-74-15"></a>
<a id="__codelineno-74-16" name="__codelineno-74-16"></a><span class="c1"># 基础外设</span>
<a id="__codelineno-74-17" name="__codelineno-74-17"></a><span class="nv">CONFIG_SERIAL_8250</span><span class="o">=</span>y
<a id="__codelineno-74-18" name="__codelineno-74-18"></a><span class="nv">CONFIG_SERIAL_8250_CONSOLE</span><span class="o">=</span>y
<a id="__codelineno-74-19" name="__codelineno-74-19"></a><span class="nv">CONFIG_SERIAL_OF_PLATFORM</span><span class="o">=</span>y
</code></pre></div></td></tr></table></div>
<ol start="2">
<li>设备树</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Devicetree</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-75-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-75-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-75-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-75-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-75-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-75-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-75-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-75-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-75-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-75-10">10</a></span>
<span class="normal"><a href="#__codelineno-75-11">11</a></span>
<span class="normal"><a href="#__codelineno-75-12">12</a></span>
<span class="normal"><a href="#__codelineno-75-13">13</a></span>
<span class="normal"><a href="#__codelineno-75-14">14</a></span>
<span class="normal"><a href="#__codelineno-75-15">15</a></span>
<span class="normal"><a href="#__codelineno-75-16">16</a></span>
<span class="normal"><a href="#__codelineno-75-17">17</a></span>
<span class="normal"><a href="#__codelineno-75-18">18</a></span>
<span class="normal"><a href="#__codelineno-75-19">19</a></span>
<span class="normal"><a href="#__codelineno-75-20">20</a></span>
<span class="normal"><a href="#__codelineno-75-21">21</a></span>
<span class="normal"><a href="#__codelineno-75-22">22</a></span>
<span class="normal"><a href="#__codelineno-75-23">23</a></span>
<span class="normal"><a href="#__codelineno-75-24">24</a></span>
<span class="normal"><a href="#__codelineno-75-25">25</a></span>
<span class="normal"><a href="#__codelineno-75-26">26</a></span>
<span class="normal"><a href="#__codelineno-75-27">27</a></span>
<span class="normal"><a href="#__codelineno-75-28">28</a></span>
<span class="normal"><a href="#__codelineno-75-29">29</a></span>
<span class="normal"><a href="#__codelineno-75-30">30</a></span>
<span class="normal"><a href="#__codelineno-75-31">31</a></span>
<span class="normal"><a href="#__codelineno-75-32">32</a></span>
<span class="normal"><a href="#__codelineno-75-33">33</a></span>
<span class="normal"><a href="#__codelineno-75-34">34</a></span>
<span class="normal"><a href="#__codelineno-75-35">35</a></span>
<span class="normal"><a href="#__codelineno-75-36">36</a></span>
<span class="normal"><a href="#__codelineno-75-37">37</a></span>
<span class="normal"><a href="#__codelineno-75-38">38</a></span>
<span class="normal"><a href="#__codelineno-75-39">39</a></span>
<span class="normal"><a href="#__codelineno-75-40">40</a></span>
<span class="normal"><a href="#__codelineno-75-41">41</a></span>
<span class="normal"><a href="#__codelineno-75-42">42</a></span>
<span class="normal"><a href="#__codelineno-75-43">43</a></span>
<span class="normal"><a href="#__codelineno-75-44">44</a></span>
<span class="normal"><a href="#__codelineno-75-45">45</a></span>
<span class="normal"><a href="#__codelineno-75-46">46</a></span>
<span class="normal"><a href="#__codelineno-75-47">47</a></span>
<span class="normal"><a href="#__codelineno-75-48">48</a></span>
<span class="normal"><a href="#__codelineno-75-49">49</a></span>
<span class="normal"><a href="#__codelineno-75-50">50</a></span>
<span class="normal"><a href="#__codelineno-75-51">51</a></span>
<span class="normal"><a href="#__codelineno-75-52">52</a></span>
<span class="normal"><a href="#__codelineno-75-53">53</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-75-1" name="__codelineno-75-1"></a><span class="c1">// 处理器设备树</span>
<a id="__codelineno-75-2" name="__codelineno-75-2"></a><span class="cp">/dts-v1/</span><span class="p">;</span>
<a id="__codelineno-75-3" name="__codelineno-75-3"></a>
<a id="__codelineno-75-4" name="__codelineno-75-4"></a><span class="nf">/</span><span class="cm"> </span><span class="p">{</span>
<a id="__codelineno-75-5" name="__codelineno-75-5"></a><span class="w">    </span><span class="kr">#address-cells</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="p">;</span>
<a id="__codelineno-75-6" name="__codelineno-75-6"></a><span class="w">    </span><span class="kr">#size-cells</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="p">;</span>
<a id="__codelineno-75-7" name="__codelineno-75-7"></a>
<a id="__codelineno-75-8" name="__codelineno-75-8"></a><span class="w">    </span><span class="nf">cpus</span><span class="cm"> </span><span class="p">{</span>
<a id="__codelineno-75-9" name="__codelineno-75-9"></a><span class="w">        </span><span class="kr">#address-cells</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">;</span>
<a id="__codelineno-75-10" name="__codelineno-75-10"></a><span class="w">        </span><span class="kr">#size-cells</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">;</span>
<a id="__codelineno-75-11" name="__codelineno-75-11"></a><span class="w">        </span><span class="n">timebase-frequency</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="mi">10000000</span><span class="o">&gt;</span><span class="p">;</span>
<a id="__codelineno-75-12" name="__codelineno-75-12"></a>
<a id="__codelineno-75-13" name="__codelineno-75-13"></a><span class="w">        </span><span class="nf">cpu</span><span class="o">@</span><span class="mi">0</span><span class="cm"> </span><span class="p">{</span>
<a id="__codelineno-75-14" name="__codelineno-75-14"></a><span class="w">            </span><span class="kr">device_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"cpu"</span><span class="p">;</span>
<a id="__codelineno-75-15" name="__codelineno-75-15"></a><span class="w">            </span><span class="kr">reg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">;</span>
<a id="__codelineno-75-16" name="__codelineno-75-16"></a><span class="w">            </span><span class="kr">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"okay"</span><span class="p">;</span>
<a id="__codelineno-75-17" name="__codelineno-75-17"></a><span class="w">            </span><span class="kr">compatible</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"riscv"</span><span class="p">;</span>
<a id="__codelineno-75-18" name="__codelineno-75-18"></a><span class="w">            </span><span class="n">riscv</span><span class="p">,</span><span class="n">isa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"rv64imafdc"</span><span class="p">;</span>
<a id="__codelineno-75-19" name="__codelineno-75-19"></a><span class="w">            </span><span class="n">mmu-type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"riscv,sv39"</span><span class="p">;</span>
<a id="__codelineno-75-20" name="__codelineno-75-20"></a>
<a id="__codelineno-75-21" name="__codelineno-75-21"></a><span class="w">            </span><span class="nf">interrupt-controller</span><span class="cm"> </span><span class="p">{</span>
<a id="__codelineno-75-22" name="__codelineno-75-22"></a><span class="w">                </span><span class="o">#</span><span class="n">interrupt-cells</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">;</span>
<a id="__codelineno-75-23" name="__codelineno-75-23"></a><span class="w">                </span><span class="n">interrupt-controller</span><span class="p">;</span>
<a id="__codelineno-75-24" name="__codelineno-75-24"></a><span class="w">                </span><span class="kr">compatible</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"riscv,cpu-intc"</span><span class="p">;</span>
<a id="__codelineno-75-25" name="__codelineno-75-25"></a><span class="w">            </span><span class="p">};</span>
<a id="__codelineno-75-26" name="__codelineno-75-26"></a><span class="w">        </span><span class="p">};</span>
<a id="__codelineno-75-27" name="__codelineno-75-27"></a><span class="w">    </span><span class="p">};</span>
<a id="__codelineno-75-28" name="__codelineno-75-28"></a>
<a id="__codelineno-75-29" name="__codelineno-75-29"></a><span class="w">    </span><span class="nf">memory</span><span class="o">@</span><span class="mi">80000000</span><span class="cm"> </span><span class="p">{</span>
<a id="__codelineno-75-30" name="__codelineno-75-30"></a><span class="w">        </span><span class="kr">device_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"memory"</span><span class="p">;</span>
<a id="__codelineno-75-31" name="__codelineno-75-31"></a><span class="w">        </span><span class="kr">reg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="mh">0x0</span><span class="w"> </span><span class="mh">0x80000000</span><span class="w"> </span><span class="mh">0x0</span><span class="w"> </span><span class="mh">0x40000000</span><span class="o">&gt;</span><span class="p">;</span>
<a id="__codelineno-75-32" name="__codelineno-75-32"></a><span class="w">    </span><span class="p">};</span>
<a id="__codelineno-75-33" name="__codelineno-75-33"></a>
<a id="__codelineno-75-34" name="__codelineno-75-34"></a><span class="w">    </span><span class="nf">soc</span><span class="cm"> </span><span class="p">{</span>
<a id="__codelineno-75-35" name="__codelineno-75-35"></a><span class="w">        </span><span class="kr">#address-cells</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="p">;</span>
<a id="__codelineno-75-36" name="__codelineno-75-36"></a><span class="w">        </span><span class="kr">#size-cells</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="p">;</span>
<a id="__codelineno-75-37" name="__codelineno-75-37"></a><span class="w">        </span><span class="kr">compatible</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"simple-bus"</span><span class="p">;</span>
<a id="__codelineno-75-38" name="__codelineno-75-38"></a><span class="w">        </span><span class="kr">ranges</span><span class="p">;</span>
<a id="__codelineno-75-39" name="__codelineno-75-39"></a>
<a id="__codelineno-75-40" name="__codelineno-75-40"></a><span class="w">        </span><span class="nf">clint</span><span class="o">@</span><span class="mi">2000000</span><span class="cm"> </span><span class="p">{</span>
<a id="__codelineno-75-41" name="__codelineno-75-41"></a><span class="w">            </span><span class="kr">compatible</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"riscv,clint0"</span><span class="p">;</span>
<a id="__codelineno-75-42" name="__codelineno-75-42"></a><span class="w">            </span><span class="kr">reg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="mh">0x0</span><span class="w"> </span><span class="mh">0x2000000</span><span class="w"> </span><span class="mh">0x0</span><span class="w"> </span><span class="mh">0x10000</span><span class="o">&gt;</span><span class="p">;</span>
<a id="__codelineno-75-43" name="__codelineno-75-43"></a><span class="w">            </span><span class="n">interrupts-extended</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;&amp;</span><span class="na">cpu0_intc</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="o">&amp;</span><span class="na">cpu0_intc</span><span class="w"> </span><span class="mi">7</span><span class="o">&gt;</span><span class="p">;</span>
<a id="__codelineno-75-44" name="__codelineno-75-44"></a><span class="w">        </span><span class="p">};</span>
<a id="__codelineno-75-45" name="__codelineno-75-45"></a>
<a id="__codelineno-75-46" name="__codelineno-75-46"></a><span class="w">        </span><span class="nf">uart</span><span class="o">@</span><span class="mi">10000000</span><span class="cm"> </span><span class="p">{</span>
<a id="__codelineno-75-47" name="__codelineno-75-47"></a><span class="w">            </span><span class="kr">compatible</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"ns16550a"</span><span class="p">;</span>
<a id="__codelineno-75-48" name="__codelineno-75-48"></a><span class="w">            </span><span class="kr">reg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="mh">0x0</span><span class="w"> </span><span class="mh">0x10000000</span><span class="w"> </span><span class="mh">0x0</span><span class="w"> </span><span class="mh">0x100</span><span class="o">&gt;</span><span class="p">;</span>
<a id="__codelineno-75-49" name="__codelineno-75-49"></a><span class="w">            </span><span class="n">interrupts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="mi">10</span><span class="o">&gt;</span><span class="p">;</span>
<a id="__codelineno-75-50" name="__codelineno-75-50"></a><span class="w">            </span><span class="n">clock-frequency</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="mi">50000000</span><span class="o">&gt;</span><span class="p">;</span>
<a id="__codelineno-75-51" name="__codelineno-75-51"></a><span class="w">        </span><span class="p">};</span>
<a id="__codelineno-75-52" name="__codelineno-75-52"></a><span class="w">    </span><span class="p">};</span>
<a id="__codelineno-75-53" name="__codelineno-75-53"></a><span class="p">};</span>
</code></pre></div></td></tr></table></div>
<h4 id="_47">基础驱动<a class="headerlink" href="#_47" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<ol>
<li>中断控制器</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">C</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-76-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-76-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-76-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-76-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-76-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-76-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-76-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-76-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-76-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-76-10">10</a></span>
<span class="normal"><a href="#__codelineno-76-11">11</a></span>
<span class="normal"><a href="#__codelineno-76-12">12</a></span>
<span class="normal"><a href="#__codelineno-76-13">13</a></span>
<span class="normal"><a href="#__codelineno-76-14">14</a></span>
<span class="normal"><a href="#__codelineno-76-15">15</a></span>
<span class="normal"><a href="#__codelineno-76-16">16</a></span>
<span class="normal"><a href="#__codelineno-76-17">17</a></span>
<span class="normal"><a href="#__codelineno-76-18">18</a></span>
<span class="normal"><a href="#__codelineno-76-19">19</a></span>
<span class="normal"><a href="#__codelineno-76-20">20</a></span>
<span class="normal"><a href="#__codelineno-76-21">21</a></span>
<span class="normal"><a href="#__codelineno-76-22">22</a></span>
<span class="normal"><a href="#__codelineno-76-23">23</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-76-1" name="__codelineno-76-1"></a><span class="c1">// PLIC驱动</span>
<a id="__codelineno-76-2" name="__codelineno-76-2"></a><span class="k">static</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">irq_chip</span><span class="w"> </span><span class="n">plic_chip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-76-3" name="__codelineno-76-3"></a><span class="w">    </span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"PLIC"</span><span class="p">,</span>
<a id="__codelineno-76-4" name="__codelineno-76-4"></a><span class="w">    </span><span class="p">.</span><span class="n">irq_mask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">plic_mask</span><span class="p">,</span>
<a id="__codelineno-76-5" name="__codelineno-76-5"></a><span class="w">    </span><span class="p">.</span><span class="n">irq_unmask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">plic_unmask</span><span class="p">,</span>
<a id="__codelineno-76-6" name="__codelineno-76-6"></a><span class="w">    </span><span class="p">.</span><span class="n">irq_set_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">plic_set_type</span><span class="p">,</span>
<a id="__codelineno-76-7" name="__codelineno-76-7"></a><span class="p">};</span>
<a id="__codelineno-76-8" name="__codelineno-76-8"></a>
<a id="__codelineno-76-9" name="__codelineno-76-9"></a><span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">plic_init</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">device_node</span><span class="w"> </span><span class="o">*</span><span class="n">node</span><span class="p">,</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">device_node</span><span class="w"> </span><span class="o">*</span><span class="n">parent</span><span class="p">)</span>
<a id="__codelineno-76-10" name="__codelineno-76-10"></a><span class="p">{</span>
<a id="__codelineno-76-11" name="__codelineno-76-11"></a><span class="w">    </span><span class="c1">// 映射寄存器</span>
<a id="__codelineno-76-12" name="__codelineno-76-12"></a><span class="w">    </span><span class="n">reg_base</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">of_iomap</span><span class="p">(</span><span class="n">node</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-76-13" name="__codelineno-76-13"></a>
<a id="__codelineno-76-14" name="__codelineno-76-14"></a><span class="w">    </span><span class="c1">// 初始化中断域</span>
<a id="__codelineno-76-15" name="__codelineno-76-15"></a><span class="w">    </span><span class="n">domain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">irq_domain_add_linear</span><span class="p">(</span><span class="n">node</span><span class="p">,</span><span class="w"> </span><span class="n">PLIC_NUM_SOURCES</span><span class="p">,</span>
<a id="__codelineno-76-16" name="__codelineno-76-16"></a><span class="w">                                 </span><span class="o">&amp;</span><span class="n">plic_domain_ops</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
<a id="__codelineno-76-17" name="__codelineno-76-17"></a>
<a id="__codelineno-76-18" name="__codelineno-76-18"></a><span class="w">    </span><span class="c1">// 设置默认优先级</span>
<a id="__codelineno-76-19" name="__codelineno-76-19"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">PLIC_NUM_SOURCES</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<a id="__codelineno-76-20" name="__codelineno-76-20"></a><span class="w">        </span><span class="n">writel</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">reg_base</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">PLIC_PRIORITY_OFFSET</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">4</span><span class="p">));</span>
<a id="__codelineno-76-21" name="__codelineno-76-21"></a>
<a id="__codelineno-76-22" name="__codelineno-76-22"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-76-23" name="__codelineno-76-23"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ol start="2">
<li>时钟驱动</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">C</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-77-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-77-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-77-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-77-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-77-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-77-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-77-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-77-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-77-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-77-10">10</a></span>
<span class="normal"><a href="#__codelineno-77-11">11</a></span>
<span class="normal"><a href="#__codelineno-77-12">12</a></span>
<span class="normal"><a href="#__codelineno-77-13">13</a></span>
<span class="normal"><a href="#__codelineno-77-14">14</a></span>
<span class="normal"><a href="#__codelineno-77-15">15</a></span>
<span class="normal"><a href="#__codelineno-77-16">16</a></span>
<span class="normal"><a href="#__codelineno-77-17">17</a></span>
<span class="normal"><a href="#__codelineno-77-18">18</a></span>
<span class="normal"><a href="#__codelineno-77-19">19</a></span>
<span class="normal"><a href="#__codelineno-77-20">20</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-77-1" name="__codelineno-77-1"></a><span class="c1">// CLINT驱动</span>
<a id="__codelineno-77-2" name="__codelineno-77-2"></a><span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">clint_timer_init</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">device_node</span><span class="w"> </span><span class="o">*</span><span class="n">node</span><span class="p">)</span>
<a id="__codelineno-77-3" name="__codelineno-77-3"></a><span class="p">{</span>
<a id="__codelineno-77-4" name="__codelineno-77-4"></a><span class="w">    </span><span class="c1">// 获取时钟频率</span>
<a id="__codelineno-77-5" name="__codelineno-77-5"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">of_property_read_u32</span><span class="p">(</span><span class="n">node</span><span class="p">,</span><span class="w"> </span><span class="s">"timebase-frequency"</span><span class="p">,</span>
<a id="__codelineno-77-6" name="__codelineno-77-6"></a><span class="w">                            </span><span class="o">&amp;</span><span class="n">timebase_freq</span><span class="p">))</span>
<a id="__codelineno-77-7" name="__codelineno-77-7"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
<a id="__codelineno-77-8" name="__codelineno-77-8"></a>
<a id="__codelineno-77-9" name="__codelineno-77-9"></a><span class="w">    </span><span class="c1">// 设置定时器</span>
<a id="__codelineno-77-10" name="__codelineno-77-10"></a><span class="w">    </span><span class="n">sched_clock_register</span><span class="p">(</span><span class="n">clint_read_sched_clock</span><span class="p">,</span>
<a id="__codelineno-77-11" name="__codelineno-77-11"></a><span class="w">                        </span><span class="n">BITS_PER_LONG</span><span class="p">,</span><span class="w"> </span><span class="n">timebase_freq</span><span class="p">);</span>
<a id="__codelineno-77-12" name="__codelineno-77-12"></a>
<a id="__codelineno-77-13" name="__codelineno-77-13"></a><span class="w">    </span><span class="c1">// 注册时钟事件设备</span>
<a id="__codelineno-77-14" name="__codelineno-77-14"></a><span class="w">    </span><span class="n">clockevents_config_and_register</span><span class="p">(</span><span class="n">clint_evt</span><span class="p">,</span>
<a id="__codelineno-77-15" name="__codelineno-77-15"></a><span class="w">                                  </span><span class="n">timebase_freq</span><span class="p">,</span>
<a id="__codelineno-77-16" name="__codelineno-77-16"></a><span class="w">                                  </span><span class="n">TIMER_MIN_DELTA</span><span class="p">,</span>
<a id="__codelineno-77-17" name="__codelineno-77-17"></a><span class="w">                                  </span><span class="n">TIMER_MAX_DELTA</span><span class="p">);</span>
<a id="__codelineno-77-18" name="__codelineno-77-18"></a>
<a id="__codelineno-77-19" name="__codelineno-77-19"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-77-20" name="__codelineno-77-20"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h4 id="_48">调试支持<a class="headerlink" href="#_48" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<ol>
<li><span>JTAG<span class="heti-spacing"> </span></span>接口</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Verilog</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-78-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-78-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-78-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-78-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-78-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-78-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-78-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-78-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-78-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-78-10">10</a></span>
<span class="normal"><a href="#__codelineno-78-11">11</a></span>
<span class="normal"><a href="#__codelineno-78-12">12</a></span>
<span class="normal"><a href="#__codelineno-78-13">13</a></span>
<span class="normal"><a href="#__codelineno-78-14">14</a></span>
<span class="normal"><a href="#__codelineno-78-15">15</a></span>
<span class="normal"><a href="#__codelineno-78-16">16</a></span>
<span class="normal"><a href="#__codelineno-78-17">17</a></span>
<span class="normal"><a href="#__codelineno-78-18">18</a></span>
<span class="normal"><a href="#__codelineno-78-19">19</a></span>
<span class="normal"><a href="#__codelineno-78-20">20</a></span>
<span class="normal"><a href="#__codelineno-78-21">21</a></span>
<span class="normal"><a href="#__codelineno-78-22">22</a></span>
<span class="normal"><a href="#__codelineno-78-23">23</a></span>
<span class="normal"><a href="#__codelineno-78-24">24</a></span>
<span class="normal"><a href="#__codelineno-78-25">25</a></span>
<span class="normal"><a href="#__codelineno-78-26">26</a></span>
<span class="normal"><a href="#__codelineno-78-27">27</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-78-1" name="__codelineno-78-1"></a><span class="c1">// JTAG TAP控制器</span>
<a id="__codelineno-78-2" name="__codelineno-78-2"></a><span class="k">module</span><span class="w"> </span><span class="n">jtag_tap</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-78-3" name="__codelineno-78-3"></a><span class="w">    </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="n">tck</span><span class="p">,</span>
<a id="__codelineno-78-4" name="__codelineno-78-4"></a><span class="w">    </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="n">tms</span><span class="p">,</span>
<a id="__codelineno-78-5" name="__codelineno-78-5"></a><span class="w">    </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="n">tdi</span><span class="p">,</span>
<a id="__codelineno-78-6" name="__codelineno-78-6"></a><span class="w">    </span><span class="k">output</span><span class="w"> </span><span class="kt">logic</span><span class="w"> </span><span class="n">tdo</span><span class="p">,</span>
<a id="__codelineno-78-7" name="__codelineno-78-7"></a>
<a id="__codelineno-78-8" name="__codelineno-78-8"></a><span class="w">    </span><span class="c1">// Debug接口</span>
<a id="__codelineno-78-9" name="__codelineno-78-9"></a><span class="w">    </span><span class="k">output</span><span class="w"> </span><span class="kt">logic</span><span class="w">        </span><span class="n">dbg_reset_n</span><span class="p">,</span>
<a id="__codelineno-78-10" name="__codelineno-78-10"></a><span class="w">    </span><span class="k">output</span><span class="w"> </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="mh">31</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">dbg_reg_addr</span><span class="p">,</span>
<a id="__codelineno-78-11" name="__codelineno-78-11"></a><span class="w">    </span><span class="k">output</span><span class="w"> </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="mh">63</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">dbg_reg_wdata</span><span class="p">,</span>
<a id="__codelineno-78-12" name="__codelineno-78-12"></a><span class="w">    </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="mh">63</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">dbg_reg_rdata</span><span class="p">,</span>
<a id="__codelineno-78-13" name="__codelineno-78-13"></a><span class="w">    </span><span class="k">output</span><span class="w"> </span><span class="kt">logic</span><span class="w">        </span><span class="n">dbg_reg_wen</span>
<a id="__codelineno-78-14" name="__codelineno-78-14"></a><span class="p">);</span>
<a id="__codelineno-78-15" name="__codelineno-78-15"></a>
<a id="__codelineno-78-16" name="__codelineno-78-16"></a><span class="c1">// TAP状态机</span>
<a id="__codelineno-78-17" name="__codelineno-78-17"></a><span class="k">typedef</span><span class="w"> </span><span class="k">enum</span><span class="w"> </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="mh">3</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-78-18" name="__codelineno-78-18"></a><span class="w">    </span><span class="n">TEST_LOGIC_RESET</span><span class="p">,</span>
<a id="__codelineno-78-19" name="__codelineno-78-19"></a><span class="w">    </span><span class="n">RUN_TEST_IDLE</span><span class="p">,</span>
<a id="__codelineno-78-20" name="__codelineno-78-20"></a><span class="w">    </span><span class="n">SELECT_DR_SCAN</span><span class="p">,</span>
<a id="__codelineno-78-21" name="__codelineno-78-21"></a><span class="w">    </span><span class="n">CAPTURE_DR</span><span class="p">,</span>
<a id="__codelineno-78-22" name="__codelineno-78-22"></a><span class="w">    </span><span class="n">SHIFT_DR</span><span class="p">,</span>
<a id="__codelineno-78-23" name="__codelineno-78-23"></a><span class="w">    </span><span class="n">EXIT1_DR</span><span class="p">,</span>
<a id="__codelineno-78-24" name="__codelineno-78-24"></a><span class="w">    </span><span class="n">PAUSE_DR</span><span class="p">,</span>
<a id="__codelineno-78-25" name="__codelineno-78-25"></a><span class="w">    </span><span class="n">EXIT2_DR</span><span class="p">,</span>
<a id="__codelineno-78-26" name="__codelineno-78-26"></a><span class="w">    </span><span class="n">UPDATE_DR</span>
<a id="__codelineno-78-27" name="__codelineno-78-27"></a><span class="p">}</span><span class="w"> </span><span class="n">tap_state_t</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
<ol start="2">
<li>调试寄存器</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Verilog</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-79-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-79-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-79-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-79-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-79-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-79-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-79-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-79-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-79-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-79-10">10</a></span>
<span class="normal"><a href="#__codelineno-79-11">11</a></span>
<span class="normal"><a href="#__codelineno-79-12">12</a></span>
<span class="normal"><a href="#__codelineno-79-13">13</a></span>
<span class="normal"><a href="#__codelineno-79-14">14</a></span>
<span class="normal"><a href="#__codelineno-79-15">15</a></span>
<span class="normal"><a href="#__codelineno-79-16">16</a></span>
<span class="normal"><a href="#__codelineno-79-17">17</a></span>
<span class="normal"><a href="#__codelineno-79-18">18</a></span>
<span class="normal"><a href="#__codelineno-79-19">19</a></span>
<span class="normal"><a href="#__codelineno-79-20">20</a></span>
<span class="normal"><a href="#__codelineno-79-21">21</a></span>
<span class="normal"><a href="#__codelineno-79-22">22</a></span>
<span class="normal"><a href="#__codelineno-79-23">23</a></span>
<span class="normal"><a href="#__codelineno-79-24">24</a></span>
<span class="normal"><a href="#__codelineno-79-25">25</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-79-1" name="__codelineno-79-1"></a><span class="c1">// 调试寄存器组</span>
<a id="__codelineno-79-2" name="__codelineno-79-2"></a><span class="k">module</span><span class="w"> </span><span class="n">debug_registers</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-79-3" name="__codelineno-79-3"></a><span class="w">    </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w">        </span><span class="n">clk</span><span class="p">,</span>
<a id="__codelineno-79-4" name="__codelineno-79-4"></a><span class="w">    </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w">        </span><span class="n">rst_n</span><span class="p">,</span>
<a id="__codelineno-79-5" name="__codelineno-79-5"></a>
<a id="__codelineno-79-6" name="__codelineno-79-6"></a><span class="w">    </span><span class="c1">// 调试接口</span>
<a id="__codelineno-79-7" name="__codelineno-79-7"></a><span class="w">    </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="mh">11</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">addr</span><span class="p">,</span>
<a id="__codelineno-79-8" name="__codelineno-79-8"></a><span class="w">    </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="mh">63</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">wdata</span><span class="p">,</span>
<a id="__codelineno-79-9" name="__codelineno-79-9"></a><span class="w">    </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w">        </span><span class="n">wen</span><span class="p">,</span>
<a id="__codelineno-79-10" name="__codelineno-79-10"></a><span class="w">    </span><span class="k">output</span><span class="w"> </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="mh">63</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">rdata</span><span class="p">,</span>
<a id="__codelineno-79-11" name="__codelineno-79-11"></a>
<a id="__codelineno-79-12" name="__codelineno-79-12"></a><span class="w">    </span><span class="c1">// 处理器控制</span>
<a id="__codelineno-79-13" name="__codelineno-79-13"></a><span class="w">    </span><span class="k">output</span><span class="w"> </span><span class="kt">logic</span><span class="w">        </span><span class="n">cpu_halt</span><span class="p">,</span>
<a id="__codelineno-79-14" name="__codelineno-79-14"></a><span class="w">    </span><span class="k">output</span><span class="w"> </span><span class="kt">logic</span><span class="w">        </span><span class="n">cpu_resume</span><span class="p">,</span>
<a id="__codelineno-79-15" name="__codelineno-79-15"></a><span class="w">    </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="mh">63</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">pc_current</span><span class="p">,</span>
<a id="__codelineno-79-16" name="__codelineno-79-16"></a><span class="w">    </span><span class="k">output</span><span class="w"> </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="mh">63</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">pc_next</span>
<a id="__codelineno-79-17" name="__codelineno-79-17"></a><span class="p">);</span>
<a id="__codelineno-79-18" name="__codelineno-79-18"></a>
<a id="__codelineno-79-19" name="__codelineno-79-19"></a><span class="c1">// 寄存器定义</span>
<a id="__codelineno-79-20" name="__codelineno-79-20"></a><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="mh">63</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">debug_regs</span><span class="w"> </span><span class="p">[</span><span class="mh">32</span><span class="p">];</span>
<a id="__codelineno-79-21" name="__codelineno-79-21"></a>
<a id="__codelineno-79-22" name="__codelineno-79-22"></a><span class="c1">// 控制寄存器</span>
<a id="__codelineno-79-23" name="__codelineno-79-23"></a><span class="k">localparam</span><span class="w"> </span><span class="n">DCSR</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="mh">12'h7b0</span><span class="p">;</span>
<a id="__codelineno-79-24" name="__codelineno-79-24"></a><span class="k">localparam</span><span class="w"> </span><span class="n">DPC</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="mh">12'h7b1</span><span class="p">;</span>
<a id="__codelineno-79-25" name="__codelineno-79-25"></a><span class="k">localparam</span><span class="w"> </span><span class="n">DSCRATCH</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">12'h7b2</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
<h3 id="11-spec"><span>11. SPEC<span class="heti-spacing"> </span></span>运行环境<a class="headerlink" href="#11-spec" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<h4 id="_49">编译环境配置<a class="headerlink" href="#_49" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<ol>
<li>工具链配置</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-80-1">1</a></span>
<span class="normal"><a href="#__codelineno-80-2">2</a></span>
<span class="normal"><a href="#__codelineno-80-3">3</a></span>
<span class="normal"><a href="#__codelineno-80-4">4</a></span>
<span class="normal"><a href="#__codelineno-80-5">5</a></span>
<span class="normal"><a href="#__codelineno-80-6">6</a></span>
<span class="normal"><a href="#__codelineno-80-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-80-1" name="__codelineno-80-1"></a><span class="c1"># 交叉编译工具链</span>
<a id="__codelineno-80-2" name="__codelineno-80-2"></a><span class="nb">export</span><span class="w"> </span><span class="nv">CROSS_COMPILE</span><span class="o">=</span>riscv64-unknown-linux-gnu-
<a id="__codelineno-80-3" name="__codelineno-80-3"></a><span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span>/opt/riscv/bin:<span class="nv">$PATH</span>
<a id="__codelineno-80-4" name="__codelineno-80-4"></a>
<a id="__codelineno-80-5" name="__codelineno-80-5"></a><span class="c1"># 编译选项</span>
<a id="__codelineno-80-6" name="__codelineno-80-6"></a><span class="nv">CFLAGS</span><span class="o">=</span><span class="s2">"-O3 -march=rv64imafdc -mabi=lp64d"</span>
<a id="__codelineno-80-7" name="__codelineno-80-7"></a><span class="nv">LDFLAGS</span><span class="o">=</span><span class="s2">"-static"</span>
</code></pre></div></td></tr></table></div>
<ol start="2">
<li><span>SPEC<span class="heti-spacing"> </span></span>配置</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-81-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-81-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-81-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-81-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-81-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-81-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-81-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-81-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-81-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-81-10">10</a></span>
<span class="normal"><a href="#__codelineno-81-11">11</a></span>
<span class="normal"><a href="#__codelineno-81-12">12</a></span>
<span class="normal"><a href="#__codelineno-81-13">13</a></span>
<span class="normal"><a href="#__codelineno-81-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-81-1" name="__codelineno-81-1"></a><span class="c1"># SPEC配置文件</span>
<a id="__codelineno-81-2" name="__codelineno-81-2"></a>cat<span class="w"> </span>&gt;<span class="w"> </span>riscv64.cfg<span class="w"> </span><span class="s">&lt;&lt; EOF</span>
<a id="__codelineno-81-3" name="__codelineno-81-3"></a><span class="s">CC  = ${CROSS_COMPILE}gcc</span>
<a id="__codelineno-81-4" name="__codelineno-81-4"></a><span class="s">CXX = ${CROSS_COMPILE}g++</span>
<a id="__codelineno-81-5" name="__codelineno-81-5"></a><span class="s">FC  = ${CROSS_COMPILE}gfortran</span>
<a id="__codelineno-81-6" name="__codelineno-81-6"></a>
<a id="__codelineno-81-7" name="__codelineno-81-7"></a><span class="s">COPTIMIZE = -O3 -march=rv64imafdc -mabi=lp64d</span>
<a id="__codelineno-81-8" name="__codelineno-81-8"></a><span class="s">CXXOPTIMIZE = -O3 -march=rv64imafdc -mabi=lp64d</span>
<a id="__codelineno-81-9" name="__codelineno-81-9"></a>
<a id="__codelineno-81-10" name="__codelineno-81-10"></a><span class="s">EXTRA_LIBS = -static</span>
<a id="__codelineno-81-11" name="__codelineno-81-11"></a>
<a id="__codelineno-81-12" name="__codelineno-81-12"></a><span class="s">default=default=default=default:</span>
<a id="__codelineno-81-13" name="__codelineno-81-13"></a><span class="s">PORTABILITY = -DSPEC_CPU_LP64</span>
<a id="__codelineno-81-14" name="__codelineno-81-14"></a><span class="s">EOF</span>
</code></pre></div></td></tr></table></div>
<p>```</p>
<h4 id="_50">性能测试<a class="headerlink" href="#_50" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<ol>
<li>
<p>运行脚本
   ```python
   def run_spec_benchmark():
       # 配置环境
       os.environ['SPEC'] = '/path/to/spec'</p>
<p><span>#<span class="heti-spacing"> </span></span>运行基准测试
   benchmarks = [
       '500.perlbench_r',
       '502.gcc_r',
       '505.mcf_r',
       '520.omnetpp_r',
       '523.xalancbmk_r',
       '525.x264_r',
       '531.deepsjeng_r',
       '541.leela_r',
       '548.exchange2_r',
       '557.xz_r'
   ]</p>
<p><span>#<span class="heti-spacing"> </span></span>收集结果
   results = {}
   for bench in benchmarks:
       runtime = run_benchmark(bench)
       results[bench] = runtime</p>
<p>return results
   ```</p>
</li>
<li>
<p>性能分析</p>
</li>
</ol>
<p>```python
   def analyze_spec_performance():
       # 加载性能计数器数据
       perf_data = load_perf_counters()</p>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span></pre></div></td><td class="code"><div><pre><span></span><code>   # 分析每个基准测试
   for bench in perf_data:
       # IPC分析
       ipc = perf_data[bench]['instructions'] / \
             perf_data[bench]['cycles']

       # 缓存行为
       l1d_miss_rate = perf_data[bench]['l1d_misses'] / \
                      perf_data[bench]['l1d_accesses']

       l2_miss_rate = perf_data[bench]['l2_misses'] / \
                     perf_data[bench]['l2_accesses']

       # 分支预测
       bp_accuracy = perf_data[bench]['bp_correct'] / \
                    perf_data[bench]['bp_total']

       print(f"Benchmark: {bench}")
       print(f"IPC: {ipc:.2f}")
       print(f"L1D miss rate: {l1d_miss_rate:.2%}")
       print(f"L2 miss rate: {l2_miss_rate:.2%}")
       print(f"Branch prediction accuracy: {bp_accuracy:.2%}")
</code></pre></div></td></tr></table></div>
<p>```</p>
<h4 id="_51">调试工具<a class="headerlink" href="#_51" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<ol>
<li>性能分析工具</li>
</ol>
<p>```python
   class PerfAnalyzer:
       def <strong>init</strong>(self):
           self.perf_events = {
               'cycles': 'cpu-cycles',
               'instructions': 'instructions',
               'cache-misses': 'cache-misses',
               'branch-misses': 'branch-misses'
           }</p>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span></pre></div></td><td class="code"><div><pre><span></span><code>   def collect_perf_data(self, command):
       perf_cmd = ['perf', 'stat', '-e', ','.join(self.perf_events.values())]
       perf_cmd.extend(command)

       output = subprocess.run(perf_cmd, capture_output=True, text=True)
       return self.parse_perf_output(output.stderr)

   def parse_perf_output(self, output):
       results = {}
       for line in output.splitlines():
           if any(event in line for event in self.perf_events.values()):
               count = float(line.split()[0].replace(',',''))
               event = next(k for k,v in self.perf_events.items() 
                          if v in line)
               results[event] = count
       return results
</code></pre></div></td></tr></table></div>
<p>```</p>
<ol start="2">
<li>调试接口</li>
</ol>
<p>```python
   class DebugInterface:
       def <strong>init</strong>(self, jtag_dev='/dev/jtag0'):
           self.dev = open(jtag_dev, 'rb+')</p>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span></pre></div></td><td class="code"><div><pre><span></span><code>   def read_reg(self, addr):
       cmd = struct.pack('BQ', CMD_READ, addr)
       self.dev.write(cmd)
       return struct.unpack('Q', self.dev.read(8))[0]

   def write_reg(self, addr, data):
       cmd = struct.pack('BQQ', CMD_WRITE, addr, data)
       self.dev.write(cmd)

   def set_breakpoint(self, addr):
       self.write_reg(DBG_BP_ADDR, addr)
       self.write_reg(DBG_CTRL, DBG_CTRL_BP_EN)

   def single_step(self):
       self.write_reg(DBG_CTRL, DBG_CTRL_STEP)
       while not (self.read_reg(DBG_STATUS) &amp; DBG_STATUS_HALTED):
           time.sleep(0.001)
</code></pre></div></td></tr></table></div>
<p>```</p>
<h3 id="12"><span>12.<span class="heti-spacing"> </span></span>性能优化<a class="headerlink" href="#12" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<h4 id="_52">关键路径优化<a class="headerlink" href="#_52" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<ol>
<li>时序分析</li>
</ol>
<p>```verilog
   // 关键路径分析模块
   module timing_analyzer;
     // 记录路径延迟
     typedef struct {
       string start_point;
       string end_point;
       real   delay;
       int    logic_levels;
     } path_info_t;</p>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span></pre></div></td><td class="code"><div><pre><span></span><code> // 关键路径列表
 path_info_t critical_paths[$];

 // 时序检查
 task analyze_timing();
   // 检查发射逻辑路径
   check_issue_logic();

   // 检查唤醒网络
   check_wakeup_network();

   // 检查转发路径
   check_bypass_path();
 endtask

 // 优化建议生成
 function void generate_optimization_report();
   foreach(critical_paths[i]) begin
     if(critical_paths[i].delay &gt; target_delay)
       suggest_optimization(critical_paths[i]);
   end
 endfunction
</code></pre></div></td></tr></table></div>
<p>endmodule
   ```</p>
<ol start="2">
<li>流水线优化</li>
</ol>
<p>```verilog
   // 流水线重分段
   module pipeline_balancer;
     // 阶段延迟分析
     typedef struct {
       string stage_name;
       real   stage_delay;
       bit    can_split;
     } stage_info_t;</p>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><div><pre><span></span><code> // 优化流水线分段
 function void optimize_pipeline();
   // 平衡各阶段延迟
   balance_stages();

   // 插入流水线寄存器
   insert_pipeline_registers();

   // 验证优化效果
   verify_timing();
 endfunction
</code></pre></div></td></tr></table></div>
<p>endmodule
   ```</p>
<h4 id="_53">微架构优化<a class="headerlink" href="#_53" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<ol>
<li>分支预测优化</li>
</ol>
<p>```verilog
   // 高级分支预测器
   module enhanced_branch_predictor #(
     parameter int GHR_WIDTH = 16,
     parameter int PHT_SIZE  = 16384,
     parameter int BTB_SIZE  = 4096,
     parameter int RAS_DEPTH = 32
   )(
     // TAGE预测器
     tage_predictor tage (
       .clk        (clk),
       .rst_n      (rst_n),
       .pc         (fetch_pc),
       .hist       (global_hist),
       .pred       (tage_pred),
       .conf       (tage_conf)
     ),</p>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span></pre></div></td><td class="code"><div><pre><span></span><code> // Loop预测器
 loop_predictor loop (
   .clk        (clk),
   .rst_n      (rst_n),
   .pc         (fetch_pc),
   .iter_count (loop_count),
   .pred       (loop_pred)
 ),

 // 预测选择逻辑
 always_comb begin
   if(loop_pred.valid &amp;&amp; loop_pred.conf &gt; tage_conf)
     final_pred = loop_pred;
   else
     final_pred = tage_pred;
 end
</code></pre></div></td></tr></table></div>
<p>);
   ```</p>
<ol start="2">
<li>缓存优化</li>
</ol>
<p>```verilog
   // 缓存预取器
   module advanced_prefetcher #(
     parameter int QUEUE_DEPTH = 16,
     parameter int STRIDE_TABLE_SIZE = 256
   )(
     // 流预取器
     stream_prefetcher stream (
       .clk          (clk),
       .rst_n        (rst_n),
       .access_addr  (mem_addr),
       .pf_req       (stream_pf_req)
     ),</p>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span></pre></div></td><td class="code"><div><pre><span></span><code> // 步长预取器
 stride_prefetcher stride (
   .clk          (clk),
   .rst_n        (rst_n),
   .access_addr  (mem_addr),
   .pf_req       (stride_pf_req)
 ),

 // 预取过滤器
 prefetch_filter filter (
   .stream_req   (stream_pf_req),
   .stride_req   (stride_pf_req),
   .l1_mshr_full (l1_mshr_full),
   .l2_mshr_full (l2_mshr_full),
   .final_req    (pf_req)
 )
</code></pre></div></td></tr></table></div>
<p>);
   ```</p>
<h4 id="_54">性能分析工具<a class="headerlink" href="#_54" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<ol>
<li>性能监控基础设施</li>
</ol>
<p>```verilog
   // 性能计数器模块
   module performance_monitor #(
     parameter int NUM_COUNTERS = 64
   )(
     input  logic        clk,
     input  logic        rst_n,</p>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div><pre><span></span><code> // 计数器控制
 input  logic [5:0]  counter_sel,
 input  logic        counter_en,
 output logic [63:0] counter_value,

 // 性能事件
 input  logic        event_valid [NUM_COUNTERS],
 input  logic [63:0] event_data  [NUM_COUNTERS]
</code></pre></div></td></tr></table></div>
<p>);</p>
<p><span>//<span class="heti-spacing"> </span></span>计数器数组
   logic [63:0] counters [NUM_COUNTERS];</p>
<p><span>//<span class="heti-spacing"> </span></span>计数器更新
   always_ff @(posedge clk) begin
     if(!rst_n) begin
       for(int i=0; i&lt;NUM_COUNTERS; i++)
         counters[i] &lt;= '0;
     end else begin
       for(int i=0; i&lt;NUM_COUNTERS; i++) begin
         if(event_valid[i])
           counters[i] &lt;= counters[i] + event_data[i];
       end
     end
   end
   ```</p>
<ol start="2">
<li>性能分析工具</li>
</ol>
<p>```python
   class PerformanceAnalyzer:
       def <strong>init</strong>(self):
           self.perf_data = {}
           self.bottlenecks = []</p>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span></pre></div></td><td class="code"><div><pre><span></span><code>   def analyze_ipc(self):
       """分析IPC和相关因素"""
       cycles = self.perf_data['cycles']
       insts = self.perf_data['instructions']
       ipc = insts / cycles

       # 分析IPC瓶颈
       if ipc &lt; target_ipc:
           if self.perf_data['stall_rob'] / cycles &gt; 0.1:
               self.bottlenecks.append('ROB压力')
           if self.perf_data['stall_lsq'] / cycles &gt; 0.1:
               self.bottlenecks.append('LSQ压力')

   def analyze_cache(self):
       """分析缓存性能"""
       l1d_miss_rate = self.perf_data['l1d_misses'] / \
                      self.perf_data['l1d_accesses']
       l2_miss_rate = self.perf_data['l2_misses'] / \
                     self.perf_data['l2_accesses']

       # 生成优化建议
       if l1d_miss_rate &gt; 0.05:
           self.suggest_l1d_optimization()
       if l2_miss_rate &gt; 0.3:
           self.suggest_l2_optimization()

   def suggest_optimizations(self):
       """生成优化建议报告"""
       report = []
       for bottleneck in self.bottlenecks:
           if bottleneck == 'ROB压力':
               report.append({
                   'problem': 'ROB频繁满载',
                   'solution': [
                       '增加ROB大小',
                       '优化提交带宽',
                       '改进分支预测'
                   ]
               })
           elif bottleneck == 'LSQ压力':
               report.append({
                   'problem': 'LSQ限制性能',
                   'solution': [
                       '增加LSQ条目',
                       '优化内存依赖预测',
                       '改进Store-to-Load转发'
                   ]
               })
       return report
</code></pre></div></td></tr></table></div>
<p>```</p>
<h4 id="spec"><span>SPEC<span class="heti-spacing"> </span></span>性能优化<a class="headerlink" href="#spec" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<ol>
<li>性能分析框架</li>
</ol>
<p>```python
   class SpecAnalyzer:
       def <strong>init</strong>(self):
           self.benchmarks = [
               '500.perlbench_r',
               '502.gcc_r',
               '505.mcf_r',
               '520.omnetpp_r',
               '523.xalancbmk_r',
               '525.x264_r',
               '531.deepsjeng_r',
               '541.leela_r',
               '548.exchange2_r',
               '557.xz_r'
           ]</p>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span></pre></div></td><td class="code"><div><pre><span></span><code>   def analyze_benchmark(self, benchmark):
       """分析单个基准测试"""
       # 收集性能数据
       perf_data = self.collect_perf_data(benchmark)

       # 分析特征
       characteristics = {
           'compute_bound': self.is_compute_bound(perf_data),
           'memory_bound': self.is_memory_bound(perf_data),
           'branch_heavy': self.is_branch_heavy(perf_data)
       }

       # 生成优化建议
       optimizations = self.suggest_optimizations(characteristics)
       return optimizations

   def analyze_all(self):
       """分析所有基准测试"""
       results = {}
       for bench in self.benchmarks:
           results[bench] = self.analyze_benchmark(bench)
       return results
</code></pre></div></td></tr></table></div>
<p>```</p>
<ol start="2">
<li>优化实施</li>
</ol>
<p>```python
   class SpecOptimizer:
       def <strong>init</strong>(self):
           self.config = {
               'compile_flags': {
                   'O3': '-O3',
                   'march': '-march=rv64imafdc',
                   'mtune': '-mtune=generic',
                   'unroll': '-funroll-loops',
                   'prefetch': '-fprefetch-loop-arrays'
               }
           }</p>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span></pre></div></td><td class="code"><div><pre><span></span><code>   def optimize_benchmark(self, benchmark, characteristics):
       """根据特征优化基准测试"""
       flags = [self.config['compile_flags']['O3']]

       if characteristics['compute_bound']:
           flags.extend([
               '-ffast-math',
               '-funroll-loops',
               '-ftree-vectorize'
           ])

       if characteristics['memory_bound']:
           flags.extend([
               '-fprefetch-loop-arrays',
               '-fopt-info-vec-missed'
           ])

       if characteristics['branch_heavy']:
           flags.extend([
               '-fprofile-generate',
               '-fprofile-use'
           ])

       return self.compile_benchmark(benchmark, flags)
</code></pre></div></td></tr></table></div>
<p>```</p>
<h4 id="_55">性能调优流程<a class="headerlink" href="#_55" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<ol>
<li>性能基线建立</li>
</ol>
<p>```python
   def establish_baseline():
       """建立性能基线"""
       # 运行基准测试
       baseline_results = run_spec_baseline()</p>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span></pre></div></td><td class="code"><div><pre><span></span><code>   # 收集关键指标
   metrics = {
       'avg_ipc': calculate_average_ipc(),
       'geomean_speedup': calculate_geomean_speedup(),
       'l1d_miss_rate': get_average_l1d_miss_rate(),
       'l2_miss_rate': get_average_l2_miss_rate(),
       'branch_mpki': get_average_branch_mpki()
   }

   # 保存基线数据
   save_baseline_results(metrics)
   return metrics
</code></pre></div></td></tr></table></div>
<p>```</p>
<ol start="2">
<li>持续优化流程</li>
</ol>
<p>```python
   def optimization_cycle():
       """优化循环"""
       while True:
           # 收集当前性能数据
           current_perf = collect_performance_data()</p>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span></pre></div></td><td class="code"><div><pre><span></span><code>       # 与基线比较
       comparison = compare_with_baseline(current_perf)

       # 识别瓶颈
       bottlenecks = identify_bottlenecks(current_perf)

       # 生成优化建议
       optimizations = generate_optimization_suggestions(bottlenecks)

       # 实施优化
       if optimizations:
           implement_optimizations(optimizations)
       else:
           break

       # 验证优化效果
       verify_optimization_impact()
</code></pre></div></td></tr></table></div>
<p>```</p>
<p>根据处理器设计的完整流程，还有以下重要部分需要展开：</p>
<ol>
<li>
<p>总体验证平台搭建
  - UVM测试环境
  - Coverage收集
  - Assert检查
  - 性能验证</p>
</li>
<li>
<p><span>FPGA<span class="heti-spacing"> </span></span>实现细节
  - Timing约束
  - 资源分配
  - 调试接口
  - 烧录流程</p>
</li>
<li>
<p><span>SoC<span class="heti-spacing"> </span></span>集成
  - 外设控制器
  - DMA设计
  - 总线结构
  - 中断系统</p>
</li>
<li>
<p>工程实践指南
  - 代码规范
  - 文档体系
  - Review流程
  - 项目管理</p>
</li>
</ol>
<p>这些内容对于实现一个完整的产品级处理器都很重要。是否继续展开这些部分？</p>
<div id="__comments"></div>
<!-- <h3>颜色主题调整</h3>
    <div class="tx-switch">
    <button class="button1" data-md-color-primary="red" style="background-color:red">red</button>
    <button class="button1" data-md-color-primary="pink" style="background-color:pink;color:black">pink</button>
    <button class="button1" data-md-color-primary="purple" style="background-color:purple">purple</button>
    <button class="button1" data-md-color-primary="indigo" style="background-color:indigo">indigo</button>
    <button class="button1" data-md-color-primary="blue" style="background-color:blue">blue</button>
    <button class="button1" data-md-color-primary="cyan" style="background-color:cyan;color:black">cyan</button>
    <button class="button1" data-md-color-primary="teal" style="background-color:teal">teal</button>
    <button class="button1" data-md-color-primary="green" style="background-color:green">green</button>
    <button class="button1" data-md-color-primary="lime" style="background-color:lime;color:black">lime</button>
    <button class="button1" data-md-color-primary="orange" style="background-color:orange;color:black">orange</button>
    <button class="button1" data-md-color-primary="brown" style="background-color:brown;border-radius=3px">brown</button>
    <button class="button1" data-md-color-primary="grey" style="background-color:grey">grey</button>
    <button class="button1" data-md-color-primary="black" style="background-color:black">black</button>
    <button class="button1" data-md-color-primary="white" style="background-color:white;color:black">white</button>
    </div> -->
<!-- Giscus -->
<script async="" crossorigin="anonymous" data-category="General" data-category-id="DIC_kwDONBPLqs4Cja0c" data-emit-metadata="0" data-input-position="bottom" data-lang="zh-CN" data-mapping="pathname" data-reactions-enabled="1" data-repo="WncFht/notes" data-repo-id="R_kgDONBPLqg" data-strict="0" data-theme="preferred_color_scheme" src="https://giscus.app/client.js">
</script>
<script>
    var buttons = document.querySelectorAll("button[data-md-color-primary]")
    buttons.forEach(function(button) {
            button.addEventListener("click", function() {
            var attr = this.getAttribute("data-md-color-primary")
            document.body.setAttribute("data-md-color-primary", attr)
            localStorage.setItem("data-md-color-primary",attr);
            })
    })
    </script>
<!-- Synchronize Giscus theme with palette -->
<script>
    var giscus = document.querySelector("script[src*=giscus]")
</script>
<script>
    var giscus = document.querySelector("script[src*=giscus]")
    
    /* Set palette on initial load */
    var palette = __md_get("__palette")
    if (palette && typeof palette.color === "object") {
        var theme = palette.color.scheme === "slate" ? "dark" : "light"
        giscus.setAttribute("data-theme", theme) 
    }
    
    /* Register event handlers after documented loaded */
    document.addEventListener("DOMContentLoaded", function() {
        var ref = document.querySelector("[data-md-component=palette]")
        ref.addEventListener("change", function() {
        var palette = __md_get("__palette")
        if (palette && typeof palette.color === "object") {
            var theme = palette.color.scheme === "slate" ? "dark" : "light"
    
            /* Instruct Giscus to change theme */
            var frame = document.querySelector(".giscus-frame")
            frame.contentWindow.postMessage(
            { giscus: { setConfig: { theme } } },
            "https://giscus.app"
            )
        }
        })
    })
    </script>
</article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
<button class="md-top md-icon" data-md-component="top" hidden="" type="button">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg>
  回到页面顶部
</button>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
<div class="md-copyright__highlight">
        Copyright © 2024 <a href="https://github.com/WncFht" rel="noopener" target="_blank">WncFht</a>
</div>
    
    
      Powered by
      <a href="https://www.mkdocs.org/" rel="noopener" target="_blank">
        MkDocs
      </a>
      with theme
      <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
        Material
      </a>
      modified by
      <a href="https://github.com/WncFht" rel="noopener" target="_blank">
        WncFht
      </a>
</div>
<div class="md-social">
<a class="md-social__link" href="https://github.com/WncFht" rel="noopener" target="_blank" title="github.com">
<svg viewbox="0 0 496 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg>
</a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../..", "features": ["content.code.annotate", "content.action.view", "navigation.tracking", "navigation.tabs", "navigation.indexes", "navigation.top", "content.code.copy"], "search": "../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script>
<script src="../../assets/javascripts/bundle.83f73b43.min.js"></script>
<script src="../../js/katex.js"></script>
<script src="../../js/mathjax.js"></script>
<script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/contrib/auto-render.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.0/es5/tex-mml-chtml.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.0/es5/tex-chtml.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.0/es5/tex-chtml-full.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.0/es5/tex-svg-full.js"></script>
<script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>